<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Manipulating data tables with dplyr</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03ab_groupby.html">Grouping and summarizing tables</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03ab_examples.html">Example of data manipulation workflows</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/regression.html">Details of the OLS regression method (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/ANOVA.html">Details of an ANOVA (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Misc01.html">R markdown documents</a>
    </li>
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Manipulating data tables with dplyr</h1>

</div>


<div style="color:#ff7535; background-color:#fff0ee ;   border-left-style: solid">
<p>This tutorial makes use of the following R package(s): <strong><code>dplyr</code></strong>, <strong><code>lubridate</code></strong> and <strong><code>forcats</code></strong>.</p>
</div>
<p>The data file <em>FAO_grains_NA.csv</em> will be used in this exercise. This dataset consists of grain yield and harvest year by North American country. The dataset was downloaded from <a href="http://faostat3.fao.org/" class="uri">http://faostat3.fao.org/</a> in June of 2014.</p>
<p>Run the following line to load the FAO data file into your current R session.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/FAO_grains_NA.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</code></pre></div>
<div id="the-dplyr-basics" class="section level1">
<h1>The <code>dplyr</code> basics</h1>
<p>The basic set of R tools can accomplish many data table queries, but the syntax can be overwhelming and verbose. The package <code>dplyr</code> offers some nifty and simple querying functions as shown in the next subsections. Some of <code>dplyr</code>’s key data manipulation functions are summarized in the following table:</p>
<table>
<thead>
<tr class="header">
<th><code>dplyr</code> function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter()</code></td>
<td>Subset by row values</td>
</tr>
<tr class="even">
<td><code>arrange()</code></td>
<td>Sort rows by column values</td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td>Subset columns</td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>Add columns</td>
</tr>
<tr class="odd">
<td><code>summarise()</code></td>
<td>Summarize columns</td>
</tr>
</tbody>
</table>
<p>Note that all of these functions take as first argument the data table name except when used in a piping operation (pipes will be discussed later in this section). For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># When used alone, dataframe dat is inside the select function</span>
dat2 &lt;-<span class="st"> </span><span class="kw">select</span>(dat, column1)

<span class="co"># When used in a pipe, dataframe dat is outside of the select function</span>
dat2 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(column1)</code></pre></div>
<p>Make sure to load the <code>dplyr</code> package before proceeding with the following examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<div id="subset-by-rows-filter" class="section level2">
<h2>Subset by rows: <code>filter</code></h2>
<p>Tables can be subsetted by rows based on column values. For example, we may wish to grab all rows associated with <code>Oats</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.query1 &lt;-<span class="st"> </span><span class="kw">filter</span>(dat, Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>)
<span class="kw">summary</span>(dat.query1)</code></pre></div>
<pre><code>                     Country              Crop                  Information 
 Canada                  :104   Oats        :208   Area harvested (Ha):104  
 United States of America:104   Barley      :  0   Yield (Hg/Ha)      :104  
                                Buckwheat   :  0                            
                                Canary seed :  0                            
                                Grain, mixed:  0                            
                                Maize       :  0                            
                                (Other)     :  0                            
      Year          Value        
 Min.   :1961   Min.   :  12667  
 1st Qu.:1974   1st Qu.:  20392  
 Median :1986   Median : 204821  
 Mean   :1986   Mean   :1350024  
 3rd Qu.:1999   3rd Qu.:1638250  
 Max.   :2012   Max.   :9666550  
                                 
                                      Source   
 Calculated data                         :104  
 FAO data based on imputation methodology:  0  
 FAO estimate                            :  0  
 Official data                           :104  
                                               
                                               
                                               </code></pre>
<p>Note that R is case sensitive, so make sure that you respect each letter’s case (i.e. upper or lower).</p>
<p>We can expand our query by including both <code>Oats</code>, <code>Buckwheat</code> and limiting the country to <code>Canada</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.query2 &lt;-<span class="st"> </span><span class="kw">filter</span>(dat, Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span> <span class="op">|</span><span class="st"> </span>Crop <span class="op">==</span><span class="st"> &quot;Buckwheat&quot;</span>, 
                          Country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>)
<span class="kw">summary</span>(dat.query2)</code></pre></div>
<pre><code>                     Country              Crop                  Information 
 Canada                  :200   Oats        :104   Area harvested (Ha):101  
 United States of America:  0   Buckwheat   : 96   Yield (Hg/Ha)      : 99  
                                Barley      :  0                            
                                Canary seed :  0                            
                                Grain, mixed:  0                            
                                Maize       :  0                            
                                (Other)     :  0                            
      Year          Value                                              Source  
 Min.   :1961   Min.   :      0   Calculated data                         :99  
 1st Qu.:1973   1st Qu.:  11822   FAO data based on imputation methodology: 0  
 Median :1986   Median :  22197   FAO estimate                            : 2  
 Mean   :1986   Mean   : 504098   Official data                           :99  
 3rd Qu.:1998   3rd Qu.: 924675                                                
 Max.   :2012   Max.   :4277000                                                
                                                                               </code></pre>
<p>The character <code>|</code> is the Boolean operator OR. So in our example, the query can be read as “… crop equals oats OR crop equals buckwheat”. Had we used the AND operator, <code>&amp;</code>, instead as in <code>Crop == &quot;Oats&quot; &amp; Crop == &quot;Buckwheat&quot;</code> the output would have returned zero rows since a <code>Crop</code> value cannot be both <code>Oats</code> AND <code>Buckwheat</code>.</p>
<p>We can expand this query by limiting our output to the years 2005 to 2010</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
dat.query3 &lt;-<span class="st"> </span><span class="kw">filter</span>(dat, Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span> <span class="op">|</span><span class="st"> </span>Crop <span class="op">==</span><span class="st"> &quot;Buckwheat&quot;</span>, 
                          Country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>, 
                          Year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2005</span> <span class="op">&amp;</span><span class="st"> </span>Year <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2010</span>)
<span class="kw">summary</span>(dat.query3)</code></pre></div>
<pre><code>                     Country             Crop                 Information
 Canada                  :18   Oats        :12   Area harvested (Ha):9   
 United States of America: 0   Buckwheat   : 6   Yield (Hg/Ha)      :9   
                               Barley      : 0                           
                               Canary seed : 0                           
                               Grain, mixed: 0                           
                               Maize       : 0                           
                               (Other)     : 0                           
      Year          Value                                              Source 
 Min.   :2005   Min.   :   2000   Calculated data                         :9  
 1st Qu.:2006   1st Qu.:  11500   FAO data based on imputation methodology:0  
 Median :2007   Median :  26615   FAO estimate                            :0  
 Mean   :2007   Mean   : 453810   Official data                           :9  
 3rd Qu.:2008   3rd Qu.: 961825                                               
 Max.   :2010   Max.   :1815700                                               
                                                                              </code></pre>
<p>Note the use of the AND Boolean operator (<code>&amp;</code>) instead of the OR operator (<code>|</code>) for the <code>Year</code> query. We want the <code>Year</code> value to satisfy two criteria simultaneously: <em>greater than or equal to 2005</em> <strong>AND</strong> <em>less than or equal to 2010</em>. Had we used the <code>|</code> operator, R would have returned all years since all year values satisfy at least one of the two criterion.</p>
</div>
<div id="sort-rows-by-column-value-arrange" class="section level2">
<h2>Sort rows by column value: <code>arrange</code></h2>
<p>You can sort a table based on a column’s values. For example, to sort <code>dat</code> by crop name type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.sort1 &lt;-<span class="st"> </span><span class="kw">arrange</span>(dat, Crop)
<span class="kw">head</span>(dat.sort1)</code></pre></div>
<pre><code>                   Country   Crop         Information Year      Value
1                   Canada Barley Area harvested (Ha) 2012 2060000.00
2                   Canada Barley       Yield (Hg/Ha) 2012   38894.66
3 United States of America Barley Area harvested (Ha) 2012 1312810.00
4 United States of America Barley       Yield (Hg/Ha) 2012   36533.24
5                   Canada Barley Area harvested (Ha) 2011 2364800.00
6                   Canada Barley       Yield (Hg/Ha) 2011   32796.43
           Source
1   Official data
2 Calculated data
3   Official data
4 Calculated data
5   Official data
6 Calculated data</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(dat.sort1)</code></pre></div>
<pre><code>     Country      Crop         Information Year    Value
1496  Canada Triticale Area harvested (Ha) 1991  1093.00
1497  Canada Triticale       Yield (Hg/Ha) 1991 21957.91
1498  Canada Triticale Area harvested (Ha) 1990  1074.00
1499  Canada Triticale       Yield (Hg/Ha) 1990 26396.65
1500  Canada Triticale Area harvested (Ha) 1989  1093.00
1501  Canada Triticale       Yield (Hg/Ha) 1989 21957.91
                                       Source
1496                            Official data
1497                          Calculated data
1498 FAO data based on imputation methodology
1499                          Calculated data
1500                             FAO estimate
1501                          Calculated data</code></pre>
<p>By default, <code>arrange</code> sorts by ascending order. To sort by descending order, wrap the column name with the function <code>desc()</code>. For example, to sort the table by <code>Crop</code> in ascending order then by <code>Year</code> in descending order, type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.sort2 &lt;-<span class="st"> </span><span class="kw">arrange</span>(dat, Crop, <span class="kw">desc</span>(Year))
<span class="kw">head</span>(dat.sort2)</code></pre></div>
<pre><code>                   Country   Crop         Information Year      Value
1                   Canada Barley Area harvested (Ha) 2012 2060000.00
2                   Canada Barley       Yield (Hg/Ha) 2012   38894.66
3 United States of America Barley Area harvested (Ha) 2012 1312810.00
4 United States of America Barley       Yield (Hg/Ha) 2012   36533.24
5                   Canada Barley Area harvested (Ha) 2011 2364800.00
6                   Canada Barley       Yield (Hg/Ha) 2011   32796.43
           Source
1   Official data
2 Calculated data
3   Official data
4 Calculated data
5   Official data
6 Calculated data</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(dat.sort2)</code></pre></div>
<pre><code>     Country      Crop         Information Year    Value
1496  Canada Triticale Area harvested (Ha) 1991  1093.00
1497  Canada Triticale       Yield (Hg/Ha) 1991 21957.91
1498  Canada Triticale Area harvested (Ha) 1990  1074.00
1499  Canada Triticale       Yield (Hg/Ha) 1990 26396.65
1500  Canada Triticale Area harvested (Ha) 1989  1093.00
1501  Canada Triticale       Yield (Hg/Ha) 1989 21957.91
                                       Source
1496                            Official data
1497                          Calculated data
1498 FAO data based on imputation methodology
1499                          Calculated data
1500                             FAO estimate
1501                          Calculated data</code></pre>
</div>
<div id="subset-by-column-select" class="section level2">
<h2>Subset by column: <code>select</code></h2>
<p>You can grab a subset of the table by column(s). To extract the columns <code>Crop</code>, <code>Year</code> and <code>Value</code>, type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.subcol &lt;-<span class="st"> </span><span class="kw">select</span>(dat, Crop, Year, Value)
<span class="kw">head</span>(dat.subcol, <span class="dv">2</span>)</code></pre></div>
<pre><code>    Crop Year      Value
1 Barley 2012 2060000.00
2 Barley 2012   38894.66</code></pre>
<p>If you want all columns <em>other</em> than <code>Crop</code>, <code>Year</code> and <code>Value</code>, add the negative <code>-</code> symbol before the column name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.subcol &lt;-<span class="st"> </span><span class="kw">select</span>(dat, <span class="op">-</span>Crop, <span class="op">-</span>Year, <span class="op">-</span>Value)
<span class="kw">head</span>(dat.subcol, <span class="dv">2</span>)</code></pre></div>
<pre><code>  Country         Information          Source
1  Canada Area harvested (Ha)   Official data
2  Canada       Yield (Hg/Ha) Calculated data</code></pre>
</div>
<div id="creating-andor-calculating-column-values-mutate" class="section level2">
<h2>Creating and/or calculating column values: <code>mutate</code></h2>
<p>You can add columns (and compute their values) using the <code>mutate</code> function. For example, to add a column <code>Ctr_abbr</code> and assign it the abbreviated values <code>CAN</code> for Canada and <code>USA</code> for the United States of America based on the values in column <code>Country</code> type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.extended &lt;-<span class="st"> </span><span class="kw">mutate</span>(dat, <span class="dt">Ctr_abbr =</span> <span class="kw">ifelse</span>(Country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>, <span class="st">&quot;CAN&quot;</span>, <span class="st">&quot;USA&quot;</span>))
<span class="kw">head</span>(dat.extended,<span class="dv">3</span>)</code></pre></div>
<pre><code>  Country      Crop         Information Year      Value          Source
1  Canada    Barley Area harvested (Ha) 2012 2060000.00   Official data
2  Canada    Barley       Yield (Hg/Ha) 2012   38894.66 Calculated data
3  Canada Buckwheat Area harvested (Ha) 2012       0.00    FAO estimate
  Ctr_abbr
1      CAN
2      CAN
3      CAN</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(dat.extended,<span class="dv">3</span>)</code></pre></div>
<pre><code>                      Country    Crop         Information Year      Value
1499 United States of America     Rye       Yield (Hg/Ha) 1961   11121.79
1500 United States of America Sorghum Area harvested (Ha) 1961 4445000.00
1501 United States of America Sorghum       Yield (Hg/Ha) 1961   27442.07
              Source Ctr_abbr
1499 Calculated data      USA
1500   Official data      USA
1501 Calculated data      USA</code></pre>
<p>Here, we make use of an embedded function, <code>ifelse</code>, which performs a conditional operation: if the <code>Country</code> value is <code>Canada</code> return <code>CAN</code> if not, return <code>USA</code>.</p>
<p>Note that if you wish to <em>rename</em> a column, you can use the <code>rename()</code> function instead of <code>mutate</code>.</p>
<p>You can also use <code>mutate</code> to recompute column values. For example, to replace the <code>Country</code> column values with <code>CAN</code> or <code>USA</code> type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.overwrite &lt;-<span class="st"> </span><span class="kw">mutate</span>(dat, <span class="dt">Country =</span> <span class="kw">ifelse</span>(Country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>, <span class="st">&quot;CAN&quot;</span>, <span class="st">&quot;USA&quot;</span>))
<span class="kw">head</span>(dat.overwrite,<span class="dv">3</span>)</code></pre></div>
<pre><code>  Country      Crop         Information Year      Value          Source
1     CAN    Barley Area harvested (Ha) 2012 2060000.00   Official data
2     CAN    Barley       Yield (Hg/Ha) 2012   38894.66 Calculated data
3     CAN Buckwheat Area harvested (Ha) 2012       0.00    FAO estimate</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(dat.overwrite,<span class="dv">3</span>)</code></pre></div>
<pre><code>     Country    Crop         Information Year      Value          Source
1499     USA     Rye       Yield (Hg/Ha) 1961   11121.79 Calculated data
1500     USA Sorghum Area harvested (Ha) 1961 4445000.00   Official data
1501     USA Sorghum       Yield (Hg/Ha) 1961   27442.07 Calculated data</code></pre>
</div>
<div id="creating-andor-calculating-values-across-muliple-columns-mutate_at" class="section level2">
<h2>Creating and/or calculating values across muliple columns: <code>mutate_at</code></h2>
<p>You might find yourself wanting to apply a same set of <em>mutate</em> operations across multiple variables. For example, given the following sample dataset,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">met &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Wind =</span> <span class="kw">c</span>(<span class="fl">3.4</span>, <span class="fl">5.0</span>, <span class="dv">99</span>, <span class="fl">4.1</span>, <span class="fl">1.5</span>),
                  <span class="dt">Dir  =</span> <span class="kw">c</span>(<span class="dv">181</span>, <span class="dv">220</span>, <span class="dv">15</span>,  <span class="dv">15</span>,  <span class="dv">99</span> ),
                  <span class="dt">Prec =</span> <span class="kw">c</span>(<span class="dv">99</span> , <span class="fl">0.5</span>,  <span class="dv">0</span>,  <span class="dv">99</span>,  <span class="dv">99</span>))
met</code></pre></div>
<pre><code>  Wind Dir Prec
1  3.4 181 99.0
2  5.0 220  0.5
3 99.0  15  0.0
4  4.1  15 99.0
5  1.5  99 99.0</code></pre>
<p>where the value <code>99</code> is a placeholder for a missing value for the variables <code>Wind</code> and <code>Prec</code> but a valid value for <code>Dir</code>, we want to replace all missing values with <code>NA</code>. We could either create two mutate operations as in,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">met2 &lt;-<span class="st"> </span><span class="kw">mutate</span>( met, <span class="dt">Wind =</span> <span class="kw">ifelse</span>(Wind <span class="op">==</span><span class="st"> </span><span class="dv">99</span>, <span class="ot">NA</span>, Wind),
                     <span class="dt">Prec =</span> <span class="kw">ifelse</span>(Prec <span class="op">==</span><span class="st"> </span><span class="dv">99</span>, <span class="ot">NA</span>, Prec))
met2</code></pre></div>
<pre><code>  Wind Dir Prec
1  3.4 181   NA
2  5.0 220  0.5
3   NA  15  0.0
4  4.1  15   NA
5  1.5  99   NA</code></pre>
<p>or, we could reduce the separate <code>mutate</code> operations into a single <code>mutate_at</code> operation,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">met2 &lt;-<span class="st"> </span><span class="kw">mutate_at</span>( met, <span class="kw">vars</span>(Wind, Prec),
                        <span class="kw">list</span>(<span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>( . <span class="op">==</span><span class="st"> </span><span class="dv">99</span>, <span class="ot">NA</span>, .)))
met2</code></pre></div>
<pre><code>  Wind Dir Prec
1  3.4 181   NA
2  5.0 220  0.5
3   NA  15  0.0
4  4.1  15   NA
5  1.5  99   NA</code></pre>
<p>The dot <code>.</code> is a placeholder for each column listed in the <code>list()</code> function. Also, note the <code>~</code> operator in lieu of <code>. =</code>.</p>
</div>
<div id="summarize-columns-summarise" class="section level2">
<h2>Summarize columns: <code>summarise</code></h2>
<p>You can summarize (or “collapse”) one or more columns using the <code>summarise</code> function. For instance, to get the minimum and maximum years from the <code>Year</code> column, type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(dat, <span class="dt">yr_min =</span> <span class="kw">min</span>(Year), <span class="dt">yr_max=</span><span class="kw">max</span>(Year))</code></pre></div>
<pre><code>  yr_min yr_max
1   1961   2012</code></pre>
</div>
</div>
<div id="combining-table-manipulation-functions-using" class="section level1">
<h1>Combining table manipulation functions using <code>%&gt;%</code></h1>
<p>In most cases, you will find yourself wanting to combine several of <code>dplyr</code>’s data manipulation functions. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.yield  &lt;-<span class="st"> </span><span class="kw">filter</span>(dat, Information <span class="op">==</span><span class="st"> &quot;Yield (Hg/Ha)&quot;</span>, 
                          Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>,
                          Year <span class="op">==</span><span class="st"> </span><span class="dv">2012</span>)
dat.rename &lt;-<span class="st"> </span><span class="kw">mutate</span>(dat.yield, <span class="dt">Country =</span> <span class="kw">ifelse</span>(Country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>, <span class="st">&quot;CAN&quot;</span>, <span class="st">&quot;USA&quot;</span>))
dat.final  &lt;-<span class="st"> </span><span class="kw">select</span>(dat.rename, Country, Value)

<span class="kw">head</span>(dat.final, <span class="dv">3</span>)</code></pre></div>
<pre><code>  Country    Value
1     CAN 24954.79
2     USA 21974.70</code></pre>
<p>The downside to this approach is the creation of several intermediate objects (e.g. <code>dat.yield</code> and <code>dat.rename</code>). This can make the workflow difficult to follow and clutter your R session with needless intermediate objects.</p>
<p>Another approach to combining <code>dplyr</code> operations is to use the <strong>piping operator</strong> ,<code>%&gt;%</code>, which daisy chains <code>dplyr</code> operations. So our previous workflow could look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat.final &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Information <span class="op">==</span><span class="st"> &quot;Yield (Hg/Ha)&quot;</span>, 
         Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>,
         Year <span class="op">==</span><span class="st"> </span><span class="dv">2012</span>)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Country =</span> <span class="kw">ifelse</span>(Country <span class="op">==</span><span class="st"> &quot;Canada&quot;</span>, <span class="st">&quot;CAN&quot;</span>, <span class="st">&quot;USA&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Country, Value)

<span class="kw">head</span>(dat.final, <span class="dv">3</span>)</code></pre></div>
<pre><code>  Country    Value
1     CAN 24954.79
2     USA 21974.70</code></pre>
<p>The chunk of code can be read as <em>“… with the <code>dat</code> table, <code>filter</code> by …, then <code>mutate</code> …., then <code>select</code> …”</em> with the result from one operation being passed on to the next using the <code>%&gt;%</code> operator. Note that the <code>filter</code>, <code>mutate</code> and <code>select</code> functions do not include the data table name making the chunk of code less cluttered and easier to read. The input data table <code>dat</code> appears just once at the beginning of the pipe.</p>
</div>
<div id="conditional-statements" class="section level1">
<h1>Conditional statements</h1>
<div id="the-base-ifelse" class="section level2">
<h2>The base <code>ifelse</code></h2>
<p>Conditional statements are used when you want to create an output value that is conditioned on an evaluation. For example, if you want to output a value of <code>1</code> <em>if</em> an input value is less than <code>23</code> and a value of <code>0</code> otherwise, you can make use of the <code>ifelse</code> function as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">12</span>,<span class="dv">102</span>, <span class="dv">43</span>, <span class="dv">20</span>, <span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">6</span>)
<span class="kw">ifelse</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">23</span>, <span class="dv">1</span>, <span class="dv">0</span>)</code></pre></div>
<pre><code>[1] 1 0 0 1 0 1 1 1</code></pre>
<p>The base <code>ifelse</code> function works as expected when the input/output values are numeric or character, but does not work as expected when applied to factors or dates. For example, if you wish to replace one factor level with another, the following example will not return the expected output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">as.factor</span>( <span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;apple&quot;</span>))
<span class="kw">ifelse</span>(x <span class="op">==</span><span class="st"> &quot;pear&quot;</span>, <span class="st">&quot;apple&quot;</span>, x)</code></pre></div>
<pre><code>[1] &quot;1&quot;     &quot;2&quot;     &quot;2&quot;     &quot;apple&quot; &quot;1&quot;    </code></pre>
<p>The output is a character representation of the level number (recall that factors encode level values as numbers behind the scenes, i.e. <code>apple</code> =1, <code>banana</code>=2, etc…). Likewise, if you wish to replace an erroneous date with a missing value you will get:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lubridate)
y &lt;-<span class="st"> </span><span class="kw">mdy</span>(<span class="st">&quot;1/23/2016&quot;</span>, <span class="st">&quot;3/2/2016&quot;</span>, <span class="st">&quot;12/1/1901&quot;</span>, <span class="st">&quot;11/23/2016&quot;</span>)
<span class="kw">ifelse</span>( <span class="kw">year</span>(y) <span class="op">!=</span><span class="st"> </span><span class="dv">2016</span>, <span class="ot">NA</span>, y)</code></pre></div>
<pre><code>[1] 16823 16862    NA 17128</code></pre>
<p>Here, <code>ifelse</code> converts the date object to its internal numeric representation as number of days since 1970.</p>
<p>If you want to ensure that the data type is preserved, a safer alternative is to use <code>dplyr</code>’s <code>if_else</code> function.</p>
</div>
<div id="dplyrs-if_else" class="section level2">
<h2><code>dplyr</code>’s <code>if_else</code></h2>
<p>The <code>if_else</code> function (note the underscore <code>_</code>), will preserve data type but does so strictly. For example, the following code will return an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">if_else</span>( <span class="kw">year</span>(y) <span class="op">!=</span><span class="st"> </span><span class="dv">2016</span>, <span class="ot">NA</span>, y)</code></pre></div>
<pre><code>Error: `false` must be type logical, not double</code></pre>
<p>The output data types (<code>NA</code> and <code>y</code>) are not treated the same (by seeing <code>NA</code>, the function assumes that the output must be logical which <code>y</code> is not). The solution is to force <code>NA</code> as a <em>date</em> object by wrapping it with a date function like <code>mdy(NA)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">if_else</span>( <span class="kw">year</span>(y) <span class="op">!=</span><span class="st"> </span><span class="dv">2016</span>, <span class="kw">mdy</span>(<span class="ot">NA</span>), y)</code></pre></div>
<pre><code>[1] &quot;2016-01-23&quot; &quot;2016-03-02&quot; NA           &quot;2016-11-23&quot;</code></pre>
<p>Likewise, if the input vector is of type character, you need to ensure that all output values are characters too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;apple&quot;</span>)
<span class="kw">if_else</span>( y <span class="op">==</span><span class="st"> &quot;banana&quot;</span>, <span class="kw">as.character</span>(<span class="ot">NA</span>), y)</code></pre></div>
<pre><code>[1] &quot;apple&quot; NA      NA      &quot;pear&quot;  &quot;apple&quot;</code></pre>
<p>Recall from the Week 02 lecture notes that R has several <code>NA</code> reserved words for different data types (e.g. <code>NA_character_</code> and <code>NA_integer_</code> to name a few). So the last chunk of code could have been written as,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">if_else</span>( y <span class="op">==</span><span class="st"> &quot;banana&quot;</span>, <span class="ot">NA_character_</span>, y)</code></pre></div>
<pre><code>[1] &quot;apple&quot; NA      NA      &quot;pear&quot;  &quot;apple&quot;</code></pre>
<p>Note that there is no reserved word for <code>NA</code> <em>date</em> types in which case you would coerce <code>NA</code> to date using built-in functions like <code>as.Date(NA)</code> or lubridate functions like <code>mdy(NA)</code> as demonstrated in an earlier example.</p>
</div>
<div id="recoding-factors-using-recode" class="section level2">
<h2>Recoding factors using <code>recode</code></h2>
<p>When working with factors, however, <code>if_else</code> (as of <code>dplyr</code> version <code>0.7</code>) will produce the following error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">if_else</span>(x <span class="op">==</span><span class="st"> &quot;pear&quot;</span>, <span class="st">&quot;apple&quot;</span>, x)</code></pre></div>
<pre><code>Error: `false` must be type character, not integer</code></pre>
<p>R sees <code>apple</code> as a character and <code>x</code> as a number (i.e. the numeric representation of the factor level). A better option for recoding factors is to use <code>dplyr</code>’s <code>recode</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x , <span class="st">&quot;pear&quot;</span> =<span class="st"> &quot;apple&quot;</span>)</code></pre></div>
<pre><code>[1] apple  banana banana apple  apple 
Levels: apple banana</code></pre>
<p>You can recode more than one factor level. In fact, you can even introduce new levels in the recoding scheme:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x , <span class="st">&quot;pear&quot;</span> =<span class="st"> &quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span> =<span class="st"> &quot;pineapple&quot;</span> )</code></pre></div>
<pre><code>[1] apple     pineapple pineapple apple     apple    
Levels: apple pineapple</code></pre>
<p>As with <code>if_else</code> and <code>case_when</code>, <code>recode</code> is strict about preserving data types. So if you want to recode a level to <code>NA</code> make sure to use <code>NA_character_</code> or <code>as.character(NA)</code>.</p>
<p>Note that <code>recode</code> can also be used with numeric and character data types. For example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Example of recoding a character vector</span>
<span class="kw">recode</span>(y , <span class="st">&quot;pear&quot;</span> =<span class="st"> &quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span> =<span class="st"> &quot;pineapple&quot;</span> )</code></pre></div>
<pre><code>[1] &quot;apple&quot;     &quot;pineapple&quot; &quot;pineapple&quot; &quot;apple&quot;     &quot;apple&quot;    </code></pre>
<div id="note-on-replacing-na-factor-levels" class="section level3">
<h3>Note on replacing NA factor levels</h3>
<p>One operation you cannot perform with <code>recode</code> is converting an <code>NA</code> level to another factor level. For example, the following will generate an error message:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
x</code></pre></div>
<pre><code>[1] apple  &lt;NA&gt;   banana pear   apple 
Levels: apple banana pear</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="dt">NA =</span> <span class="st">&quot;other&quot;</span>)</code></pre></div>
<pre><code>Error: unexpected &#39;=&#39; in &quot;recode(x, NA =&quot;</code></pre>
<p>The simplest solution is to make use of a specialized factor package called <code>forcats</code> and its function, <code>fct_explicit_na</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forcats)
x &lt;-<span class="st"> </span><span class="kw">fct_explicit_na</span>(x, <span class="dt">na_level =</span> <span class="st">&quot;Other&quot;</span>)
x</code></pre></div>
<pre><code>[1] apple  Other  banana pear   apple 
Levels: apple banana pear Other</code></pre>
</div>
</div>
<div id="changing-values-based-on-multiple-conditions-case_when" class="section level2">
<h2>Changing values based on multiple conditions: <code>case_when</code></h2>
<p><code>ifelse</code> and <code>if_else</code> work great when a single set of conditions is to be satisfied. But if multiple sets of conditions are to be tested, nested if/else statements become cumbersome and are prone to clerical error. The following code highlights an example of nested if/else statements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unit &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>,<span class="st">&quot;F&quot;</span>,<span class="st">&quot;C&quot;</span>, <span class="st">&quot;K&quot;</span>)
<span class="kw">if_else</span>( unit <span class="op">==</span><span class="st"> &quot;C&quot;</span>, <span class="st">&quot;Celsius&quot;</span>, <span class="kw">if_else</span>(unit <span class="op">==</span><span class="st"> &quot;F&quot;</span>, <span class="st">&quot;Fahrenheit&quot;</span>, <span class="st">&quot;Kelvin&quot;</span>))</code></pre></div>
<pre><code>[1] &quot;Fahrenheit&quot; &quot;Fahrenheit&quot; &quot;Celsius&quot;    &quot;Kelvin&quot;    </code></pre>
<p>A simpler solution is to use the <code>recode</code> function discussed in the previous section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(unit, <span class="st">&quot;C&quot;</span> =<span class="st"> &quot;Celsius&quot;</span>,
             <span class="st">&quot;F&quot;</span> =<span class="st"> &quot;Fahrenheit&quot;</span>,
             <span class="st">&quot;K&quot;</span> =<span class="st"> &quot;Kelvin&quot;</span>)</code></pre></div>
<pre><code>[1] &quot;Fahrenheit&quot; &quot;Fahrenheit&quot; &quot;Celsius&quot;    &quot;Kelvin&quot;    </code></pre>
<p><code>recode</code> is well suited for replacing values but it will not allow for more complex operations. For example, given two vectors, <code>unit</code> and <code>temp</code>, we would like to convert all <code>temp</code> values to Fahrenheit by applying a temperature conversion dependent on the <code>unit</code> value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">temp &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">45.2</span>, <span class="fl">56.3</span>, <span class="fl">11.0</span>, <span class="dv">285</span>)</code></pre></div>
<p>This operation is best performed using the <code>case_when</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">case_when</span>(unit <span class="op">==</span><span class="st"> &quot;F&quot;</span> <span class="op">~</span><span class="st"> </span>temp,
          unit <span class="op">==</span><span class="st"> &quot;C&quot;</span> <span class="op">~</span><span class="st"> </span>(temp <span class="op">*</span><span class="st"> </span><span class="dv">9</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="dv">32</span>,
          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>(temp <span class="op">-</span><span class="st"> </span><span class="fl">273.15</span>) <span class="op">*</span><span class="st"> </span><span class="dv">9</span><span class="op">/</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">32</span>)</code></pre></div>
<pre><code>[1] 45.20 56.30 51.80 53.33</code></pre>
<p>The last parameter, <code>TRUE ~</code>, applies to all conditions not satisfied by the previous two conditions (otherwise, not doing so would return <code>NA</code> values).</p>
<p>Note that the order in which these conditions are listed matters since evaluation stops at the first <code>TRUE</code> outcome encountered. So, had the last condition been moved to the top of the stack, all <code>temp</code> values would be assigned the first conversion option.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># What not to do ...</span>
<span class="kw">case_when</span>(<span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>(temp <span class="op">-</span><span class="st"> </span><span class="fl">273.15</span>) <span class="op">*</span><span class="st"> </span><span class="dv">9</span><span class="op">/</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">32</span>,
          unit <span class="op">==</span><span class="st"> &quot;F&quot;</span> <span class="op">~</span><span class="st"> </span>temp,
          unit <span class="op">==</span><span class="st"> &quot;C&quot;</span> <span class="op">~</span><span class="st"> </span>(temp <span class="op">*</span><span class="st"> </span><span class="dv">9</span><span class="op">/</span><span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="dv">32</span>)</code></pre></div>
<pre><code>[1] -378.31 -358.33 -439.87   53.33</code></pre>
<p>As with the <code>if_else</code> function, <code>case_when</code> is strict about data type in that all output must be of the same data type.</p>
<p>Note that <code>ifelse</code>, <code>if_else</code>, <code>recode</code> and <code>case_when</code> can all be used inside of a <code>mutate</code> function. For example, to replace <code>Canada</code> and <code>United States of America</code> in variable <code>Country</code> with <code>CAN</code> and <code>USA</code> respectively and to create a new variable called <code>Type</code> which will take on the values of <code>1</code>, <code>2</code> or <code>3</code> depending on the values in variable <code>Source</code>, type the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Country =</span> <span class="kw">recode</span>(Country, <span class="st">&quot;Canada&quot;</span> =<span class="st"> &quot;CAN&quot;</span>,
                                   <span class="st">&quot;United States of America&quot;</span> =<span class="st"> &quot;USA&quot;</span>),
         <span class="dt">Type =</span> <span class="kw">case_when</span>(Source <span class="op">==</span><span class="st"> &quot;Calculated data&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,
                          Source <span class="op">==</span><span class="st"> &quot;Official data&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,
                          <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>)) 
<span class="kw">head</span>(dat1)   </code></pre></div>
<pre><code>  Country         Crop         Information Year      Value          Source Type
1     CAN       Barley Area harvested (Ha) 2012 2060000.00   Official data    2
2     CAN       Barley       Yield (Hg/Ha) 2012   38894.66 Calculated data    1
3     CAN    Buckwheat Area harvested (Ha) 2012       0.00    FAO estimate    3
4     CAN  Canary seed Area harvested (Ha) 2012  101900.00   Official data    2
5     CAN  Canary seed       Yield (Hg/Ha) 2012   12161.92 Calculated data    1
6     CAN Grain, mixed Area harvested (Ha) 2012   57900.00   Official data    2</code></pre>
</div>
</div>
<div id="miscellaneous" class="section level1">
<h1>Miscellaneous</h1>
<div id="outputting-a-vector-instead-of-a-table-using-pull" class="section level2">
<h2>Outputting a vector instead of a table using <code>pull</code></h2>
<p>Piping operations will output a table, even if a single value is returned. For example, the following summarization operation returns the total oats yield as a data table:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oats &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>,
         Information <span class="op">==</span><span class="st"> &quot;Yield (Hg/Ha)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Oats_sum =</span> <span class="kw">sum</span>(Value))
oats</code></pre></div>
<pre><code>  Oats_sum
1  2169334</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(oats)</code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<p>There may be times when you want to output as a vector element and not a data table. To output a vector, use the <code>pull()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">oats &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>,
         Information <span class="op">==</span><span class="st"> &quot;Yield (Hg/Ha)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Oats_sum =</span> <span class="kw">sum</span>(Value)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>()
oats</code></pre></div>
<pre><code>[1] 2169334</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(oats)</code></pre></div>
<pre><code>[1] &quot;numeric&quot;</code></pre>
<p>The <code>pull</code> function can also be used to convert a data table column to a multi-element vector, e.g.:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This outputs a one column table</span>
yield &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>,
         Information <span class="op">==</span><span class="st"> &quot;Yield (Hg/Ha)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Value)

<span class="kw">head</span>(yield)</code></pre></div>
<pre><code>     Value
1 24954.79
2 21974.70
3 29109.36
4 20492.37
5 27364.53
6 23056.62</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(yield)</code></pre></div>
<pre><code>[1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This outputs a multi-element vector</span>
yield &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Crop <span class="op">==</span><span class="st"> &quot;Oats&quot;</span>,
         Information <span class="op">==</span><span class="st"> &quot;Yield (Hg/Ha)&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(Value)

<span class="kw">head</span>(yield)</code></pre></div>
<pre><code>[1] 24954.79 21974.70 29109.36 20492.37 27364.53 23056.62</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(yield)</code></pre></div>
<pre><code>[1] &quot;numeric&quot;</code></pre>
</div>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2019)
</br>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
