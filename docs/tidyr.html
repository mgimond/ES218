<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploratory Data Analysis in R - 11&nbsp; Tidying/reshaping tables with tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./joins.html" rel="next">
<link href="./group_by.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CJW3PSXZC2"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CJW3PSXZC2', { 'anonymize_ip': true});
</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="libs/style.css">
</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_objects.html">Data manipulation</a></li><li class="breadcrumb-item"><a href="./tidyr.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Tidying/reshaping tables with `tidyr`</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Intro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">EDA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./The_R_environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The R and RStudio Environments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Object Type and Structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./read_write_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reading and Writing Data Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./date_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with string objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boolean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Relational and boolean operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subset_base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Subsetting and replacing values using base functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Manipulating data tables with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./group_by.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Grouping and summarizing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Tidying/reshaping tables with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Joining Data Tables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Plots</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Base plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lattice_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Lattice plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ggplot2 plotting environment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Univariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Visualizing univariate distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_batches.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Comparing data distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theoretical_qq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">The theoretical q-q</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Univariate analysis: Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sl_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Spread-level plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./re_express.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Re-expressing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./letter_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Letter value summaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fine-tuning re-expression and Robust statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Bivariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resistant_lines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Resistant lines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">The third R of EDA: Residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discontinuity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Slicing data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Two-way tables</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./two_way.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Analyzing two-way tables: The median polish</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">R markdown document</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Mapping variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Data used in ES218</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">11.1</span> Introduction</a></li>
  <li><a href="#wide-and-long-table-formats" id="toc-wide-and-long-table-formats" class="nav-link" data-scroll-target="#wide-and-long-table-formats"><span class="header-section-number">11.2</span> Wide and long table formats</a>
  <ul class="collapse">
  <li><a href="#creating-a-long-table-from-a-wide-table" id="toc-creating-a-long-table-from-a-wide-table" class="nav-link" data-scroll-target="#creating-a-long-table-from-a-wide-table"><span class="header-section-number">11.2.1</span> Creating a long table from a wide table</a></li>
  <li><a href="#creating-a-wide-table-from-a-long-table" id="toc-creating-a-wide-table-from-a-long-table" class="nav-link" data-scroll-target="#creating-a-wide-table-from-a-long-table"><span class="header-section-number">11.2.2</span> Creating a wide table from a long table</a></li>
  </ul></li>
  <li><a href="#advanced-pivot_longer-options" id="toc-advanced-pivot_longer-options" class="nav-link" data-scroll-target="#advanced-pivot_longer-options"><span class="header-section-number">11.3</span> Advanced <code>pivot_longer</code> options</a></li>
  <li><a href="#advanced-pivot_wider-options" id="toc-advanced-pivot_wider-options" class="nav-link" data-scroll-target="#advanced-pivot_wider-options"><span class="header-section-number">11.4</span> Advanced <code>pivot_wider</code> options</a>
  <ul class="collapse">
  <li><a href="#combining-variable-names-when-spreading" id="toc-combining-variable-names-when-spreading" class="nav-link" data-scroll-target="#combining-variable-names-when-spreading"><span class="header-section-number">11.4.1</span> Combining variable names when spreading</a></li>
  <li><a href="#spreading-duplicate-variable-combinations" id="toc-spreading-duplicate-variable-combinations" class="nav-link" data-scroll-target="#spreading-duplicate-variable-combinations"><span class="header-section-number">11.4.2</span> Spreading duplicate variable combinations</a></li>
  </ul></li>
  <li><a href="#additional-manipulation-options" id="toc-additional-manipulation-options" class="nav-link" data-scroll-target="#additional-manipulation-options"><span class="header-section-number">11.5</span> Additional manipulation options</a>
  <ul class="collapse">
  <li><a href="#separating-elements-in-one-column-into-separate-columns" id="toc-separating-elements-in-one-column-into-separate-columns" class="nav-link" data-scroll-target="#separating-elements-in-one-column-into-separate-columns"><span class="header-section-number">11.5.1</span> Separating elements in one column into separate columns</a></li>
  <li><a href="#splitting-rows-into-multiple-rows-based-on-delimited-values" id="toc-splitting-rows-into-multiple-rows-based-on-delimited-values" class="nav-link" data-scroll-target="#splitting-rows-into-multiple-rows-based-on-delimited-values"><span class="header-section-number">11.5.2</span> Splitting rows into multiple rows based on delimited values</a></li>
  <li><a href="#replicate-rows-by-count" id="toc-replicate-rows-by-count" class="nav-link" data-scroll-target="#replicate-rows-by-count"><span class="header-section-number">11.5.3</span> Replicate rows by count</a></li>
  <li><a href="#combining-elements-from-many-columns-into-a-single-column" id="toc-combining-elements-from-many-columns-into-a-single-column" class="nav-link" data-scroll-target="#combining-elements-from-many-columns-into-a-single-column"><span class="header-section-number">11.5.4</span> Combining elements from many columns into a single column</a></li>
  <li><a href="#creating-unique-combinations-of-variable-values" id="toc-creating-unique-combinations-of-variable-values" class="nav-link" data-scroll-target="#creating-unique-combinations-of-variable-values"><span class="header-section-number">11.5.5</span> Creating unique combinations of variable values</a></li>
  <li><a href="#expanding-table-with-missing-sets-of-values" id="toc-expanding-table-with-missing-sets-of-values" class="nav-link" data-scroll-target="#expanding-table-with-missing-sets-of-values"><span class="header-section-number">11.5.6</span> Expanding table with missing sets of values</a></li>
  <li><a href="#filling-datetime-gaps-in-a-table" id="toc-filling-datetime-gaps-in-a-table" class="nav-link" data-scroll-target="#filling-datetime-gaps-in-a-table"><span class="header-section-number">11.5.7</span> Filling date/time gaps in a table</a></li>
  <li><a href="#identifying-missing-combination-in-dataframes" id="toc-identifying-missing-combination-in-dataframes" class="nav-link" data-scroll-target="#identifying-missing-combination-in-dataframes"><span class="header-section-number">11.5.8</span> Identifying missing combination in dataframes</a></li>
  <li><a href="#auto-fill-down-or-up" id="toc-auto-fill-down-or-up" class="nav-link" data-scroll-target="#auto-fill-down-or-up"><span class="header-section-number">11.5.9</span> Auto-fill down or up</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Tidying/reshaping tables with <code>tidyr</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-2_78575eae3a77d14774f2ae8f9725e1c3">
<div class="cell-output-display">

<table data-quarto-disable-processing="true" class="table" style="width: auto !important; ">
 <thead>
  <tr>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> tidyr </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.3.0 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="introduction" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">11.1</span> Introduction</h2>
<p>Data tables come in different sizes and shape; they can be a very simple two column dataset or they can consist of many columns and “sub-columns”. Understanding its structure, and learning how to reshape it into a workable form is critical to an effective and error free analysis.</p>
<p>For example, a median earnings data table downloaded from the U.S. census bureau’s website might look something like this:</p>
<p><img src="img/Typical_table.png" class="img-fluid"></p>
<p>We are conditioned to think of a table as consisting of three components: rows, columns and data values. Implicit in this paradigm is that each column represents a unique attribute. However, this may not always be the case. For example, in the above table, each column represents two distinct variables: gender and educational attainment (two distinct sets of attributes).</p>
<p><img src="img/Anatomy_of_a_census_table.png" class="img-fluid"></p>
<p>Another way of describing a dataset is by defining its <strong>variable(s)</strong>, <strong>values</strong> and <strong>observations</strong>. In the above example, we have four variables: gender, education, region and income. Each variable consists of either categorical values (e.g.&nbsp;region, gender and education) or numerical values (income).</p>
<p>An observation consists of a <strong>unique set</strong> of attribute <strong>values</strong>. For example the values <code>West Region</code>, <code>Female</code>, <code>Graduate</code> and <code>$57,914</code> make up <strong>one</strong> observation: there is just one instance of these combined values in the data. This perspective affords us another option in presenting the dataset: we can assign each column its own variable, and each row its own observation.</p>
<p><img src="img/Tidy_census.png" class="img-fluid"></p>
<p>Note that each row of the table is part of a unique set of variable attributes. A dataset in this format may not be human “readable” (unlike its <em>wide</em> counterpart), but is the format of choice for many data analysis and visualization operations.</p>
<p>The next sections will demonstrate how one can convert a wide format to a long format and <em>vice versa</em>.</p>
</section>
<section id="wide-and-long-table-formats" class="level2" data-number="11.2">
<h2 data-number="11.2" class="anchored" data-anchor-id="wide-and-long-table-formats"><span class="header-section-number">11.2</span> Wide and long table formats</h2>
<p>A 2014 Boston (Logan airport) flight data summary table will be used in this exercise. The summary displays average mean delay time (in minutes) by day of the work week and quarter.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-3_a76290fc119bc3feb0b461c1bc704f8a">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Weekday =</span> <span class="fu">c</span>( <span class="st">"Mon"</span>, <span class="st">"Tues"</span>, <span class="st">"Wed"</span>, <span class="st">"Thurs"</span>, <span class="st">"Fri"</span> ),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Q1      =</span> <span class="fu">c</span>(  <span class="fl">9.9</span> ,  <span class="fl">4.9</span>  ,  <span class="fl">8.8</span> ,   <span class="fl">12.2</span> ,  <span class="fl">12.2</span> ),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Q2      =</span> <span class="fu">c</span>(  <span class="fl">5.4</span> ,  <span class="fl">9.7</span>  , <span class="fl">11.1</span> ,   <span class="fl">10.2</span> ,   <span class="fl">8.1</span> ),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Q3      =</span> <span class="fu">c</span>(  <span class="fl">8.8</span> ,  <span class="fl">7.9</span>  , <span class="fl">10.2</span> ,   <span class="fl">9.2</span>  ,   <span class="fl">7.9</span> ),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Q4      =</span> <span class="fu">c</span>(  <span class="fl">6.9</span> ,    <span class="dv">5</span>  ,  <span class="fl">9.3</span> ,   <span class="fl">9.7</span>  ,   <span class="fl">5.6</span> ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Reshaping a table involves modifying its layout (or “shape”). In our example, <code>df</code> is in a “wide” format.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-4_82225e2f830f3ba16a1884b391d8a1f9">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Weekday   Q1   Q2   Q3  Q4
1     Mon  9.9  5.4  8.8 6.9
2    Tues  4.9  9.7  7.9 5.0
3     Wed  8.8 11.1 10.2 9.3
4   Thurs 12.2 10.2  9.2 9.7
5     Fri 12.2  8.1  7.9 5.6</code></pre>
</div>
</div>
<p>There are three unique variables: day of week, quarter of year, and mean departure delay.</p>
<section id="creating-a-long-table-from-a-wide-table" class="level3" data-number="11.2.1">
<h3 data-number="11.2.1" class="anchored" data-anchor-id="creating-a-long-table-from-a-wide-table"><span class="header-section-number">11.2.1</span> Creating a long table from a wide table</h3>
<p>A package that facilitates converting from wide to long (and <em>vice versa</em>) is <code>tidyr</code>. To go from wide to long we use the <code>pivot_longer</code> function. Note that if you are using a version of <code>tidyr</code> older than <code>1.0</code> you will want to use the <code>gather()</code> function..</p>
<p>The <code>pivot_longer</code> function takes three arguments:</p>
<ul>
<li><code>cols</code>: list of columns that are to be collapsed. The columns can be referenced by column number or column name.</li>
<li><code>names_to</code>: This is the name of the new column which will combine all column names (e.g.&nbsp;<code>Q1</code>, <code>Q2</code>, <code>Q3</code> and <code>Q4</code>).</li>
<li><code>values_to</code>: This is the name of the new column which will combine all column values (e.g.&nbsp;average delay times) associated with each variable combination.</li>
</ul>
<p>In our example, the line of code needed to re-express the table into a long form can be written in at least one of four ways:</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-5_91b6099f99f583363c3969d28726b062">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df, <span class="at">cols=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">names_to =</span> <span class="st">"Quarter"</span>, <span class="at">values_to =</span> <span class="st">"Delay"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>df.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df, <span class="at">cols=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">names_to =</span> <span class="st">"Quarter"</span>, <span class="at">values_to =</span> <span class="st">"Delay"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df, <span class="at">cols=</span>Q1<span class="sc">:</span>Q4, <span class="at">names_to =</span> <span class="st">"Quarter"</span>, <span class="at">values_to =</span> <span class="st">"Delay"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>df.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df, <span class="at">cols=</span><span class="fu">c</span>(Q1,Q2,Q3,Q4), <span class="at">names_to =</span> <span class="st">"Quarter"</span>, <span class="at">values_to =</span> <span class="st">"Delay"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All four lines produce the same output, they differ only by how we are referencing the columns that are to be collapsed. Note that we assigned the names <code>Quarter</code> and <code>Delay</code> to the two new columns.</p>
<p>The first 10 lines of the output table are shown here. Note how each <code>Delay</code> value has its own row.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-6_ee6b692e63012bf7b7b0d6377001f125">
<div class="cell-output cell-output-stdout">
<pre><code>   Weekday Quarter Delay
1      Mon      Q1   9.9
2     Tues      Q1   4.9
3      Wed      Q1   8.8
4    Thurs      Q1  12.2
5      Fri      Q1  12.2
6      Mon      Q2   5.4
7     Tues      Q2   9.7
8      Wed      Q2  11.1
9    Thurs      Q2  10.2
10     Fri      Q2   8.1</code></pre>
</div>
</div>
<p>The following figure summarizes the wide to long conversion.</p>
<p><img src="img/Tidyr_wide2long.png" class="img-fluid"></p>
</section>
<section id="creating-a-wide-table-from-a-long-table" class="level3" data-number="11.2.2">
<h3 data-number="11.2.2" class="anchored" data-anchor-id="creating-a-wide-table-from-a-long-table"><span class="header-section-number">11.2.2</span> Creating a wide table from a long table</h3>
<p>If a table is to be used for a visual assessment of the values, a long format may be difficult to work with. A long table can be re-expressed into a wide form by picking the two variables that will define the new column names and values.</p>
<p>Continuing with our example, we will convert <code>df.long</code> back to a wide format using the <code>pivot_wider()</code> function. This replaces the <code>spread()</code> function from earlier versions of tidyr (<code>&lt;1.0</code>). The <code>pivot_wider()</code> function takes at least two arguments:</p>
<ul>
<li><code>names_from</code>: Variable whose values will be converted to column names.</li>
<li><code>values_from</code>: Variable whose values will populate the table’s block of cell values.</li>
</ul>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-7_ee38c36104dd69b8835e816b1e719901">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.wide <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(df.long, <span class="at">names_from =</span> Quarter, <span class="at">values_from =</span> Delay) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ve now recreated the wide version of our table.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-8_97610ed8c9c9075f439b333725404820">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  Weekday    Q1    Q2    Q3    Q4
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Mon       9.9   5.4   8.8   6.9
2 Tues      4.9   9.7   7.9   5  
3 Wed       8.8  11.1  10.2   9.3
4 Thurs    12.2  10.2   9.2   9.7
5 Fri      12.2   8.1   7.9   5.6</code></pre>
</div>
</div>
<p>The following figure summarizes the long to wide conversion.</p>
<img src="img/Tidyr_long2wide.png" class="img-fluid">
<p>
</p></section>
</section>
<section id="advanced-pivot_longer-options" class="level2" data-number="11.3">
<h2 data-number="11.3" class="anchored" data-anchor-id="advanced-pivot_longer-options"><span class="header-section-number">11.3</span> Advanced <code>pivot_longer</code> options</h2>
<p>Here’s a subset of median income by sex and by work experience for 2017.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-9_6dca2fab461733776c40bd2115a11ed2">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">state =</span> <span class="fu">c</span>(<span class="st">"Maine"</span>, <span class="st">"Massachusetts"</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"New Hampshire"</span>, <span class="st">"Vermont"</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">male_fulltime =</span> <span class="fu">c</span>(<span class="dv">50329</span>,<span class="dv">66066</span>, <span class="dv">59962</span>, <span class="dv">50530</span>), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">male_other =</span> <span class="fu">c</span>(<span class="dv">18099</span>, <span class="dv">18574</span>, <span class="dv">20274</span>, <span class="dv">17709</span>), </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">female_fulltime =</span> <span class="fu">c</span>(<span class="dv">40054</span>, <span class="dv">53841</span>, <span class="dv">46178</span>, <span class="dv">42198</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">female_other =</span> <span class="fu">c</span>(<span class="dv">13781</span>, <span class="dv">14981</span>, <span class="dv">15121</span>, <span class="dv">14422</span>))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          state male_fulltime male_other female_fulltime female_other
1         Maine         50329      18099           40054        13781
2 Massachusetts         66066      18574           53841        14981
3 New Hampshire         59962      20274           46178        15121
4       Vermont         50530      17709           42198        14422</code></pre>
</div>
</div>
<p>At first glance, it might seem that we have three variables as in the earlier example, but upon closer examination, we see that we can tease out two variables from the column names: sex (<code>male</code> and <code>female</code>) and work experience (<code>fulltime</code> and <code>other</code>).</p>
<p><img src="img/double_header.PNG" style="width: 73%; height: auto;"></p>
<p><code>pivot_longer</code> has an argument, <code>names_sep</code>, that is passed the character that is used to delimit the two variable values. In our example, this character is <code>_</code>. Since the column values will be split across two variables we will also need to pass <strong>two</strong> column names to the <code>names_to</code> argument.</p>
<p><img src="img/long_to_separate_wide.PNG" style="width: 73%; height: auto;"></p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-10_c57fb28d685b44070dead68794d41197">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df2.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df2, <span class="at">cols =</span> <span class="sc">-</span>state, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"sex"</span>,<span class="st">"work"</span>), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_sep =</span> <span class="st">"_"</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"income"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df2.long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   state         sex    work     income
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
 1 Maine         male   fulltime  50329
 2 Maine         male   other     18099
 3 Maine         female fulltime  40054
 4 Maine         female other     13781
 5 Massachusetts male   fulltime  66066
 6 Massachusetts male   other     18574
 7 Massachusetts female fulltime  53841
 8 Massachusetts female other     14981
 9 New Hampshire male   fulltime  59962
10 New Hampshire male   other     20274
11 New Hampshire female fulltime  46178
12 New Hampshire female other     15121
13 Vermont       male   fulltime  50530
14 Vermont       male   other     17709
15 Vermont       female fulltime  42198
16 Vermont       female other     14422</code></pre>
</div>
</div>
</section>
<section id="advanced-pivot_wider-options" class="level2" data-number="11.4">
<h2 data-number="11.4" class="anchored" data-anchor-id="advanced-pivot_wider-options"><span class="header-section-number">11.4</span> Advanced <code>pivot_wider</code> options</h2>
<p>&nbsp;</p>
<section id="combining-variable-names-when-spreading" class="level3" data-number="11.4.1">
<h3 data-number="11.4.1" class="anchored" data-anchor-id="combining-variable-names-when-spreading"><span class="header-section-number">11.4.1</span> Combining variable names when spreading</h3>
<p>Continuing with the <code>df2.long</code> dataframe, we can spread the long table back to a wide table while combining the <code>sex</code> and <code>work</code> variables. We’ll add the <code>names_sep</code> argument which defines the character to use to separate the two variable names. We’ll use a dot <code>.</code> separator in this example.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-11_bdf6704d5119393ff211e0b20b7e50e0">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(df2.long, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_from =</span> <span class="fu">c</span>(sex,work), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_from =</span> income,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_sep =</span> <span class="st">"."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  state         male.fulltime male.other female.fulltime female.other
  &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;
1 Maine                 50329      18099           40054        13781
2 Massachusetts         66066      18574           53841        14981
3 New Hampshire         59962      20274           46178        15121
4 Vermont               50530      17709           42198        14422</code></pre>
</div>
</div>
</section>
<section id="spreading-duplicate-variable-combinations" class="level3" data-number="11.4.2">
<h3 data-number="11.4.2" class="anchored" data-anchor-id="spreading-duplicate-variable-combinations"><span class="header-section-number">11.4.2</span> Spreading duplicate variable combinations</h3>
<p>If your long table has more than one unique combination of variables, <code>pivot_wider()</code> will return a list. Note that if you have used the older version of <code>tidyr</code> (version <code>&lt;1.0</code>) its <code>spread()</code> function would have returned an error.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-12_47434341543665249e8f2dc350ae7db4">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">var1 =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>),</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"y"</span>),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">val  =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">4</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  var1 var2 val
1    a    x   5
2    a    x   3
3    b    y   1
4    b    y   4</code></pre>
</div>
</div>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-13_d849a01c9d7d550f9ef459834726e4b1">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(df3, <span class="at">names_from =</span> var2, <span class="at">values_from =</span> val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  var1  x         y        
  &lt;chr&gt; &lt;list&gt;    &lt;list&gt;   
1 a     &lt;dbl [2]&gt; &lt;NULL&gt;   
2 b     &lt;NULL&gt;    &lt;dbl [2]&gt;</code></pre>
</div>
</div>
<p>Since the intersections of <code>a</code>:<code>x</code> and <code>b</code>:<code>y</code> each have two possible values, the function returns a <em>list</em> of values. Assuming that the duplicate records are not an erroneous entry, you will need to instruct the function on how to summarize the multiple values using the <code>values_fn</code> argument. For example, to return the maximum value, type:</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-14_c15774728a7e1f9ffbac63d3216f5325">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(df3, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">names_from =</span> var2, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_from =</span> val, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_fn =</span> <span class="fu">list</span>(<span class="at">val =</span> min))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  var1      x     y
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 a         3    NA
2 b        NA     1</code></pre>
</div>
</div>
<p>You’ll note the empty cells resulting from there not being a valid combination for <code>a</code>:<code>y</code> and <code>b</code>:<code>x</code>. You can specify the missing values using the <code>values_fill</code> argument. For example, to replace <code>NA</code> with <code>0</code> type:</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-15_edd8bd5ffec6035d7fc40266324a4f1b">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(df3, <span class="at">names_from =</span> var2, <span class="at">values_from =</span> val, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_fn   =</span> <span class="fu">list</span>(<span class="at">val =</span> min),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">val =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  var1      x     y
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 a         3     0
2 b         0     1</code></pre>
</div>
</div>
</section>
</section>
<section id="additional-manipulation-options" class="level2" data-number="11.5">
<h2 data-number="11.5" class="anchored" data-anchor-id="additional-manipulation-options"><span class="header-section-number">11.5</span> Additional manipulation options</h2>
<p>The <code>tidyr</code> package offers other functions not directly tied to pivoting. Some of these functions are highlihghted next.</p>
<section id="separating-elements-in-one-column-into-separate-columns" class="level3" data-number="11.5.1">
<h3 data-number="11.5.1" class="anchored" data-anchor-id="separating-elements-in-one-column-into-separate-columns"><span class="header-section-number">11.5.1</span> Separating elements in one column into separate columns</h3>
<p>To split a column into two or more columns based on a existing column’s delimited value, use the <code>separate()</code> function.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-16_2567ecd3ae567360abae954f99243834">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's first create a delimited table</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df2.long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(df2, <span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to =</span> <span class="st">"var1"</span>, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">values_to =</span> <span class="st">"income"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>df2.long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   state         var1            income
   &lt;chr&gt;         &lt;chr&gt;            &lt;dbl&gt;
 1 Maine         male_fulltime    50329
 2 Maine         male_other       18099
 3 Maine         female_fulltime  40054
 4 Maine         female_other     13781
 5 Massachusetts male_fulltime    66066
 6 Massachusetts male_other       18574
 7 Massachusetts female_fulltime  53841
 8 Massachusetts female_other     14981
 9 New Hampshire male_fulltime    59962
10 New Hampshire male_other       20274
11 New Hampshire female_fulltime  46178
12 New Hampshire female_other     15121
13 Vermont       male_fulltime    50530
14 Vermont       male_other       17709
15 Vermont       female_fulltime  42198
16 Vermont       female_other     14422</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split var1 column into two columns</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df2.sep <span class="ot">&lt;-</span> <span class="fu">separate</span>(df2.long, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col =</span> var1, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep =</span> <span class="st">"_"</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">"work"</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>df2.sep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   state         sex    work     income
   &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
 1 Maine         male   fulltime  50329
 2 Maine         male   other     18099
 3 Maine         female fulltime  40054
 4 Maine         female other     13781
 5 Massachusetts male   fulltime  66066
 6 Massachusetts male   other     18574
 7 Massachusetts female fulltime  53841
 8 Massachusetts female other     14981
 9 New Hampshire male   fulltime  59962
10 New Hampshire male   other     20274
11 New Hampshire female fulltime  46178
12 New Hampshire female other     15121
13 Vermont       male   fulltime  50530
14 Vermont       male   other     17709
15 Vermont       female fulltime  42198
16 Vermont       female other     14422</code></pre>
</div>
</div>
</section>
<section id="splitting-rows-into-multiple-rows-based-on-delimited-values" class="level3" data-number="11.5.2">
<h3 data-number="11.5.2" class="anchored" data-anchor-id="splitting-rows-into-multiple-rows-based-on-delimited-values"><span class="header-section-number">11.5.2</span> Splitting rows into multiple rows based on delimited values</h3>
<p>To split delimited values across rows, use the <code>separate_rows</code> function.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-17_c2b766792b7b0c5fc12eccc368d4ddeb">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">separate_rows</span>(df2.long, var1, <span class="at">sep =</span> <span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 3
   state         var1     income
   &lt;chr&gt;         &lt;chr&gt;     &lt;dbl&gt;
 1 Maine         male      50329
 2 Maine         fulltime  50329
 3 Maine         male      18099
 4 Maine         other     18099
 5 Maine         female    40054
 6 Maine         fulltime  40054
 7 Maine         female    13781
 8 Maine         other     13781
 9 Massachusetts male      66066
10 Massachusetts fulltime  66066
# ℹ 22 more rows</code></pre>
</div>
</div>
<p>Note that the output is a <code>tibble</code> even if the input is a dataframe.</p>
</section>
<section id="replicate-rows-by-count" class="level3" data-number="11.5.3">
<h3 data-number="11.5.3" class="anchored" data-anchor-id="replicate-rows-by-count"><span class="header-section-number">11.5.3</span> Replicate rows by count</h3>
<p>You can expand rows based on a count column using the <code>uncount()</code> function. This is the opposite of a <code>group_by(...) %&gt;% count()</code> operation that tallies up the observations based on a grouping variable. Here, we’ll replicate rows based on the column <code>count</code> value.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-18_393585e62d9a397df1ac857cb3213097">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df2b <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">var1 =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">var2 =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">count =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>df2b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  var1 var2 count
1    a    x     1
2    b    y     3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">uncount</span>(df2b, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  var1 var2
1    a    x
2    b    y
3    b    y
4    b    y</code></pre>
</div>
</div>
<p>If you want to add an index column that identifies the replicated rows, add an <code>.id</code> argument.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-19_a9cf5da219a519ffe007deb194b6aa3c">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">uncount</span>(df2b, count, <span class="at">.id =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  var1 var2 id
1    a    x  1
2    b    y  1
3    b    y  2
4    b    y  3</code></pre>
</div>
</div>
</section>
<section id="combining-elements-from-many-columns-into-a-single-column" class="level3" data-number="11.5.4">
<h3 data-number="11.5.4" class="anchored" data-anchor-id="combining-elements-from-many-columns-into-a-single-column"><span class="header-section-number">11.5.4</span> Combining elements from many columns into a single column</h3>
<p>Another practical function in the <code>tidyr</code> package is <code>unite()</code>. It combines columns into a single column by chaining the contents of the combined columns. For example, the following table has hours, minutes and seconds in separate columns.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-20_b1057593205be3af75f17841e16d3147">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">Index =</span> <span class="fu">c</span>(<span class="dv">1</span>,   <span class="dv">2</span>,  <span class="dv">3</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">Hour  =</span> <span class="fu">c</span>(<span class="dv">2</span>,  <span class="dv">14</span>, <span class="dv">20</span>),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min   =</span> <span class="fu">c</span>(<span class="dv">34</span>,  <span class="dv">2</span>, <span class="dv">55</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">Sec   =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">17</span>, <span class="dv">23</span>))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Index Hour Min Sec
1     1    2  34  55
2     2   14   2  17
3     3   20  55  23</code></pre>
</div>
</div>
<p>To combine the three time elements into a single column, type:</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-21_a28bacfa6290d39a806a80997424d6b2">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">unite</span>(df,  <span class="at">col =</span> Time, <span class="fu">c</span>(Hour, Min, Sec) , <span class="at">sep=</span><span class="st">":"</span>, <span class="at">remove =</span><span class="cn">TRUE</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Index     Time
1     1  2:34:55
2     2  14:2:17
3     3 20:55:23</code></pre>
</div>
</div>
<p>The <code>col</code> parameter defines the new column name; the parameter <code>c(Hour, Min, Sec)</code> defines the columns to be combined into column <code>Time</code>; <code>sep=":"</code> tells the function what characters are to be used to separate the elements (here, we are separating the time elements using <code>:</code>); <code>remove=TRUE</code> tells the function to remove columns two through four.</p>
</section>
<section id="creating-unique-combinations-of-variable-values" class="level3" data-number="11.5.5">
<h3 data-number="11.5.5" class="anchored" data-anchor-id="creating-unique-combinations-of-variable-values"><span class="header-section-number">11.5.5</span> Creating unique combinations of variable values</h3>
<p>You can use <code>expand_grid</code> to automatically generate a table with unique combinations of a set of variable values. For example, to fill a table with a combination of student names and homework assignments, type:</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-22_ec12ec75ab8fdfa0e6011b1e762776f0">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df3.long <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">student    =</span> <span class="fu">c</span>(<span class="st">"Joe"</span>, <span class="st">"Jane"</span>, <span class="st">"Kim"</span>),  <span class="co"># Define all unique student names</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">assignment =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"HW"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)),     <span class="co"># Define all unique HW assignments</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value      =</span> <span class="cn">NA</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>df3.long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   student assignment value
   &lt;chr&gt;   &lt;chr&gt;      &lt;lgl&gt;
 1 Joe     HW1        NA   
 2 Joe     HW2        NA   
 3 Joe     HW3        NA   
 4 Joe     HW4        NA   
 5 Jane    HW1        NA   
 6 Jane    HW2        NA   
 7 Jane    HW3        NA   
 8 Jane    HW4        NA   
 9 Kim     HW1        NA   
10 Kim     HW2        NA   
11 Kim     HW3        NA   
12 Kim     HW4        NA   </code></pre>
</div>
</div>
<p>We can then create a wide version of the table using <code>pivot_wider</code>.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-23_b58541e90b8715c5ca8a3527bde068e9">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(df3.long, <span class="at">names_from =</span> assignment, <span class="at">values_from =</span> value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  student HW1   HW2   HW3   HW4  
  &lt;chr&gt;   &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt; &lt;lgl&gt;
1 Joe     NA    NA    NA    NA   
2 Jane    NA    NA    NA    NA   
3 Kim     NA    NA    NA    NA   </code></pre>
</div>
</div>
</section>
<section id="expanding-table-with-missing-sets-of-values" class="level3" data-number="11.5.6">
<h3 data-number="11.5.6" class="anchored" data-anchor-id="expanding-table-with-missing-sets-of-values"><span class="header-section-number">11.5.6</span> Expanding table with missing sets of values</h3>
<p>It’s not uncommon to be handed a table with incomplete combinations of observations. For example, the following table gives us yield and data source values for each combination of year and grain type. However, several combinations of year/grain are missing.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-24_619f680dbe5d4c987041f009a935277d">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df4.long <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Year  =</span> <span class="fu">c</span>(<span class="dv">1999</span>,<span class="dv">1999</span>,<span class="dv">2000</span>,<span class="dv">2000</span>,<span class="dv">2001</span>,<span class="dv">2003</span>,<span class="dv">2003</span>,<span class="dv">2005</span>),</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Grain =</span> <span class="fu">c</span>(<span class="st">"Oats"</span>, <span class="st">"Corn"</span>,<span class="st">"Oats"</span>, <span class="st">"Corn"</span>,<span class="st">"Oats"</span>, <span class="st">"Oats"</span>, <span class="st">"Corn"</span>,<span class="st">"Oats"</span>),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Yield =</span> <span class="fu">c</span>(<span class="dv">23</span>,<span class="dv">45</span>,<span class="dv">24</span>,<span class="dv">40</span>,<span class="dv">20</span>,<span class="dv">19</span>,<span class="dv">41</span>,<span class="dv">22</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Src   =</span> <span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"c"</span>,<span class="st">"a"</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>df4.long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year Grain Yield Src
1 1999  Oats    23   a
2 1999  Corn    45   a
3 2000  Oats    24   b
4 2000  Corn    40   c
5 2001  Oats    20   a
6 2003  Oats    19   a
7 2003  Corn    41   c
8 2005  Oats    22   a</code></pre>
</div>
</div>
<p>We are missing records for 2001 and Corn, 2003 and Corn, and data for both grains are missing for 2002 and 2004. To add rows for all missing pairs of year/grain values, use the <code>complete</code> function. Here, we’ll assign <code>0</code> to missing <code>Yield</code> values and <code>NA</code> to the <code>Src</code> values.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-25_17498f5d995fe67c64fc27799bae24d8">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df.all <span class="ot">&lt;-</span> <span class="fu">complete</span>(df4.long, <span class="at">Year=</span><span class="dv">1999</span><span class="sc">:</span><span class="dv">2005</span>, <span class="at">Grain=</span>  <span class="fu">c</span>(<span class="st">"Oats"</span>, <span class="st">"Corn"</span>),</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Yield =</span> <span class="dv">0</span>, <span class="at">Src =</span> <span class="cn">NA</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>df.all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
    Year Grain Yield Src  
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
 1  1999 Corn     45 a    
 2  1999 Oats     23 a    
 3  2000 Corn     40 c    
 4  2000 Oats     24 b    
 5  2001 Corn      0 &lt;NA&gt; 
 6  2001 Oats     20 a    
 7  2002 Corn      0 &lt;NA&gt; 
 8  2002 Oats      0 &lt;NA&gt; 
 9  2003 Corn     41 c    
10  2003 Oats     19 a    
11  2004 Corn      0 &lt;NA&gt; 
12  2004 Oats      0 &lt;NA&gt; 
13  2005 Corn      0 &lt;NA&gt; 
14  2005 Oats     22 a    </code></pre>
</div>
</div>
<p>NOTE 1: The dataframe should be ungrouped using <code>ungroup()</code> before calling <code>complete()</code> if a <code>group_by()</code> operation was previously applied to the table.</p>
<p>NOTE 2: If one of the columns used to complete the set of unique values is a factor, then passing that column name as an argument will automatically create unique sets of values from that factor’s <em>levels.</em></p>
<p>If you want to show just the missing rows, use <code>dplyr::anti_join()</code>.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-26_a1edf52e7550701a8c914ff28b78fcf2">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">anti_join</span>(df.all, df4.long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
   Year Grain Yield Src  
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
1  2001 Corn      0 &lt;NA&gt; 
2  2002 Corn      0 &lt;NA&gt; 
3  2002 Oats      0 &lt;NA&gt; 
4  2004 Corn      0 &lt;NA&gt; 
5  2004 Oats      0 &lt;NA&gt; 
6  2005 Corn      0 &lt;NA&gt; </code></pre>
</div>
</div>
</section>
<section id="filling-datetime-gaps-in-a-table" class="level3" data-number="11.5.7">
<h3 data-number="11.5.7" class="anchored" data-anchor-id="filling-datetime-gaps-in-a-table"><span class="header-section-number">11.5.7</span> Filling date/time gaps in a table</h3>
<section id="example-using-a-date-object-class" class="level4" data-number="11.5.7.1">
<h4 data-number="11.5.7.1" class="anchored" data-anchor-id="example-using-a-date-object-class"><span class="header-section-number">11.5.7.1</span> Example using a <code>Date</code> object class</h4>
<p>This is another example that makes use of the <code>complete</code> function. Here, we seek to add missing date/time values in a time series table.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-27_739e70c79f57055b7bd1dbb30e20c454">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df.dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2000-01-01"</span>, <span class="st">"2000-01-03"</span>, <span class="st">"2000-01-05"</span>)),</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Value =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To fill the missing dates between the minimum and maximum dates in <code>df.dt</code>, we first need to create the sequence of dates between these minimum and maximum values. We could do this in the <code>complete</code> function, but it will be clearer to the reader if these operations are performed separately.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-28_c8585f90cdd8be0bc74281e98e28aa73">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>dates.all <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df.dt<span class="sc">$</span>Date), <span class="fu">max</span>(df.dt<span class="sc">$</span>Date), <span class="at">by =</span> <span class="st">"1 day"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we pass the complete set of dates, <code>dates.all</code> to the <code>complete</code> function. We’ll assign <code>NA</code> to the missing <code>Value</code> values.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-29_5bab11939990590c4ab143aebc9873ec">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df.dt.all <span class="ot">&lt;-</span> <span class="fu">complete</span>(df.dt, <span class="at">Date =</span> dates.all, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Value =</span> <span class="cn">NA</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>df.dt.all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  Date       Value
  &lt;date&gt;     &lt;dbl&gt;
1 2000-01-01     1
2 2000-01-02    NA
3 2000-01-03     3
4 2000-01-04    NA
5 2000-01-05     5</code></pre>
</div>
</div>
<p>The <code>seq</code> function used in this example has a special method for <code>Date</code> objects. As such, it accepts a unique set of incremental parameters (via the <code>by =</code> parameter). In the above example, we are asking the function to increment the date object by <code>1 day</code>. Other increments can be applied to a sequenced Date object as shown in the following table.</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th>Increment units</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>day</code></td>
<td><em>X</em> number of <strong>days</strong> between dates</td>
</tr>
<tr class="even">
<td><code>week</code></td>
<td><em>X</em> number of <strong>weeks</strong> between dates</td>
</tr>
<tr class="odd">
<td><code>months</code></td>
<td><em>X</em> number of <strong>months</strong> between dates</td>
</tr>
<tr class="even">
<td><code>quarter</code></td>
<td><em>X</em> number of <strong>quarters</strong> between dates</td>
</tr>
<tr class="odd">
<td><code>year</code></td>
<td><em>X</em> number of <strong>years</strong> between dates</td>
</tr>
</tbody>
</table>
</section>
<section id="example-using-a-posix-object-class" class="level4" data-number="11.5.7.2">
<h4 data-number="11.5.7.2" class="anchored" data-anchor-id="example-using-a-posix-object-class"><span class="header-section-number">11.5.7.2</span> Example using a <code>Posix</code> object class</h4>
<p>Recall that if a time element is to be stored in a date, the date object becomes a <code>Posix</code> object class. This adds additional increment units to the <code>seq</code> function. In the following example, we create a new data frame (with a time value), then fill the table with date/times at 6 hour increments.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-30_6bc4da7f96d3ec2ebff57157587ee885">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.tm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Date =</span> <span class="fu">as.POSIXct</span>(<span class="fu">c</span>(<span class="st">"2000-01-01 18:00 EST"</span>, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"2000-01-02 6:00 EST"</span>, </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"2000-01-03 12:00 EST"</span>)),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Value =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-31_397f3ad2e5a7f33dc030b4ea48ca7246">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pos.all <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(df.tm<span class="sc">$</span>Date), <span class="fu">max</span>(df.tm<span class="sc">$</span>Date), <span class="at">by =</span> <span class="st">"6 hour"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-32_438c3ea088f2f687b4d9c95f805aa1d5">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df.tm.all <span class="ot">&lt;-</span> <span class="fu">complete</span>(df.tm, <span class="at">Date =</span> pos.all, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">Value =</span> <span class="cn">NA</span>))</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df.tm.all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
  Date                Value
  &lt;dttm&gt;              &lt;dbl&gt;
1 2000-01-01 18:00:00     1
2 2000-01-02 00:00:00    NA
3 2000-01-02 06:00:00     3
4 2000-01-02 12:00:00    NA
5 2000-01-02 18:00:00    NA
6 2000-01-03 00:00:00    NA
7 2000-01-03 06:00:00    NA
8 2000-01-03 12:00:00     5</code></pre>
</div>
</div>
<p>In this example the <code>seq</code> method for the <code>Posix</code> object adds a few more increment units to those available with the <code>seq.Date</code> method shown in the previous table. These include:</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th>Increment units</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>sec</code></td>
<td><em>X</em> number of <strong>seconds</strong> between timestamps.</td>
</tr>
<tr class="even">
<td><code>min</code></td>
<td><em>X</em> number of <strong>minutes</strong> between timestamps.</td>
</tr>
<tr class="odd">
<td><code>hour</code></td>
<td><em>X</em> number of <strong>hours</strong> between timestamps.</td>
</tr>
<tr class="even">
<td><code>DSTday</code></td>
<td><em>X</em> number of <strong>days</strong> between timestamps while taking into account changes to/from daylight savings time.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="identifying-missing-combination-in-dataframes" class="level3" data-number="11.5.8">
<h3 data-number="11.5.8" class="anchored" data-anchor-id="identifying-missing-combination-in-dataframes"><span class="header-section-number">11.5.8</span> Identifying missing combination in dataframes</h3>
<p>In an earlier example, we had the function automatically add the missing combinations using <strong>explicitly</strong> defined ranges of values. If you just want to output the missing combinations from the <strong>existing</strong> set of values in both columns, use the <code>expand()</code> function.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-33_e1241ac3a32a2db89c88079b7b8ab4fb">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>p.all <span class="ot">&lt;-</span> <span class="fu">expand</span>(df4.long, Year, Grain) <span class="co"># List all possible combinations</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>p.all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
    Year Grain
   &lt;dbl&gt; &lt;chr&gt;
 1  1999 Corn 
 2  1999 Oats 
 3  2000 Corn 
 4  2000 Oats 
 5  2001 Corn 
 6  2001 Oats 
 7  2003 Corn 
 8  2003 Oats 
 9  2005 Corn 
10  2005 Oats </code></pre>
</div>
</div>
<p>Note that this only outputs the columns of interest. If you need to see the other columns in the output, perform a join.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-34_b4ae8680368e5b76e71ad37962df5889">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">left_join</span>(p.all, df4.long, <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Grain"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
    Year Grain Yield Src  
   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;
 1  1999 Corn     45 a    
 2  1999 Oats     23 a    
 3  2000 Corn     40 c    
 4  2000 Oats     24 b    
 5  2001 Corn     NA &lt;NA&gt; 
 6  2001 Oats     20 a    
 7  2003 Corn     41 c    
 8  2003 Oats     19 a    
 9  2005 Corn     NA &lt;NA&gt; 
10  2005 Oats     22 a    </code></pre>
</div>
</div>
</section>
<section id="auto-fill-down-or-up" class="level3" data-number="11.5.9">
<h3 data-number="11.5.9" class="anchored" data-anchor-id="auto-fill-down-or-up"><span class="header-section-number">11.5.9</span> Auto-fill down or up</h3>
<p>The <code>fill()</code> function is used to replace <code>NA</code> values with the closest non-<code>NA</code> value in a column. For example, to fill <em>down</em>, set the <code>.direction</code> argument to <code>"down"</code>.</p>
<div class="cell" data-hash="tidyr_cache/html/unnamed-chunk-35_b6cdae8ca68480d3e7c210bd30922920">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Month =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>),<span class="dv">2001</span>, <span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">6</span>)))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>df5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Month Year
1      1 2000
2      2   NA
3      3   NA
4      4   NA
5      5   NA
6      6 2001
7      7   NA
8      8   NA
9      9   NA
10    10   NA
11    11   NA
12    12   NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fill</span>(df5, Year, <span class="at">.direction=</span><span class="st">"down"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Month Year
1      1 2000
2      2 2000
3      3 2000
4      4 2000
5      5 2000
6      6 2001
7      7 2001
8      8 2001
9      9 2001
10    10 2001
11    11 2001
12    12 2001</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>

<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./group_by.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Grouping and summarizing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./joins.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Joining Data Tables</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Manny Gimond, Creative Commons License <a href="https://creativecommons.org/licenses/by-nc/4.0/"><img src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" class="img-fluid"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>