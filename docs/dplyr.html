<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploratory Data Analysis in R - 9&nbsp; Manipulating data tables with dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./group_by.html" rel="next">
<link href="./subset_base.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CJW3PSXZC2"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CJW3PSXZC2', { 'anonymize_ip': true});
</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="libs/style.css">
</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_objects.html">Data manipulation</a></li><li class="breadcrumb-item"><a href="./dplyr.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Manipulating data tables with `dplyr`</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Intro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">EDA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./The_R_environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The R and RStudio Environments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Object Type and Structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./read_write_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reading and Writing Data Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./date_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with string objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boolean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Relational and boolean operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subset_base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Subsetting and replacing values using base functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Manipulating data tables with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./group_by.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Grouping and summarizing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Tidying/reshaping tables with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Joining Data Tables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Plots</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Base plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lattice_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Lattice plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ggplot2 plotting environment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Univariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Visualizing univariate distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_batches.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Comparing data distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theoretical_qq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">The theoretical q-q</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Univariate analysis: Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sl_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Spread-level plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./re_express.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Re-expressing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./letter_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Letter value summaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fine-tuning re-expression and Robust statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Bivariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resistant_lines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Resistant lines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">The third R of EDA: Residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discontinuity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Slicing data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Two-way tables</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./two_way.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Analyzing two-way tables: The median polish</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">R markdown document</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Mapping variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Data used in ES218</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-dplyr-basics" id="toc-the-dplyr-basics" class="nav-link active" data-scroll-target="#the-dplyr-basics"><span class="header-section-number">9.1</span> The dplyr basics</a>
  <ul class="collapse">
  <li><a href="#filter-subset-by-rows" id="toc-filter-subset-by-rows" class="nav-link" data-scroll-target="#filter-subset-by-rows"><span class="header-section-number">9.1.1</span> <code>filter</code>: Subset by rows</a></li>
  <li><a href="#arrange-sort-rows-by-column-value" id="toc-arrange-sort-rows-by-column-value" class="nav-link" data-scroll-target="#arrange-sort-rows-by-column-value"><span class="header-section-number">9.1.2</span> <code>arrange</code>: Sort rows by column value</a></li>
  <li><a href="#select-subset-by-column" id="toc-select-subset-by-column" class="nav-link" data-scroll-target="#select-subset-by-column"><span class="header-section-number">9.1.3</span> <code>select</code>: Subset by column</a></li>
  <li><a href="#mutate-creating-andor-calculating-column-values" id="toc-mutate-creating-andor-calculating-column-values" class="nav-link" data-scroll-target="#mutate-creating-andor-calculating-column-values"><span class="header-section-number">9.1.4</span> <code>mutate</code>: Creating and/or calculating column values</a></li>
  <li><a href="#mutate_at-creating-andor-calculating-values-across-muliple-columns" id="toc-mutate_at-creating-andor-calculating-values-across-muliple-columns" class="nav-link" data-scroll-target="#mutate_at-creating-andor-calculating-values-across-muliple-columns"><span class="header-section-number">9.1.5</span> <code>mutate_at</code>: Creating and/or calculating values across muliple columns</a></li>
  <li><a href="#summarise-summarize-columns" id="toc-summarise-summarize-columns" class="nav-link" data-scroll-target="#summarise-summarize-columns"><span class="header-section-number">9.1.6</span> <code>summarise</code>: Summarize columns</a></li>
  </ul></li>
  <li><a href="#sec-pipe" id="toc-sec-pipe" class="nav-link" data-scroll-target="#sec-pipe"><span class="header-section-number">9.2</span> Combining data manipulation functions using the pipe <code>%&gt;%</code></a>
  <ul class="collapse">
  <li><a href="#r-has-a-native-pipe-too" id="toc-r-has-a-native-pipe-too" class="nav-link" data-scroll-target="#r-has-a-native-pipe-too"><span class="header-section-number">9.2.1</span> R has a native pipe too</a></li>
  </ul></li>
  <li><a href="#conditional-statements" id="toc-conditional-statements" class="nav-link" data-scroll-target="#conditional-statements"><span class="header-section-number">9.3</span> Conditional statements</a>
  <ul class="collapse">
  <li><a href="#the-base-ifelse" id="toc-the-base-ifelse" class="nav-link" data-scroll-target="#the-base-ifelse"><span class="header-section-number">9.3.1</span> The base <code>ifelse</code></a></li>
  <li><a href="#dplyrs-if_else" id="toc-dplyrs-if_else" class="nav-link" data-scroll-target="#dplyrs-if_else"><span class="header-section-number">9.3.2</span> <code>dplyr</code>’s <code>if_else</code></a></li>
  <li><a href="#recoding-factors-using-recode" id="toc-recoding-factors-using-recode" class="nav-link" data-scroll-target="#recoding-factors-using-recode"><span class="header-section-number">9.3.3</span> Recoding factors using <code>recode</code></a></li>
  <li><a href="#changing-values-based-on-multiple-conditions-case_when" id="toc-changing-values-based-on-multiple-conditions-case_when" class="nav-link" data-scroll-target="#changing-values-based-on-multiple-conditions-case_when"><span class="header-section-number">9.3.4</span> Changing values based on multiple conditions: <code>case_when</code></a></li>
  </ul></li>
  <li><a href="#miscellaneous" id="toc-miscellaneous" class="nav-link" data-scroll-target="#miscellaneous"><span class="header-section-number">9.4</span> Miscellaneous</a>
  <ul class="collapse">
  <li><a href="#replacing-values-with-na" id="toc-replacing-values-with-na" class="nav-link" data-scroll-target="#replacing-values-with-na"><span class="header-section-number">9.4.1</span> Replacing values with <code>NA</code></a></li>
  <li><a href="#outputting-a-vector-instead-of-a-table-using-pull" id="toc-outputting-a-vector-instead-of-a-table-using-pull" class="nav-link" data-scroll-target="#outputting-a-vector-instead-of-a-table-using-pull"><span class="header-section-number">9.4.2</span> Outputting a vector instead of a table using <code>pull</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Manipulating data tables with <code>dplyr</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-2_cd865d8d1ac8a3f1ea6152390c61ddc5">
<div class="cell-output-display">

<table data-quarto-disable-processing="true" class="table" style="width: auto !important; ">
 <thead>
  <tr>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> dplyr </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> lubridate </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> forcats </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> stringr </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.1.4 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.9.3 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.0.0 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.5.1 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>The data file <em>FAO_grains_NA.csv</em> will be used in this exercise. This dataset consists of grain yield and harvest year by North American country. The dataset was downloaded from http://faostat3.fao.org/ in June of 2014.</p>
<p>Run the following line to load the FAO data file into your current R session.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-3_36f0f2aca6c2d1f9570bb13369f153b1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://mgimond.github.io/ES218/Data/FAO_grains_NA.csv"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before tackling the examples that follow, make sure to load the <code>dplyr</code> package.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-4_474877655e6f71ef87ce89729e3bca45">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-dplyr-basics" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="the-dplyr-basics"><span class="header-section-number">9.1</span> The dplyr basics</h2>
<p>The basic set of R tools can accomplish many data table queries, but the syntax can be overwhelming and verbose. The package <code>dplyr</code> offers some nifty and simple querying functions as shown in the next subsections. Some of <code>dplyr</code>’s key data manipulation functions are summarized in the following table:</p>
<table class="table">
<thead>
<tr class="header">
<th><code>dplyr</code> function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter()</code></td>
<td>Subset by row values</td>
</tr>
<tr class="even">
<td><code>arrange()</code></td>
<td>Sort rows by column values</td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td>Subset columns</td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>Add columns</td>
</tr>
<tr class="odd">
<td><code>summarise()</code></td>
<td>Summarize columns</td>
</tr>
</tbody>
</table>
<p>Note that all of these functions take as first argument the data table name except when used in a piping operation (pipes are discussed later in this chapter). For example:</p>
<p>When used alone, dataframe <code>dat</code> is the first argument <strong>inside</strong> the <code>dplyr</code> function.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-5_7bf06766f75d98b1bbb60d70df80989d">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">select</span>(dat, crop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When used in a pipe, dataframe <code>dat</code> is <strong>outside</strong> of the <code>dplyr</code> function.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-6_804d832334c951241b91c87179b33630">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(crop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="filter-subset-by-rows" class="level3" data-number="9.1.1">
<h3 data-number="9.1.1" class="anchored" data-anchor-id="filter-subset-by-rows"><span class="header-section-number">9.1.1</span> <code>filter</code>: Subset by rows</h3>
<p>Tables can be subsetted by rows based on column values. For example, we may wish to grab all rows associated with the string <code>Oats</code> in the <code>Crop</code> column:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-7_481009c73af01f96f57a5b8cf640ab85">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dat.query1 <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat, Crop <span class="sc">==</span> <span class="st">"Oats"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat.query1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Country              Crop           Information             Year     
 Length:208         Length:208         Length:208         Min.   :1961  
 Class :character   Class :character   Class :character   1st Qu.:1974  
 Mode  :character   Mode  :character   Mode  :character   Median :1986  
                                                          Mean   :1986  
                                                          3rd Qu.:1999  
                                                          Max.   :2012  
     Value            Source         
 Min.   :  12667   Length:208        
 1st Qu.:  20392   Class :character  
 Median : 204821   Mode  :character  
 Mean   :1350024                     
 3rd Qu.:1638250                     
 Max.   :9666550                     </code></pre>
</div>
</div>
<p>Note that R is case sensitive, so make sure that you respect each letter’s case (i.e.&nbsp;upper or lower).</p>
<p>We can expand our query by including both <code>Oats</code>, <code>Buckwheat</code> and limiting the <code>Country</code> column to <code>Canada</code>.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-8_c8e1d154eb4f9264d0c7972c97dc3417">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat.query2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat, Crop <span class="sc">==</span> <span class="st">"Oats"</span> <span class="sc">|</span> Crop <span class="sc">==</span> <span class="st">"Buckwheat"</span>, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                          Country <span class="sc">==</span> <span class="st">"Canada"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat.query2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Country              Crop           Information             Year     
 Length:200         Length:200         Length:200         Min.   :1961  
 Class :character   Class :character   Class :character   1st Qu.:1973  
 Mode  :character   Mode  :character   Mode  :character   Median :1986  
                                                          Mean   :1986  
                                                          3rd Qu.:1998  
                                                          Max.   :2012  
     Value            Source         
 Min.   :      0   Length:200        
 1st Qu.:  11822   Class :character  
 Median :  22197   Mode  :character  
 Mean   : 504098                     
 3rd Qu.: 924675                     
 Max.   :4277000                     </code></pre>
</div>
</div>
<p>The character <code>|</code> is the Boolean operator <em>OR</em>. So in our example, the query can be read as “… crop equals oats <em>OR</em> crop equals buckwheat”. Had we used the AND operator, <code>&amp;</code>, instead as in <code>Crop == "Oats" &amp; Crop == "Buckwheat"</code> the output would have returned zero rows since a <code>Crop</code> value cannot be both <code>Oats</code> AND <code>Buckwheat</code>.</p>
<p>We can expand this query by limiting our output to the years 2005 to 2010</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-9_056821e55082449b889b09821ebd92ba">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dat.query3 <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat, Crop <span class="sc">==</span> <span class="st">"Oats"</span> <span class="sc">|</span> Crop <span class="sc">==</span> <span class="st">"Buckwheat"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                          Country <span class="sc">==</span> <span class="st">"Canada"</span>, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                          Year <span class="sc">&gt;=</span> <span class="dv">2005</span> <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2010</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat.query3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Country              Crop           Information             Year     
 Length:18          Length:18          Length:18          Min.   :2005  
 Class :character   Class :character   Class :character   1st Qu.:2006  
 Mode  :character   Mode  :character   Mode  :character   Median :2007  
                                                          Mean   :2007  
                                                          3rd Qu.:2008  
                                                          Max.   :2010  
     Value            Source         
 Min.   :   2000   Length:18         
 1st Qu.:  11500   Class :character  
 Median :  26615   Mode  :character  
 Mean   : 453810                     
 3rd Qu.: 961825                     
 Max.   :1815700                     </code></pre>
</div>
</div>
<p>Note the use of the AND Boolean operator (<code>&amp;</code>) instead of the OR operator (<code>|</code>) for the <code>Year</code> query. We want the <code>Year</code> value to satisfy two criteria simultaneously: <em>greater than or equal to 2005</em> <strong>AND</strong> <em>less than or equal to 2010</em>. Had we used the <code>|</code> operator, R would have returned all years since all year values satisfy at least one of the two criterion.</p>
</section>
<section id="arrange-sort-rows-by-column-value" class="level3" data-number="9.1.2">
<h3 data-number="9.1.2" class="anchored" data-anchor-id="arrange-sort-rows-by-column-value"><span class="header-section-number">9.1.2</span> <code>arrange</code>: Sort rows by column value</h3>
<p>You can sort a table based on a column’s values. For example, to sort <code>dat</code> by crop name type:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-10_9a9e3e5d68be740e12c06d9c414bb497">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dat.sort1 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(dat, Crop)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.sort1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Country   Crop         Information Year      Value
1                   Canada Barley Area harvested (Ha) 2012 2060000.00
2                   Canada Barley       Yield (Hg/Ha) 2012   38894.66
3 United States of America Barley Area harvested (Ha) 2012 1312810.00
4 United States of America Barley       Yield (Hg/Ha) 2012   36533.24
5                   Canada Barley Area harvested (Ha) 2011 2364800.00
6                   Canada Barley       Yield (Hg/Ha) 2011   32796.43
           Source
1   Official data
2 Calculated data
3   Official data
4 Calculated data
5   Official data
6 Calculated data</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(dat.sort1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Country      Crop         Information Year    Value
1496  Canada Triticale Area harvested (Ha) 1991  1093.00
1497  Canada Triticale       Yield (Hg/Ha) 1991 21957.91
1498  Canada Triticale Area harvested (Ha) 1990  1074.00
1499  Canada Triticale       Yield (Hg/Ha) 1990 26396.65
1500  Canada Triticale Area harvested (Ha) 1989  1093.00
1501  Canada Triticale       Yield (Hg/Ha) 1989 21957.91
                                       Source
1496                            Official data
1497                          Calculated data
1498 FAO data based on imputation methodology
1499                          Calculated data
1500                             FAO estimate
1501                          Calculated data</code></pre>
</div>
</div>
<p>By default, <code>arrange</code> sorts by ascending order. To sort by descending order, wrap the column name with the function <code>desc()</code>. For example, to sort the table by <code>Crop</code> in ascending order then by <code>Year</code> in descending order, type:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-11_8b30c059a284f7caf92acaa35ffa9dec">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dat.sort2 <span class="ot">&lt;-</span> <span class="fu">arrange</span>(dat, Crop, <span class="fu">desc</span>(Year))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.sort2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Country   Crop         Information Year      Value
1                   Canada Barley Area harvested (Ha) 2012 2060000.00
2                   Canada Barley       Yield (Hg/Ha) 2012   38894.66
3 United States of America Barley Area harvested (Ha) 2012 1312810.00
4 United States of America Barley       Yield (Hg/Ha) 2012   36533.24
5                   Canada Barley Area harvested (Ha) 2011 2364800.00
6                   Canada Barley       Yield (Hg/Ha) 2011   32796.43
           Source
1   Official data
2 Calculated data
3   Official data
4 Calculated data
5   Official data
6 Calculated data</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(dat.sort2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Country      Crop         Information Year    Value
1496  Canada Triticale Area harvested (Ha) 1991  1093.00
1497  Canada Triticale       Yield (Hg/Ha) 1991 21957.91
1498  Canada Triticale Area harvested (Ha) 1990  1074.00
1499  Canada Triticale       Yield (Hg/Ha) 1990 26396.65
1500  Canada Triticale Area harvested (Ha) 1989  1093.00
1501  Canada Triticale       Yield (Hg/Ha) 1989 21957.91
                                       Source
1496                            Official data
1497                          Calculated data
1498 FAO data based on imputation methodology
1499                          Calculated data
1500                             FAO estimate
1501                          Calculated data</code></pre>
</div>
</div>
</section>
<section id="select-subset-by-column" class="level3" data-number="9.1.3">
<h3 data-number="9.1.3" class="anchored" data-anchor-id="select-subset-by-column"><span class="header-section-number">9.1.3</span> <code>select</code>: Subset by column</h3>
<p>You can subset a table by column(s). To extract the columns <code>Crop</code>, <code>Year</code> and <code>Value</code>, type:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-12_add56c9b27944a952bef74b3220bee61">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dat.subcol <span class="ot">&lt;-</span> <span class="fu">select</span>(dat, Crop, Year, Value)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.subcol, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Crop Year      Value
1 Barley 2012 2060000.00
2 Barley 2012   38894.66</code></pre>
</div>
</div>
<p>If you want all columns <em>other</em> than <code>Crop</code>, <code>Year</code> and <code>Value</code>, add the negative <code>-</code> symbol before the column name:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-13_80930578fab209cc593a2b44c7de8356">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dat.subcol <span class="ot">&lt;-</span> <span class="fu">select</span>(dat, <span class="sc">-</span>Crop, <span class="sc">-</span>Year, <span class="sc">-</span>Value)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.subcol, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country         Information          Source
1  Canada Area harvested (Ha)   Official data
2  Canada       Yield (Hg/Ha) Calculated data</code></pre>
</div>
</div>
</section>
<section id="mutate-creating-andor-calculating-column-values" class="level3" data-number="9.1.4">
<h3 data-number="9.1.4" class="anchored" data-anchor-id="mutate-creating-andor-calculating-column-values"><span class="header-section-number">9.1.4</span> <code>mutate</code>: Creating and/or calculating column values</h3>
<p>You can add columns (and compute their values) using the <code>mutate</code> function. For example, to add a column <code>Ctr_abbr</code> and assign it the abbreviated values <code>CAN</code> for Canada and <code>USA</code> for the United States of America based on the values in column <code>Country</code> type:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-14_7afd0eef046168d8d99e3a7db8efdd26">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dat.extended <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat, <span class="at">Ctr_abbr =</span> <span class="fu">ifelse</span>(Country <span class="sc">==</span> <span class="st">"Canada"</span>, <span class="st">"CAN"</span>, <span class="st">"USA"</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.extended,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country      Crop         Information Year      Value          Source
1  Canada    Barley Area harvested (Ha) 2012 2060000.00   Official data
2  Canada    Barley       Yield (Hg/Ha) 2012   38894.66 Calculated data
3  Canada Buckwheat Area harvested (Ha) 2012       0.00    FAO estimate
  Ctr_abbr
1      CAN
2      CAN
3      CAN</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(dat.extended,<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Country    Crop         Information Year      Value
1499 United States of America     Rye       Yield (Hg/Ha) 1961   11121.79
1500 United States of America Sorghum Area harvested (Ha) 1961 4445000.00
1501 United States of America Sorghum       Yield (Hg/Ha) 1961   27442.07
              Source Ctr_abbr
1499 Calculated data      USA
1500   Official data      USA
1501 Calculated data      USA</code></pre>
</div>
</div>
<p>Here, we make use of an embedded function, <code>ifelse</code>, which performs a conditional operation: if the <code>Country</code> value is <code>Canada</code> return <code>CAN</code> if not, return <code>USA</code>.</p>
<p>Note that if you wish to <em>rename</em> a column, you can use the <code>rename()</code> function instead of <code>mutate</code>.</p>
<p>You can also use <code>mutate</code> to recompute column values. For example, to replace the <code>Country</code> column values with <code>CAN</code> or <code>USA</code> type:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-15_560e5f3ed2eada619b5a802064f01cdd">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat.overwrite <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat, <span class="at">Country =</span> <span class="fu">ifelse</span>(Country <span class="sc">==</span> <span class="st">"Canada"</span>, <span class="st">"CAN"</span>, <span class="st">"USA"</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.overwrite, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country      Crop         Information Year      Value          Source
1     CAN    Barley Area harvested (Ha) 2012 2060000.00   Official data
2     CAN    Barley       Yield (Hg/Ha) 2012   38894.66 Calculated data
3     CAN Buckwheat Area harvested (Ha) 2012       0.00    FAO estimate</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(dat.overwrite, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Country    Crop         Information Year      Value          Source
1499     USA     Rye       Yield (Hg/Ha) 1961   11121.79 Calculated data
1500     USA Sorghum Area harvested (Ha) 1961 4445000.00   Official data
1501     USA Sorghum       Yield (Hg/Ha) 1961   27442.07 Calculated data</code></pre>
</div>
</div>
</section>
<section id="mutate_at-creating-andor-calculating-values-across-muliple-columns" class="level3" data-number="9.1.5">
<h3 data-number="9.1.5" class="anchored" data-anchor-id="mutate_at-creating-andor-calculating-values-across-muliple-columns"><span class="header-section-number">9.1.5</span> <code>mutate_at</code>: Creating and/or calculating values across muliple columns</h3>
<p>You might find yourself wanting to apply a same set of <em>mutate</em> operations across multiple variables. For example, given the following sample dataset,</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-16_b5065252e9934ad659eab86bb43198ec">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>met <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Wind =</span> <span class="fu">c</span>(<span class="fl">3.4</span>, <span class="fl">5.0</span>, <span class="dv">99</span>, <span class="fl">4.1</span>, <span class="fl">1.5</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Dir  =</span> <span class="fu">c</span>(<span class="dv">181</span>, <span class="dv">220</span>, <span class="dv">15</span>,  <span class="dv">15</span>,  <span class="dv">99</span> ),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Prec =</span> <span class="fu">c</span>(<span class="dv">99</span> , <span class="fl">0.5</span>,  <span class="dv">0</span>,  <span class="dv">99</span>,  <span class="dv">99</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>met</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Wind Dir Prec
1  3.4 181 99.0
2  5.0 220  0.5
3 99.0  15  0.0
4  4.1  15 99.0
5  1.5  99 99.0</code></pre>
</div>
</div>
<p>where the value <code>99</code> is a placeholder for a missing value for the variables <code>Wind</code> and <code>Prec</code> but a valid value for <code>Dir</code>, we want to replace all missing values with <code>NA</code>. We could either create two mutate operations as in,</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-17_16bb6654784de7190770495a69075c49">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>met2 <span class="ot">&lt;-</span> <span class="fu">mutate</span>( met, <span class="at">Wind =</span> <span class="fu">ifelse</span>(Wind <span class="sc">==</span> <span class="dv">99</span>, <span class="cn">NA</span>, Wind),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Prec =</span> <span class="fu">ifelse</span>(Prec <span class="sc">==</span> <span class="dv">99</span>, <span class="cn">NA</span>, Prec))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>met2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Wind Dir Prec
1  3.4 181   NA
2  5.0 220  0.5
3   NA  15  0.0
4  4.1  15   NA
5  1.5  99   NA</code></pre>
</div>
</div>
<p>or, we could reduce the separate <code>mutate</code> operations into a single <code>mutate_at</code> operation,</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-18_0f64087fed9b407f4b21ea4aee2b2dac">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>met2 <span class="ot">&lt;-</span> <span class="fu">mutate_at</span>( met, <span class="fu">vars</span>(Wind, Prec),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">list</span>(<span class="sc">~</span> <span class="fu">ifelse</span>( . <span class="sc">==</span> <span class="dv">99</span>, <span class="cn">NA</span>, .)))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>met2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Wind Dir Prec
1  3.4 181   NA
2  5.0 220  0.5
3   NA  15  0.0
4  4.1  15   NA
5  1.5  99   NA</code></pre>
</div>
</div>
<p>The dot <code>.</code> is a placeholder for each column listed in the <code>vars()</code> function. Also, note the <code>~</code> operator in lieu of <code>. =</code>.</p>
</section>
<section id="summarise-summarize-columns" class="level3" data-number="9.1.6">
<h3 data-number="9.1.6" class="anchored" data-anchor-id="summarise-summarize-columns"><span class="header-section-number">9.1.6</span> <code>summarise</code>: Summarize columns</h3>
<p>You can summarize (or “collapse”) one or more columns using the <code>summarise</code> function. For instance, to get the minimum and maximum years from the <code>Year</code> column, type:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-19_bcdbea6afb36d7c29802ee6a4587c365">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(dat, <span class="at">yr_min =</span> <span class="fu">min</span>(Year), <span class="at">yr_max=</span><span class="fu">max</span>(Year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  yr_min yr_max
1   1961   2012</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-pipe" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="sec-pipe"><span class="header-section-number">9.2</span> Combining data manipulation functions using the pipe <code>%&gt;%</code></h2>
<p>In most cases, you will find yourself wanting to combine several of <code>dplyr</code>’s data manipulation functions. For example,</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-20_004f31bc7dda87750350593e3932f79a">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dat.yield  <span class="ot">&lt;-</span> <span class="fu">filter</span>(dat, Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                          Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                          Year <span class="sc">==</span> <span class="dv">2012</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>dat.rename <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dat.yield, <span class="at">Country =</span> <span class="fu">ifelse</span>(Country <span class="sc">==</span> <span class="st">"Canada"</span>, <span class="st">"CAN"</span>, <span class="st">"USA"</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>dat.final  <span class="ot">&lt;-</span> <span class="fu">select</span>(dat.rename, Country, Value)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.final, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country    Value
1     CAN 24954.79
2     USA 21974.70</code></pre>
</div>
</div>
<p>The downside to this approach is the creation of several intermediate objects (e.g.&nbsp;<code>dat.yield</code> and <code>dat.rename</code>). This can make the workflow difficult to follow and clutter your R session with needless intermediate objects.</p>
<p>Another approach to combining <code>dplyr</code> operations is to use the <strong>piping operator</strong> ,<code>%&gt;%</code>, which daisy chains <code>dplyr</code> operations. So our previous workflow could look like:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-21_ab7b589b2c0771c25f258aa73fc9a7c7">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>dat.final <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>, </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>         Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>         Year <span class="sc">==</span> <span class="dv">2012</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="fu">ifelse</span>(Country <span class="sc">==</span> <span class="st">"Canada"</span>, <span class="st">"CAN"</span>, <span class="st">"USA"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, Value)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat.final, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country    Value
1     CAN 24954.79
2     USA 21974.70</code></pre>
</div>
</div>
<p>The chunk of code can be read as <em>“… with the <code>dat</code> table, <code>filter</code> by …, then <code>mutate</code> …., then <code>select</code> …”</em> with the result from one operation being passed on to the next using the <code>%&gt;%</code> operator. Note that the <code>filter</code>, <code>mutate</code> and <code>select</code> functions do not include the data table name making the chunk of code less cluttered and easier to read. The input data table <code>dat</code> appears just once at the beginning of the pipe.</p>
<section id="r-has-a-native-pipe-too" class="level3" data-number="9.2.1">
<h3 data-number="9.2.1" class="anchored" data-anchor-id="r-has-a-native-pipe-too"><span class="header-section-number">9.2.1</span> R has a native pipe too</h3>
<p>R has recently (as of version <code>4.1</code>) added its own native pipe to its base function. Its infix operator is written as <code>|&gt;</code>. In most code chunks covered in these tutorials, you can substitute <code>%&gt;%</code> with <code>|&gt;</code>. For example, you can write the previous code chunk as:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-22_efbc307c20ab0b853d260ffe96c6df2d">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dat.final <span class="ot">&lt;-</span> dat  <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>         Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>         Year <span class="sc">==</span> <span class="dv">2012</span>)   <span class="sc">|&gt;</span>  </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="fu">ifelse</span>(Country <span class="sc">==</span> <span class="st">"Canada"</span>, <span class="st">"CAN"</span>, <span class="st">"USA"</span>))  <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, Value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are, however, a few subtle differences between the two. A deeper dive in how they differ can be found <a href="https://mgimond.github.io/CRUG_Sep_2021/crug_sep_2021.html#the-native-pipe">here</a>.</p>
<p>In this course, we’ll stick with the <code>%&gt;%</code> operator given that <code>|&gt;</code> is new and is not yet as widely adopted as <code>%&gt;%</code>.</p>
<p>&nbsp;&nbsp;</p>
</section>
</section>
<section id="conditional-statements" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="conditional-statements"><span class="header-section-number">9.3</span> Conditional statements</h2>
<p>&nbsp;&nbsp;</p>
<section id="the-base-ifelse" class="level3" data-number="9.3.1">
<h3 data-number="9.3.1" class="anchored" data-anchor-id="the-base-ifelse"><span class="header-section-number">9.3.1</span> The base <code>ifelse</code></h3>
<p>Conditional statements are used when you want to create an output value that is conditioned on an evaluation. For example, if you want to output a value of <code>1</code> <em>if</em> an input value is less than <code>23</code> and a value of <code>0</code> otherwise, you can make use of the <code>ifelse</code> function as follows:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-23_278978fd8647f4f72cbd33f2fba67c07">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">102</span>, <span class="dv">43</span>, <span class="dv">20</span>, <span class="dv">90</span>, <span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">6</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(x <span class="sc">&lt;</span> <span class="dv">23</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 0 0 1 0 1 1 1</code></pre>
</div>
</div>
<p>The base <code>ifelse</code> function works as expected when the input/output values are numeric or character, but does not work as expected when applied to factors or dates. For example, if you wish to replace one factor level with another, the following example will not return the expected output.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-24_c7e78483c79d4d6814142f0aa36d57bf">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.factor</span>( <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span>, <span class="st">"apple"</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">"pear"</span>, <span class="st">"apple"</span>, x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1"     "2"     "2"     "apple" "1"    </code></pre>
</div>
</div>
<p>The output is a character representation of the level number (recall that factors encode level values as numbers behind the scenes, i.e.&nbsp;<code>apple</code> =1, <code>banana</code>=2, etc…). Likewise, if you wish to replace an erroneous date with a missing value you will get:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-25_95c06257e2a2c4e9b3477ef36bc27697">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">mdy</span>(<span class="st">"1/23/2016"</span>, <span class="st">"3/2/2016"</span>, <span class="st">"12/1/1901"</span>, <span class="st">"11/23/2016"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>( <span class="fu">year</span>(y) <span class="sc">!=</span> <span class="dv">2016</span>, <span class="cn">NA</span>, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16823 16862    NA 17128</code></pre>
</div>
</div>
<p>Here, <code>ifelse</code> converts the date object to its internal numeric representation as number of days since 1970.</p>
<p><code>if_else</code> does not preserve the attributes that might be present in a vector. In other words, it will strip away the vector’s <code>class</code>. If you want to ensure that the vector’s <code>class</code> is preserved, a safer alternative is to use <code>dplyr</code>’s <code>if_else</code> function.</p>
</section>
<section id="dplyrs-if_else" class="level3" data-number="9.3.2">
<h3 data-number="9.3.2" class="anchored" data-anchor-id="dplyrs-if_else"><span class="header-section-number">9.3.2</span> <code>dplyr</code>’s <code>if_else</code></h3>
<p>The <code>if_else</code> function (note the underscore <code>_</code>), will preserve data type but does so strictly. For example, the following code will return an error:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-26_f50a9dd31d95ba5916f6fde033d33d61">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>( <span class="fu">year</span>(y) <span class="sc">!=</span> <span class="dv">2016</span>, <span class="cn">NA</span>, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2016-01-23" "2016-03-02" NA           "2016-11-23"</code></pre>
</div>
</div>
<p>The output data types (<code>NA</code> and <code>y</code>) are different. <code>NA</code> is a logical data type (see <code>typeof(NA)</code>) and <code>y</code> is not. The solution is to force <code>NA</code> as a <em>date</em> object by wrapping it with a date function like <code>mdy(NA)</code> or the base <code>as.Date(NA)</code> function, or by replacing the logical <code>NA</code> with <code>NA_Date_</code> which is found in the <code>lubridate</code> package.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-27_59c2772d84d4a4f4f7271aa610be2de5">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>( <span class="fu">year</span>(y) <span class="sc">!=</span> <span class="dv">2016</span>, <span class="fu">mdy</span>(<span class="cn">NA</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2016-01-23" "2016-03-02" NA           "2016-11-23"</code></pre>
</div>
</div>
<p>Likewise, if the input vector is of type character, you need to ensure that all output values are characters too.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-28_656c8ec34fbeff0cdee72e66ca5a433f">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"banana"</span>, <span class="st">"pear"</span>, <span class="st">"apple"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>( y <span class="sc">==</span> <span class="st">"banana"</span>, <span class="fu">as.character</span>(<span class="cn">NA</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple" NA      NA      "pear"  "apple"</code></pre>
</div>
</div>
<p>Recall from the Week 02 lecture notes that R has several <code>NA</code> reserved words for different data types (e.g.&nbsp;<code>NA_character_</code> and <code>NA_integer_</code> to name a few). So the last chunk of code could have been written as,</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-29_9d6d12e0e9b34a67d6148b1a46485b3b">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>( y <span class="sc">==</span> <span class="st">"banana"</span>, <span class="cn">NA_character_</span>, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple" NA      NA      "pear"  "apple"</code></pre>
</div>
</div>
<p>Note that there is no reserved word for an <code>NA</code> <em>date</em> or <em>Posix</em> type in the base R environment. But they are available in the <code>lubridate</code> package (<code>NA_Date_</code> and <code>NA_POSIXct_</code>).</p>
</section>
<section id="recoding-factors-using-recode" class="level3" data-number="9.3.3">
<h3 data-number="9.3.3" class="anchored" data-anchor-id="recoding-factors-using-recode"><span class="header-section-number">9.3.3</span> Recoding factors using <code>recode</code></h3>
<p>When working with factors, however, <code>if_else</code> (as of <code>dplyr</code> version <code>0.7</code>) will produce the following error:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-30_0385fb2af514e1d15e5c59eadbaf935d">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>(x <span class="sc">==</span> <span class="st">"pear"</span>, <span class="st">"apple"</span>, x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple"  "banana" "banana" "apple"  "apple" </code></pre>
</div>
</div>
<p>The first outcome listed in the function defines the data type or class. Here, <code>"apple"</code> is a character, so it expects the <em>FALSE</em> outcome to be a character as well (here, the <em>FALSE</em> outcome is a factor). A better option for recoding factors is to use <code>dplyr</code>’s <code>recode</code> function:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-31_723224ae8b09cc0fa925e46739417c1c">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recode</span>(x , <span class="st">"pear"</span> <span class="ot">=</span> <span class="st">"apple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] apple  banana banana apple  apple 
Levels: apple banana</code></pre>
</div>
</div>
<p>You can recode more than one factor level. In fact, you can even introduce new levels in the recoding scheme:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-32_c2633ff237925b93733f7d3e1800a102">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recode</span>(x , <span class="st">"pear"</span> <span class="ot">=</span> <span class="st">"apple"</span>, <span class="st">"banana"</span> <span class="ot">=</span> <span class="st">"pineapple"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] apple     pineapple pineapple apple     apple    
Levels: apple pineapple</code></pre>
</div>
</div>
<p>As with <code>if_else</code> and <code>case_when</code>, <code>recode</code> is strict about preserving data types and classes. So if you want to recode a factor level to <code>NA</code> make sure to use <code>NA_character_</code> or <code>as.character(NA)</code>. <code>recode</code> will automatcially convert the character value to a factor if the input vector (<code>x</code> in our example) is a factor.</p>
<p>Note that <code>recode</code> can also be used with numeric and character data types (i.e.&nbsp;vectors devoid of class attributes). For example,</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-33_cd952d68e44f7cb7e0346df8dafd49db">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of recoding a character vector</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">recode</span>(y , <span class="st">"pear"</span> <span class="ot">=</span> <span class="st">"apple"</span>, <span class="st">"banana"</span> <span class="ot">=</span> <span class="st">"pineapple"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "apple"     "pineapple" "pineapple" "apple"     "apple"    </code></pre>
</div>
</div>
<section id="note-on-replacing-na-factor-levels" class="level4" data-number="9.3.3.1">
<h4 data-number="9.3.3.1" class="anchored" data-anchor-id="note-on-replacing-na-factor-levels"><span class="header-section-number">9.3.3.1</span> Note on replacing NA factor levels</h4>
<p>One operation you cannot perform with <code>recode</code> is converting an <code>NA</code> level to another factor level. For example, the following will generate an error message:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-34_98d7003d42d0a83b4228d9d723d2a664">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] apple  &lt;NA&gt;   banana pear   apple 
Levels: apple banana pear</code></pre>
</div>
</div>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-35_fa89ab522610542184c98936b57a2469">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recode</span>(x, <span class="at">NA =</span> <span class="st">"other"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Error: unexpected '=' in "recode(x, NA ="</code></pre>
<p>The simplest solution is to make use of a specialized factor package called <code>forcats</code> and its function, <code>fct_explicit_na</code>.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-36_8f807cbc708839bf080ab1e27b26cdf5">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">fct_explicit_na</span>(x, <span class="at">na_level =</span> <span class="st">"Other"</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] apple  Other  banana pear   apple 
Levels: apple banana pear Other</code></pre>
</div>
</div>
</section>
</section>
<section id="changing-values-based-on-multiple-conditions-case_when" class="level3" data-number="9.3.4">
<h3 data-number="9.3.4" class="anchored" data-anchor-id="changing-values-based-on-multiple-conditions-case_when"><span class="header-section-number">9.3.4</span> Changing values based on multiple conditions: <code>case_when</code></h3>
<p><code>ifelse</code> and <code>if_else</code> work great when a single set of conditions is to be satisfied. But if multiple sets of conditions are to be tested, nested if/else statements become cumbersome and are prone to clerical error. The following code highlights an example of nested if/else statements.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-37_a0fe914e7f05faf5ab2ed9a8e04367c7">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>unit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"F"</span>,<span class="st">"F"</span>,<span class="st">"C"</span>, <span class="st">"K"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">if_else</span>( unit <span class="sc">==</span> <span class="st">"C"</span>, <span class="st">"Celsius"</span>, <span class="fu">if_else</span>(unit <span class="sc">==</span> <span class="st">"F"</span>, <span class="st">"Fahrenheit"</span>, <span class="st">"Kelvin"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fahrenheit" "Fahrenheit" "Celsius"    "Kelvin"    </code></pre>
</div>
</div>
<p>A simpler solution is to use the <code>recode</code> function discussed in the previous section.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-38_1765e3c6376f95ddc08a92945222a20c">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">recode</span>(unit, <span class="st">"C"</span> <span class="ot">=</span> <span class="st">"Celsius"</span>,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"F"</span> <span class="ot">=</span> <span class="st">"Fahrenheit"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"K"</span> <span class="ot">=</span> <span class="st">"Kelvin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fahrenheit" "Fahrenheit" "Celsius"    "Kelvin"    </code></pre>
</div>
</div>
<p><code>recode</code> is well suited for replacing values but it will not allow for more complex operations. For example, given two vectors, <code>unit</code> and <code>temp</code>, we would like to convert all <code>temp</code> values to Fahrenheit by applying a temperature conversion dependent on the <code>unit</code> value.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-39_bc500a95621d7c7b18338a6987e056fc">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">45.2</span>, <span class="fl">56.3</span>, <span class="fl">11.0</span>, <span class="dv">285</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This operation is best performed using the <code>case_when</code> function.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-40_cdb39cc94c08f338d0d6e448956f279a">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(unit <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> temp,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>          unit <span class="sc">==</span> <span class="st">"C"</span> <span class="sc">~</span> (temp <span class="sc">*</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span> <span class="dv">32</span>,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> (temp <span class="sc">-</span> <span class="fl">273.15</span>) <span class="sc">*</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">5</span> <span class="sc">+</span> <span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45.20 56.30 51.80 53.33</code></pre>
</div>
</div>
<p>The last parameter, <code>TRUE ~</code>, applies to all conditions not satisfied by the previous two conditions (otherwise, not doing so would return <code>NA</code> values).</p>
<p>Note that the order in which these conditions are listed matters since evaluation stops at the first <code>TRUE</code> outcome encountered. So, had the last condition been moved to the top of the stack, all <code>temp</code> values would be assigned the first conversion option.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-41_35186a3488781d4054e099f43ffa9b4d">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What not to do ...</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(<span class="cn">TRUE</span> <span class="sc">~</span> (temp <span class="sc">-</span> <span class="fl">273.15</span>) <span class="sc">*</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">5</span> <span class="sc">+</span> <span class="dv">32</span>,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>          unit <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> temp,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>          unit <span class="sc">==</span> <span class="st">"C"</span> <span class="sc">~</span> (temp <span class="sc">*</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span> <span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -378.31 -358.33 -439.87   53.33</code></pre>
</div>
</div>
<p>As with the <code>if_else</code> function, <code>case_when</code> is strict about data type in that all output must be of the same data type.</p>
<p>Note that <code>ifelse</code>, <code>if_else</code>, <code>recode</code> and <code>case_when</code> can all be used inside of a <code>mutate</code> function. For example, to replace <code>Canada</code> and <code>United States of America</code> in variable <code>Country</code> with <code>CAN</code> and <code>USA</code> respectively and to create a new variable called <code>Type</code> which will take on the values of <code>1</code>, <code>2</code> or <code>3</code> depending on the values in variable <code>Source</code>, type the following:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-42_82a782e8613a278cb7286f5cccedc47f">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Country =</span> <span class="fu">recode</span>(Country, <span class="st">"Canada"</span> <span class="ot">=</span> <span class="st">"CAN"</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"United States of America"</span> <span class="ot">=</span> <span class="st">"USA"</span>),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Type =</span> <span class="fu">case_when</span>(Source <span class="sc">==</span> <span class="st">"Calculated data"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                          Source <span class="sc">==</span> <span class="st">"Official data"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">3</span>)) </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat1)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Country         Crop         Information Year      Value          Source Type
1     CAN       Barley Area harvested (Ha) 2012 2060000.00   Official data    2
2     CAN       Barley       Yield (Hg/Ha) 2012   38894.66 Calculated data    1
3     CAN    Buckwheat Area harvested (Ha) 2012       0.00    FAO estimate    3
4     CAN  Canary seed Area harvested (Ha) 2012  101900.00   Official data    2
5     CAN  Canary seed       Yield (Hg/Ha) 2012   12161.92 Calculated data    1
6     CAN Grain, mixed Area harvested (Ha) 2012   57900.00   Official data    2</code></pre>
</div>
</div>
<p>&nbsp;&nbsp;</p>
</section>
</section>
<section id="miscellaneous" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="miscellaneous"><span class="header-section-number">9.4</span> Miscellaneous</h2>
<section id="replacing-values-with-na" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="replacing-values-with-na"><span class="header-section-number">9.4.1</span> Replacing values with <code>NA</code></h3>
<p>You can replace a specific set of values (numeric or character) using the <code>na_if()</code> function. For example, to replace <code>-999</code> with <code>NA</code>:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-43_b8eca04db7fc56a79334dddafbc615b1">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">999</span>, <span class="dv">6</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">999</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">na_if</span>( val , <span class="sc">-</span><span class="dv">999</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA  6 -1 NA</code></pre>
</div>
</div>
<p>Likewise, to replace all empty character values:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-44_229bc952780287c0ecb2153b33da184e">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ab"</span>, <span class="st">""</span>, <span class="st">"A b"</span>, <span class="st">"  "</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">na_if</span>( val , <span class="st">""</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ab"  NA    "A b" "  " </code></pre>
</div>
</div>
<p>Note that <code>na_if()</code> will return the datatype passed to its first argument and not necessarily that of the parent vector. For example, if you use <code>stringr</code>’s <code>str_length()</code> function to identify zero length vectors in a character vector, you get a numeric output.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-45_a6a01067cd5488995a68da2e8ccbef3b">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ab"</span>, <span class="st">""</span>, <span class="st">"A b"</span>, <span class="st">"  "</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">na_if</span>( <span class="fu">str_length</span>(val) , <span class="dv">0</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2 NA  3  2</code></pre>
</div>
</div>
<p>To use <code>na_if()</code> in a piping operation, it needs to be embedded in a <code>mutate()</code> function.</p>
</section>
<section id="outputting-a-vector-instead-of-a-table-using-pull" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="outputting-a-vector-instead-of-a-table-using-pull"><span class="header-section-number">9.4.2</span> Outputting a vector instead of a table using <code>pull</code></h3>
<p>Piping operations will output a table, even if a single value is returned. For example, the following summarization operation returns the total oats yield as a data table:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-46_408c82b06ceaac48bc86c84fa116ce9f">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>oats <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>         Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Oats_sum =</span> <span class="fu">sum</span>(Value))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>oats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Oats_sum
1  2169334</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(oats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>There may be times when you want to output as a vector element and not a data table. To output a vector, use the <code>pull()</code> function.</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-47_024ecc455eda8891327842224b07dc07">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>oats <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>         Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Oats_sum =</span> <span class="fu">sum</span>(Value)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>oats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2169334</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(oats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>The <code>pull</code> function can also be used to convert a data table column to a multi-element vector, e.g.:</p>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-48_5ac2c1f9a397ca4694424cc295dbfd73">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This outputs a one column table</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>yield <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>         Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Value)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(yield)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Value
1 24954.79
2 21974.70
3 29109.36
4 20492.37
5 27364.53
6 23056.62</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(yield)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<div class="cell" data-hash="dplyr_cache/html/unnamed-chunk-49_c9fc63cbeb534e1f4921e18f8781c9df">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This outputs a multi-element vector</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>yield <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Crop <span class="sc">==</span> <span class="st">"Oats"</span>,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>         Information <span class="sc">==</span> <span class="st">"Yield (Hg/Ha)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Value)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(yield)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24954.79 21974.70 29109.36 20492.37 27364.53 23056.62</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(yield)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./subset_base.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Subsetting and replacing values using base functions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./group_by.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Grouping and summarizing</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Manny Gimond, Creative Commons License <a href="https://creativecommons.org/licenses/by-nc/4.0/"><img src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" class="img-fluid"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>