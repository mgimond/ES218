<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploratory Data Analysis in R - 17&nbsp; Comparing data distributions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./theoretical_qq.html" rel="next">
<link href="./univariate_plots.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CJW3PSXZC2"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CJW3PSXZC2', { 'anonymize_ip': true});
</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="libs/style.css">
</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./univariate_plots.html">Univariate</a></li><li class="breadcrumb-item"><a href="./compare_batches.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Comparing data distributions</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Intro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">EDA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./The_R_environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The R and RStudio Environments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Object Type and Structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./read_write_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reading and Writing Data Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./date_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with string objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boolean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Relational and boolean operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subset_base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Subsetting and replacing values using base functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Manipulating data tables with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./group_by.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Grouping and summarizing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Tidying/reshaping tables with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Joining Data Tables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Plots</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Base plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lattice_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Lattice plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ggplot2 plotting environment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Univariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Visualizing univariate distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_batches.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Comparing data distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theoretical_qq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">The theoretical q-q</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Univariate analysis: Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sl_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Spread-level plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./re_express.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Re-expressing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./letter_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Letter value summaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fine-tuning re-expression and Robust statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Bivariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resistant_lines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Resistant lines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">The third R of EDA: Residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discontinuity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Slicing data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Two-way tables</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./two_way.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Analyzing two-way tables: The median polish</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">R markdown document</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Mapping variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Data used in ES218</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#boxplots" id="toc-boxplots" class="nav-link active" data-scroll-target="#boxplots"><span class="header-section-number">17.1</span> Boxplots</a></li>
  <li><a href="#the-quantile-quantile-q-q-plot" id="toc-the-quantile-quantile-q-q-plot" class="nav-link" data-scroll-target="#the-quantile-quantile-q-q-plot"><span class="header-section-number">17.2</span> The quantile-quantile (Q-Q) plot</a>
  <ul class="collapse">
  <li><a href="#manual-construction-of-a-q-q-plot" id="toc-manual-construction-of-a-q-q-plot" class="nav-link" data-scroll-target="#manual-construction-of-a-q-q-plot"><span class="header-section-number">17.2.1</span> Manual construction of a q-q plot</a></li>
  <li><a href="#using-the-base-qqplot" id="toc-using-the-base-qqplot" class="nav-link" data-scroll-target="#using-the-base-qqplot"><span class="header-section-number">17.2.2</span> Using the base <code>qqplot</code></a></li>
  </ul></li>
  <li><a href="#q-q-plots-vs.-traditional-scatter-plots" id="toc-q-q-plots-vs.-traditional-scatter-plots" class="nav-link" data-scroll-target="#q-q-plots-vs.-traditional-scatter-plots"><span class="header-section-number">17.3</span> q-q plots vs.&nbsp;traditional scatter plots</a></li>
  <li><a href="#what-can-we-learn-from-a-q-q-plot" id="toc-what-can-we-learn-from-a-q-q-plot" class="nav-link" data-scroll-target="#what-can-we-learn-from-a-q-q-plot"><span class="header-section-number">17.4</span> What can we learn from a q-q plot?</a>
  <ul class="collapse">
  <li><a href="#additive-offset" id="toc-additive-offset" class="nav-link" data-scroll-target="#additive-offset"><span class="header-section-number">17.4.1</span> Additive offset</a></li>
  <li><a href="#multiplicative-offset" id="toc-multiplicative-offset" class="nav-link" data-scroll-target="#multiplicative-offset"><span class="header-section-number">17.4.2</span> Multiplicative offset</a></li>
  </ul></li>
  <li><a href="#additive-and-multiplicative-offsets" id="toc-additive-and-multiplicative-offsets" class="nav-link" data-scroll-target="#additive-and-multiplicative-offsets"><span class="header-section-number">17.5</span> Additive and multiplicative offsets</a>
  <ul class="collapse">
  <li><a href="#is-the-relationship-between-tenor-and-bass-additive-or-multiplicative" id="toc-is-the-relationship-between-tenor-and-bass-additive-or-multiplicative" class="nav-link" data-scroll-target="#is-the-relationship-between-tenor-and-bass-additive-or-multiplicative"><span class="header-section-number">17.5.1</span> Is the relationship between tenor and bass additive or multiplicative?</a></li>
  </ul></li>
  <li><a href="#the-tukey-mean-difference-plot" id="toc-the-tukey-mean-difference-plot" class="nav-link" data-scroll-target="#the-tukey-mean-difference-plot"><span class="header-section-number">17.6</span> The Tukey mean-difference plot</a>
  <ul class="collapse">
  <li><a href="#generating-a-tukey-m-d-plot-using-ggplot" id="toc-generating-a-tukey-m-d-plot-using-ggplot" class="nav-link" data-scroll-target="#generating-a-tukey-m-d-plot-using-ggplot"><span class="header-section-number">17.6.1</span> Generating a Tukey m-d plot using <code>ggplot</code></a></li>
  </ul></li>
  <li><a href="#pairwise-q-q-plots" id="toc-pairwise-q-q-plots" class="nav-link" data-scroll-target="#pairwise-q-q-plots"><span class="header-section-number">17.7</span> Pairwise q-q plots</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Comparing data distributions</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-2_8ab57bccfbc0659cbba48788614d4b29">
<div class="cell-output-display">

<table data-quarto-disable-processing="true" class="table" style="width: auto !important; ">
 <thead>
  <tr>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> dplyr </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> ggplot2 </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> lattice </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.1.4 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 3.4.4 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 0.22.5 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Let’s compare singer heights between the <code>Bass 2</code> group and <code>Tenor 1</code> group. We will work off of a subset of Cleveland’s <code>singer</code> dataset which can be found in the <code>lattice</code> package.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-3_9f5a78a6660672343ced5825171ac3ee">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>df  <span class="ot">&lt;-</span> lattice<span class="sc">::</span>singer</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(df, voice.part <span class="sc">==</span> <span class="st">"Bass 2"</span> <span class="sc">|</span> voice.part<span class="sc">==</span><span class="st">"Tenor 1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">voice.part =</span> <span class="fu">droplevels</span>(voice.part))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s plot both datasets side-by-side. We will jitter the points about their category groups to expose overlapping points.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-4_e1860b6b39c748ba5fe6f2d13eca6288">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">y=</span>height, <span class="at">x=</span>voice.part, <span class="at">col=</span>voice.part)) <span class="sc">+</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_jitter</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> .<span class="dv">1</span>, <span class="at">height=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Let’s get the count and median values for both batches.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-5_632bbf951988b4006090d33343194cb0">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(voice.part) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">median =</span> <span class="fu">median</span>(height), <span class="at">count =</span> <span class="fu">n</span>() )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  voice.part median count
  &lt;fct&gt;       &lt;dbl&gt; &lt;int&gt;
1 Bass 2         72    26
2 Tenor 1        68    21</code></pre>
</div>
</div>
<p>The basest tend to be slightly taller than the Tenor–this is one way to compare the batches. But how do their distributions differ? We will explore this in the next section.</p>
<p>&nbsp;&nbsp;</p>
<section id="boxplots" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="boxplots"><span class="header-section-number">17.1</span> Boxplots</h2>
<p>We can compare the batches using side-by-side boxplots.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-6_982a67a0ff650edebc9f18175cfe89f5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2) <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> voice.part, <span class="at">y =</span> height) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>The differences in median values is obvious. What’s more, the difference in overall height values is more pronounced with the boxplot than it is with a simple point distributions plot shown earlier.</p>
<p>Are the spreads between the batches comparable? It’s difficult to tell given that the batches are offset by about four inches. So let’s level the playing field by subtracting the median values from their respective batches.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-7_eaa345ea35fa8c48ef965b05722d6a44">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df2.med <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">group_by</span>(voice.part) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>( <span class="at">NormHeight =</span> height <span class="sc">-</span> <span class="fu">median</span>(height)) </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2.med, <span class="fu">aes</span>(<span class="at">x=</span>voice.part, <span class="at">y=</span>NormHeight)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>Leveling the boxplots certainly helps in assessing the difference in spreads. It seems that the <code>Tenor 1</code> group has a slightly wider range of heights than the <code>Bass 2</code> group. About 50% of singers in the <code>Tenor 1</code> group have heights that range five inches whereas the singers in the <code>Bass 2</code> group have heights that range four inches. We also note that the <code>Tenor 1</code> height distribution tends to be skewed towards taller singers whereas the <code>Bass 2</code> height distribution tends to be a little less skewed toward smaller heights.</p>
</section>
<section id="the-quantile-quantile-q-q-plot" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="the-quantile-quantile-q-q-plot"><span class="header-section-number">17.2</span> The quantile-quantile (Q-Q) plot</h2>
<p>A quantile-quantile plot (or Q-Q plot for short) combines two separate quantile plots from different batches of values by pairing the point values by their common <span class="math inline">\(f\)</span>-value.</p>
<p><img src="img/QQ_plot.png" class="img-fluid"></p>
<p>To generate a q-q plot, we first need to compute the <span class="math inline">\(f\)</span>-values for both batches of singer data (<code>Bass 2</code> and <code>Tenor 1</code>).</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-8_4fa4521b2f4a2d06bf89fd5292f74e99">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.qq <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">group_by</span>(voice.part) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">arrange</span>(height) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>( <span class="at">f.val =</span> (<span class="fu">row_number</span>() <span class="sc">-</span> <span class="fl">0.5</span> ) <span class="sc">/</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s generate quantile plots for both batches.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-9_0a6612d197694586e0569e1a61979f33">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.qq, <span class="fu">aes</span>(<span class="at">x=</span>f.val, <span class="at">y =</span> height)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">col=</span><span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>( voice.part <span class="sc">~</span> .) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>While the geometric structure of a boxplot lends itself well to side-by-side comparison, the same cannot be said for side-by-side quantile plot comparison hence the need for an amalgamation of these two plots into a <strong>quantile-quantile</strong> (<strong>q-q</strong>) plot. If the number of values in both batches are equal, then the plotting process is straightforward: sort both batches (from smallest value to largest value), then pair up the sorted values and plot one batch vs.&nbsp;the other batch.</p>
<p>If the two batches differ in size (as is the case with our example where we have 21 tenors and 26 bassists), we won’t be able to match sorted values. For example, in the above graph, you’ll note that one of the singer’s height in the <code>Bass 2</code> batch is associated with an <span class="math inline">\(f\)</span>-value of 0.75, however, there are no singer heights associated with an <span class="math inline">\(f\)</span>-value of 0.75 in the <code>Tenor 1</code> batch.</p>
<p>To overcome the problem of batch size mismatch, we limit the number of points in the q-q plot to the number of values associated with the <em>smallest</em> sized batch (21 in our working example). This requires that we find matching singer height values to the set of <span class="math inline">\(f\)</span>-values associated with a batch of 21 values. The following chunk of code computes the 21 <span class="math inline">\(f\)</span>-values. We are rounding the output to two decimal places for presentation only.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-10_171a8e5bbf481b0c8a53d02894298967">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and index</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>i  <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the f-values</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>fi <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="dv">21</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># view rounded values</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(fi,<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.02 0.07 0.12 0.17 0.21 0.26 0.31 0.36 0.40 0.45 0.50 0.55 0.60 0.64 0.69 0.74 0.79 0.83 0.88 0.93 0.98</code></pre>
</div>
</div>
<p>To find the matching singer height values in <code>Bass2</code>, we need to interpolate the original height values. In practice, a linear interpolation is sought unless theory justifies otherwise.</p>
<p>We will explore two methods:</p>
<ul>
<li>a <em>manual</em> approach to constructing a q-q plot;</li>
<li>using the built-in <code>qqplot()</code> function.</li>
</ul>
<p>In all cases, we will add a 45° line (i.e.&nbsp;the <code>Bass 1</code> <span class="math inline">\(=\)</span> <code>Tenor 1</code> line) that shows where we would expect the points to be plotted if both distributions were identical.</p>
<section id="manual-construction-of-a-q-q-plot" class="level3" data-number="17.2.1">
<h3 data-number="17.2.1" class="anchored" data-anchor-id="manual-construction-of-a-q-q-plot"><span class="header-section-number">17.2.1</span> Manual construction of a q-q plot</h3>
<p>To find a value in the larger dataset (i.e.&nbsp;<code>Bass 2</code>) that matches the 21 quantiles of the smaller dataset, <code>Tenor 1</code>, we can use the <code>approx()</code> function.</p>
<p>First, we will extract all values associated with <code>Bass 2</code> from the dataset.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-11_90eee540cc3ce3781260ba73d4c38733">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df.bass  <span class="ot">&lt;-</span> df.qq <span class="sc">%&gt;%</span>  <span class="fu">filter</span>( voice.part <span class="sc">==</span> <span class="st">"Bass 2"</span>) </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df.tenor <span class="ot">&lt;-</span> df.qq <span class="sc">%&gt;%</span>  <span class="fu">filter</span>( voice.part <span class="sc">==</span> <span class="st">"Tenor 1"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we will interpolate a new set of height values for <code>Bass 2</code> that match the 21 quantile values in <code>fi</code>.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-12_b101b32932e5607cafe29dd2120ed47e">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>b.hgt.interp <span class="ot">&lt;-</span> <span class="fu">approx</span>(df.bass<span class="sc">$</span>f.val, df.bass<span class="sc">$</span>height, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output generates two columns: the 21 quantiles, <code>fi</code>, and the 21 <code>Bass 2</code> interpolated height values. Note that we could have substituted <code>fi</code> with <code>df.tenor$f.val</code>. The approach shown here is used to reinforce the idea that we are interpolating height values based on a <em>new</em> set of f-values.</p>
<p>Finally, we will combine the interpolated <code>Bass 2</code> values (which is already in an ascending order) with <strong>sorted</strong> heights for the <code>Tenor 1</code> singers (these were sorted in <code>df.qq</code>). Then, we will plot the paired values using <code>ggplot</code>. We will also add the 45° line to facilitate comparison.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-13_841899d6505f5efaeac86a490db2d0d0">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>s.qq <span class="ot">&lt;-</span> df.tenor <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Bass 2</span><span class="st">`</span>  <span class="ot">=</span> b.hgt.interp<span class="sc">$</span>y) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">rename</span>(<span class="st">`</span><span class="at">Tenor 1</span><span class="st">`</span> <span class="ot">=</span> height) </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s.qq, <span class="fu">aes</span>( <span class="at">x=</span> <span class="st">`</span><span class="at">Tenor 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Bass 2</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>( <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>Note that the range of values for both axes may not match; this may influence our visual assessment of the differences. To remedy this, we can force a fixed aspect ratio between both axes.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-14_f14e9fbef4656f3391c4e6e9b449f1a4">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the range of both datasets</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>xylim <span class="ot">&lt;-</span> <span class="fu">range</span>( <span class="fu">c</span>(s.qq<span class="sc">$</span><span class="st">"Bass"</span>, s.qq<span class="sc">$</span><span class="st">`</span><span class="at">Tenor 1</span><span class="st">`</span>) )</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a 5% buffer to the xy limits</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (This avoids having the points plotted on the edge of the plot)</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>xylim <span class="ot">&lt;-</span> xylim <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">diff</span>(xylim), <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> <span class="fu">diff</span>(xylim))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s.qq, <span class="fu">aes</span>( <span class="at">x=</span> <span class="st">`</span><span class="at">Tenor 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Bass 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_abline</span>( <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>             <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">xlim=</span>xylim, <span class="at">ylim =</span> xylim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="288"></p>
</div>
</div>
</section>
<section id="using-the-base-qqplot" class="level3" data-number="17.2.2">
<h3 data-number="17.2.2" class="anchored" data-anchor-id="using-the-base-qqplot"><span class="header-section-number">17.2.2</span> Using the base <code>qqplot</code></h3>
<p>This approach is quicker and requires fewer lines of code, but it does not afford the insight into the inner workings of a q-q plot as does the manual approach from the previous section.</p>
<p><code>qqplot</code> is a base package that will generate a q-q plot using the base plotting environment. It requires that the two batches be loaded as separate vector objects.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-15_3f7f14b76e65ebc1fb825231ecdff7d0">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Tenor <span class="ot">&lt;-</span> <span class="fu">filter</span>(df, voice.part <span class="sc">==</span> <span class="st">"Tenor 1"</span>) <span class="sc">%&gt;%</span>  <span class="fu">pull</span>(height)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Bass  <span class="ot">&lt;-</span> <span class="fu">filter</span>(df, voice.part <span class="sc">==</span> <span class="st">"Bass 2"</span>)  <span class="sc">%&gt;%</span>  <span class="fu">pull</span>(height)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqplot</span>(<span class="at">x=</span>Tenor, <span class="at">y=</span>Bass, <span class="at">asp=</span><span class="dv">1</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p><code>qqplot</code> offers the option to output the q-q plot values (including the interpolated values) as a <strong>list</strong> by setting the parameter <code>plot.it=FALSE</code>. We then need to convert this list object to a dataframe using <code>as.data.frame</code>. The output can then be used in a call to <code>ggplot</code>.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-16_36f8fcfabacaad615fbb8f1142c8b2b2">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the quantile-quantile data table</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>qq.out <span class="ot">&lt;-</span> <span class="fu">qqplot</span>(<span class="at">x=</span>Tenor, <span class="at">y=</span>Bass, <span class="at">plot.it=</span><span class="cn">FALSE</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>qq.out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(qq.out)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the x and y limits</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>xylim <span class="ot">&lt;-</span> <span class="fu">range</span>( <span class="fu">c</span>(qq.out<span class="sc">$</span>x, qq.out<span class="sc">$</span>y) )</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the QQ plot</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(qq.out, <span class="fu">aes</span>( <span class="at">x=</span> x, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">geom_abline</span>( <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">xlim=</span>xylim, <span class="at">ylim =</span> xylim) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">xlab</span>(<span class="st">"Tenor"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Bass"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>Note that <code>qqplot</code> generates a wide table where the <code>Tenor</code> height values and the interpolated <code>Bass</code> values are side-by-side (note that <code>x</code> and <code>y</code> were assigned when we called the <code>qqplot</code> function in the last code chunk).</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-17_5b0ccacae5b5b335eaf95109402dba0a">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(qq.out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x    y
1 64 66.0
2 64 67.0
3 65 67.5
4 66 68.0
5 66 69.0
6 66 70.0</code></pre>
</div>
</div>
</section>
</section>
<section id="q-q-plots-vs.-traditional-scatter-plots" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="q-q-plots-vs.-traditional-scatter-plots"><span class="header-section-number">17.3</span> q-q plots vs.&nbsp;traditional scatter plots</h2>
<p>It’s important to note the difference between a quantile-quantile plot and a <em>traditional</em> <a href="https://en.wikipedia.org/wiki/Scatter_plot">scatter plot</a> whereby the pairing of values between variables is explicitly defined (for example average male and female income values paired by county). The singer data does not assume any pairing of observations (e.g.&nbsp;the height measurement for a singer in <code>Bass 2</code> is independent for that of a singer in <code>Tenor 2</code>). This is made more evident with our working example which has unequal number of singers in both groups being compared. The pairing of values in a q-q plot is constructed from the <em>ordering</em> of values in each batch and nothing more.</p>
</section>
<section id="what-can-we-learn-from-a-q-q-plot" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="what-can-we-learn-from-a-q-q-plot"><span class="header-section-number">17.4</span> What can we learn from a q-q plot?</h2>
<section id="additive-offset" class="level3" data-number="17.4.1">
<h3 data-number="17.4.1" class="anchored" data-anchor-id="additive-offset"><span class="header-section-number">17.4.1</span> Additive offset</h3>
<p>A valuable by-product of an empirical q-q plot is the mathematical relationship between the batches of values. If the distributions are identical (i.e.&nbsp;all the points of a q-q plot fall on the 45° line) then we could characterize the relationship as <code>batch1 = batch2</code>.</p>
<p>If the points follow a pattern mimicking a line parallel to the 45° line as in the following plot, then we say that there is an <strong>additive shift</strong> between <code>batch1</code> and <code>batch2</code>.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-18_ca2d6608fd9ec262240e57796eb7447d">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>An additive shift between batches results in an offset in density distributions with matching shape as shown in the the figure on the right.</p>
<p>The shift can usually be eyeballed from the plot. In this example, the shift is around 2 units or <code>batch2 =  batch1 + 2</code>.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-19_ddb2cb670710842e12a14a1a1eca2134">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Adding 2 to <code>batch1</code> lines the points up along the 45° line. This translates to overlapping the density plots as shown on the right.</p>
</section>
<section id="multiplicative-offset" class="level3" data-number="17.4.2">
<h3 data-number="17.4.2" class="anchored" data-anchor-id="multiplicative-offset"><span class="header-section-number">17.4.2</span> Multiplicative offset</h3>
<p>When the points follow a line at an angle to the 45° line as in the following plot, then we say that there is a <strong>multiplicative shift</strong> between the batches.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-20_cabf1269a09a9f69f62fa008bf8b2244">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>A multiplicative shift between the batches results in a change in density shapes with one batch’s density being shorter and wider (<code>batch2</code> in this example) than that of the other batch (<code>batch1</code> in this example).</p>
<p>The multiplier can be a bit difficult to glean graphically so trial and error may be the best approach whereby we multiply one of the batches by a multiplier. For example, after some experimenting, we arrive at a multiplier of 2 which seems to do a good job in aligning the q-q points along the 45° line. We thus define a relationship of <code>batch2 = batch1 * 2</code>.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-21_4acb611ec5b3d63a546aa5d20c1ba686">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>Notice how applying a multiplier not only re-aligns the shape of both densities, but it also corrects the offset observed between both density distributions in the previous figure.</p>
</section>
</section>
<section id="additive-and-multiplicative-offsets" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="additive-and-multiplicative-offsets"><span class="header-section-number">17.5</span> Additive and multiplicative offsets</h2>
<p>Sometimes, you might encounter a relationship that is both additive <em>and</em> multiplicative in which case you should first resolve the multiplicative part of the pattern until the points are close to being parallel with the 45° line. Once the multiplicative component is taken care of, resolve the additive portion.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-22_6a87eb089eaeab0735fdd33a9703a6dc">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>The above dataset can be decomposed into its multiplicative component (multiply <code>batch1</code> by ~ 1.5),</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-23_6c6f2836b45f7b159de2a48b56f3ff24">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>then by its additive component (we’ll try and additive offset of 4):</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-24_59deb71afc34150130dab44be0456b03">
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>The relationship between both batches can thus be defined by <code>batch2 = batch1 * 1.5 + 4</code>.</p>
<section id="is-the-relationship-between-tenor-and-bass-additive-or-multiplicative" class="level3" data-number="17.5.1">
<h3 data-number="17.5.1" class="anchored" data-anchor-id="is-the-relationship-between-tenor-and-bass-additive-or-multiplicative"><span class="header-section-number">17.5.1</span> Is the relationship between tenor and bass additive or multiplicative?</h3>
<p>Turning back to our voice part dataset, an additive shift is apparent, but a multiplicative shift not as much. To check, we’ll add 2.5 to the <code>Bass 2</code> value.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-25_43f3610768d5c1649701ba8cc1e1254d">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(s.qq, <span class="fu">aes</span>( <span class="at">x=</span> <span class="st">`</span><span class="at">Tenor 1</span><span class="st">`</span> <span class="sc">+</span> <span class="fl">2.5</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Bass 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">geom_abline</span>( <span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">80</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">65</span>,<span class="dv">80</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Tenor 1 + 2.5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>The bulk of the data appears to follow an additive shift except for one or two outliers at the upper end of the distribution. These outliers should not mislead us into assuming that a multiplicative offset is warranted here.</p>
</section>
</section>
<section id="the-tukey-mean-difference-plot" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="the-tukey-mean-difference-plot"><span class="header-section-number">17.6</span> The Tukey mean-difference plot</h2>
<p>Our eyes are better suited at judging deviations from a horizontal line than from a 45° line. All that is required is to subtract the y-value (<code>Bass2</code>) from the x-value (<code>Tenor 2</code>) then compare the difference to the mean of the two values:</p>
<p><span class="math display">\[
Y = Bass- Tenor
\]</span> <span class="math display">\[
X = \frac{Bass + Tenor}{2}
\]</span></p>
<p>This forces the 45° line in the previous q-q plots to a 0° slope. The final plot is a <strong>Tukey mean-difference</strong> plot or <strong>m-d</strong> for short.</p>
<section id="generating-a-tukey-m-d-plot-using-ggplot" class="level3" data-number="17.6.1">
<h3 data-number="17.6.1" class="anchored" data-anchor-id="generating-a-tukey-m-d-plot-using-ggplot"><span class="header-section-number">17.6.1</span> Generating a Tukey m-d plot using <code>ggplot</code></h3>
<p>We continue with the <code>qq.out</code> dataset generated from the <code>qqplot</code> function.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-26_5c76d29964b737affadbcdba5822059d">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>md.y  <span class="ot">&lt;-</span> (qq.out<span class="sc">$</span>y <span class="sc">-</span> qq.out<span class="sc">$</span>x) </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>md.x  <span class="ot">&lt;-</span> (qq.out<span class="sc">$</span>y <span class="sc">+</span> qq.out<span class="sc">$</span>x) <span class="sc">*</span> <span class="fl">0.5</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df.md <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(md.x, md.y)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.md,  <span class="fu">aes</span>(<span class="at">x =</span> md.x, <span class="at">y =</span> md.y)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_abline</span>( <span class="at">slope=</span><span class="dv">0</span> ) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">xlab</span>(<span class="st">"Mean height (in)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Difference in height (in)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="288"></p>
</div>
</div>
<p>The units on both axes are in inches. It’s clear from this plot that differences in heights are pretty much consistent across the quantiles with an additive shift of about 2.5 inches, except near the higher quantiles for a few lone points.</p>
<p>We can leverage this plot to help fine tune the additive offset by computing the median value from the height difference values.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-27_b60e19b54b428afdce104d0530d81a83">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>md.offset <span class="ot">&lt;-</span> <span class="fu">median</span>(md.y)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>md.offset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.5</code></pre>
</div>
</div>
<p>The value of 2.5 is in agreement with what we eyeballed earlier.</p>
</section>
</section>
<section id="pairwise-q-q-plots" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="pairwise-q-q-plots"><span class="header-section-number">17.7</span> Pairwise q-q plots</h2>
<p>A <strong>pairwise q-q plot</strong> allows one to view all combinations of batch pairs. This requires that we first find the smallest batch of height values, then interpolate all other batch values to match the smallest batch quantiles. Note that the pairwise plot is symmetrical about the diagonal. Here, we’ll make use of the <code>lattice</code> package to generate the pairwise q-q plots.</p>
<div class="cell" data-hash="compare_batches_cache/html/unnamed-chunk-28_686ba2d32d63d7444302bf2a03ef9779">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Find smallest batch</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>f.rng <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">tapply</span>(singer<span class="sc">$</span>height, singer<span class="sc">$</span>voice.part, length))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define quantile function</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>fun1  <span class="ot">&lt;-</span> <span class="cf">function</span>(x,f.rng) {<span class="fu">approx</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x), <span class="fu">sort</span>(x), <span class="at">n =</span> f.rng )<span class="sc">$</span>y}</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute quantiles for all factors</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>t1    <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(singer<span class="sc">$</span>height <span class="sc">~</span> singer<span class="sc">$</span>voice.part, <span class="at">FUN=</span>fun1, <span class="at">f.rng=</span>f.rng )</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Flip table and name columns</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>t2    <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(t1[,<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(t2) <span class="ot">&lt;-</span> t1[,<span class="dv">1</span>]</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Label columns of qmat using names of voice parts.</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">splom</span>(<span class="sc">~</span>t2,  <span class="at">axis.text.cex=</span><span class="fl">0.6</span>, <span class="at">pch =</span> <span class="dv">20</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">varname.cex=</span><span class="fl">0.8</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">pscales=</span><span class="dv">3</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab=</span><span class="st">"Heights (inches)"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">prepanel.limits =</span> <span class="cf">function</span>(x) (<span class="fu">range</span>(t2)), <span class="co"># force all axes the same</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel =</span> <span class="cf">function</span>(x,y,...){</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">panel.grid</span>()</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">panel.splom</span>(x,y,...)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">panel.abline</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">col=</span><span class="st">"grey"</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>      })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="compare_batches_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="576"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./univariate_plots.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Visualizing univariate distributions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./theoretical_qq.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">The theoretical q-q</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Manny Gimond, Creative Commons License <a href="https://creativecommons.org/licenses/by-nc/4.0/"><img src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" class="img-fluid"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>