<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exploratory Data Analysis in R - 15&nbsp; ggplot2 plotting environment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./univariate_plots.html" rel="next">
<link href="./lattice_plot.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CJW3PSXZC2"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-CJW3PSXZC2', { 'anonymize_ip': true});
</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="libs/style.css">
</head>

<body class="nav-sidebar docked">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./base_plots.html">Plots</a></li><li class="breadcrumb-item"><a href="./ggplot2.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ggplot2 plotting environment</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./"></a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Intro</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">EDA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./The_R_environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The R and RStudio Environments</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Object Type and Structure</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./read_write_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Reading and Writing Data Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./date_objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Working with Dates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Working with string objects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boolean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Relational and boolean operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./subset_base.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Subsetting and replacing values using base functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Manipulating data tables with <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./group_by.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Grouping and summarizing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Tidying/reshaping tables with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./joins.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Joining Data Tables</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Plots</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./base_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Base plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lattice_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Lattice plotting environment</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ggplot2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ggplot2 plotting environment</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Univariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate_plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Visualizing univariate distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_batches.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Comparing data distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./theoretical_qq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">The theoretical q-q</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Univariate analysis: Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sl_plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Spread-level plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./re_express.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Re-expressing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./letter_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Letter value summaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./robustness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fine-tuning re-expression and Robust statistics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Bivariate</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Fits and residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resistant_lines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Resistant lines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">The third R of EDA: Residuals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discontinuity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Slicing data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Two-way tables</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./two_way.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Analyzing two-way tables: The median polish</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Miscellaneous</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rmarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">R markdown document</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Mapping variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Data used in ES218</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sample-data" id="toc-sample-data" class="nav-link active" data-scroll-target="#sample-data"><span class="header-section-number">15.1</span> Sample data</a></li>
  <li><a href="#the-ggplot2-package" id="toc-the-ggplot2-package" class="nav-link" data-scroll-target="#the-ggplot2-package"><span class="header-section-number">15.2</span> The <code>ggplot2</code> package</a></li>
  <li><a href="#geometries" id="toc-geometries" class="nav-link" data-scroll-target="#geometries"><span class="header-section-number">15.3</span> Geometries</a>
  <ul class="collapse">
  <li><a href="#geom_line" id="toc-geom_line" class="nav-link" data-scroll-target="#geom_line"><span class="header-section-number">15.3.1</span> <code>geom_line</code></a></li>
  <li><a href="#geom_point" id="toc-geom_point" class="nav-link" data-scroll-target="#geom_point"><span class="header-section-number">15.3.2</span> <code>geom_point</code></a></li>
  <li><a href="#geom_hex" id="toc-geom_hex" class="nav-link" data-scroll-target="#geom_hex"><span class="header-section-number">15.3.3</span> <code>geom_hex</code></a></li>
  <li><a href="#geom_boxplot" id="toc-geom_boxplot" class="nav-link" data-scroll-target="#geom_boxplot"><span class="header-section-number">15.3.4</span> <code>geom_boxplot</code></a></li>
  <li><a href="#geom_violin" id="toc-geom_violin" class="nav-link" data-scroll-target="#geom_violin"><span class="header-section-number">15.3.5</span> <code>geom_violin</code></a></li>
  <li><a href="#geom_histogram" id="toc-geom_histogram" class="nav-link" data-scroll-target="#geom_histogram"><span class="header-section-number">15.3.6</span> <code>geom_histogram</code></a></li>
  <li><a href="#geom_bar" id="toc-geom_bar" class="nav-link" data-scroll-target="#geom_bar"><span class="header-section-number">15.3.7</span> <code>geom_bar</code></a></li>
  <li><a href="#dot-plot" id="toc-dot-plot" class="nav-link" data-scroll-target="#dot-plot"><span class="header-section-number">15.3.8</span> dot plot</a></li>
  <li><a href="#combining-geometries" id="toc-combining-geometries" class="nav-link" data-scroll-target="#combining-geometries"><span class="header-section-number">15.3.9</span> Combining geometries</a></li>
  <li><a href="#combining-datasets" id="toc-combining-datasets" class="nav-link" data-scroll-target="#combining-datasets"><span class="header-section-number">15.3.10</span> Combining datasets</a></li>
  </ul></li>
  <li><a href="#tweaking-a-ggplot2-graph" id="toc-tweaking-a-ggplot2-graph" class="nav-link" data-scroll-target="#tweaking-a-ggplot2-graph"><span class="header-section-number">15.4</span> Tweaking a ggplot2 graph</a>
  <ul class="collapse">
  <li><a href="#plot-title" id="toc-plot-title" class="nav-link" data-scroll-target="#plot-title"><span class="header-section-number">15.4.1</span> Plot title</a></li>
  <li><a href="#axes-titles" id="toc-axes-titles" class="nav-link" data-scroll-target="#axes-titles"><span class="header-section-number">15.4.2</span> Axes titles</a></li>
  <li><a href="#axes-labels" id="toc-axes-labels" class="nav-link" data-scroll-target="#axes-labels"><span class="header-section-number">15.4.3</span> Axes labels</a></li>
  <li><a href="#axes-limits" id="toc-axes-limits" class="nav-link" data-scroll-target="#axes-limits"><span class="header-section-number">15.4.4</span> Axes limits</a></li>
  <li><a href="#axes-breaks" id="toc-axes-breaks" class="nav-link" data-scroll-target="#axes-breaks"><span class="header-section-number">15.4.5</span> Axes breaks</a></li>
  <li><a href="#axes-and-data-transformations" id="toc-axes-and-data-transformations" class="nav-link" data-scroll-target="#axes-and-data-transformations"><span class="header-section-number">15.4.6</span> Axes and data transformations</a></li>
  <li><a href="#aspect-ratio" id="toc-aspect-ratio" class="nav-link" data-scroll-target="#aspect-ratio"><span class="header-section-number">15.4.7</span> Aspect ratio</a></li>
  <li><a href="#colors" id="toc-colors" class="nav-link" data-scroll-target="#colors"><span class="header-section-number">15.4.8</span> Colors</a></li>
  <li><a href="#adding-mathematical-symbols-to-a-plot" id="toc-adding-mathematical-symbols-to-a-plot" class="nav-link" data-scroll-target="#adding-mathematical-symbols-to-a-plot"><span class="header-section-number">15.4.9</span> Adding mathematical symbols to a plot</a></li>
  </ul></li>
  <li><a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting"><span class="header-section-number">15.5</span> Faceting</a>
  <ul class="collapse">
  <li><a href="#faceting-by-categorical-variable" id="toc-faceting-by-categorical-variable" class="nav-link" data-scroll-target="#faceting-by-categorical-variable"><span class="header-section-number">15.5.1</span> Faceting by categorical variable</a></li>
  <li><a href="#facet_wrap" id="toc-facet_wrap" class="nav-link" data-scroll-target="#facet_wrap"><span class="header-section-number">15.5.2</span> <code>facet_wrap</code></a></li>
  <li><a href="#faceting-by-continuous-variable" id="toc-faceting-by-continuous-variable" class="nav-link" data-scroll-target="#faceting-by-continuous-variable"><span class="header-section-number">15.5.3</span> Faceting by continuous variable</a></li>
  </ul></li>
  <li><a href="#adding-45-slope-using-geom_abline" id="toc-adding-45-slope-using-geom_abline" class="nav-link" data-scroll-target="#adding-45-slope-using-geom_abline"><span class="header-section-number">15.6</span> Adding 45° slope using <code>geom_abline</code></a></li>
  <li><a href="#tile-plots-heat-maps" id="toc-tile-plots-heat-maps" class="nav-link" data-scroll-target="#tile-plots-heat-maps"><span class="header-section-number">15.7</span> Tile plots (heat maps)</a></li>
  <li><a href="#exporting-to-an-image" id="toc-exporting-to-an-image" class="nav-link" data-scroll-target="#exporting-to-an-image"><span class="header-section-number">15.8</span> Exporting to an image</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ggplot2 plotting environment</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-2_6d573614244dbae4c5b74ab942156910">
<div class="cell-output-display">

<table data-quarto-disable-processing="true" class="table" style="width: auto !important; ">
 <thead>
  <tr>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> dplyr </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> ggplot2 </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> forcats </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> scales </th>
   <th style="text-align:left;color: #555555 !important;background-color: #dddddd !important;text-align: center;border: 1px solid white !important;
             font-family: 'Source Code Pro', 'Open Sans';
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> hdrcde </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.1.4 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 3.4.4 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.0.0 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 1.3.0 </td>
   <td style="text-align:left;color: darkred !important;background-color: #FAE8E8 !important;text-align: center;border: 1px solid white;
             font-family: 'Open Sans', Arial;
             padding:1px !important;
             padding-left:4px !important;
             padding-right:4px !important;
             font-size: 0.8em;
             border-radius: 5px;"> 3.4 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<section id="sample-data" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="sample-data"><span class="header-section-number">15.1</span> Sample data</h2>
<p>The data files used in this tutorial can be downloaded from the course’s website as follows:</p>
<div class="cell" data-hash="ggplot2_cache/html/download_data_b44bcada39ee9f0c31538aa86547937d">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://github.com/mgimond/ES218/blob/gh-pages/Data/dat1_2.RData?raw=true"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This should load several data frame objects into your R session (note that not all are used in this exercise). The <code>dat1l</code> dataframe is a long table version of the crop yield dataset.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-3_e5df8c1094720a7a860cd484e1eb35a0">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat1l, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Crop    Yield
1 1961 Barley 16488.52
2 1962 Barley 18839.00
3 1963 Barley 18808.27</code></pre>
</div>
</div>
<p><code>dat1l2</code> adds <code>Country</code> to the <code>dat1l</code> dataframe.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-4_a3712d705a8a52dc99e32578254ce810">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat1l2, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Crop Country    Yield
1 2012 Barley  Canada 38894.66
2 2012  Maize  Canada 83611.49
3 2012   Oats  Canada 24954.79</code></pre>
</div>
</div>
<p>The <code>dat1w</code> dataframe is a wide table version of <code>dat1l</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-5_189339001be916c7d1eb80bf3fb9740d">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat1w, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year   Barley Buckwheat    Maize     Oats      Rye
1 1961 16488.52  10886.67 39183.63 15171.26 11121.79
2 1962 18839.00  11737.50 40620.80 16224.60 12892.77
3 1963 18808.27  11995.00 42595.55 16253.04 11524.11</code></pre>
</div>
</div>
<p>The <code>dat2</code> dataframe is a wide table representation of income by county and by various income and educational attainment levels. The first few lines and columns are shown:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-6_925de39d21f91bbbeefe77956a557608">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dat2[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   County State B20004001 B20004002 B20004003 B20004004 B20004005
1 Autauga    al     35881     17407     30169     35327     54917
2 Baldwin    al     31439     16970     25414     31312     44940
3 Barbour    al     25201     15643     20946     24201     42629</code></pre>
</div>
</div>
<p><code>dat2c</code> is a long version of <code>dat2</code></p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-7_8b22177270e49c68e46a44ba268158fe">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat2c, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  State                 County Level Region   All     F     M
1    ak Aleutians East Borough   All   West 21953 20164 22940
2    ak Aleutians East Borough  NoHS   West 21953 19250 22885
3    ak Aleutians East Borough    HS   West 20770 19671 21192</code></pre>
</div>
</div>
</section>
<section id="the-ggplot2-package" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="the-ggplot2-package"><span class="header-section-number">15.2</span> The <code>ggplot2</code> package</h2>
<p>The <code>ggplot2</code> package is designed around the idea that statistical graphics can be decomposed into a formal system of grammatical rules. The <code>ggplot2</code> learning curve is the steepest of all graphing environments encountered thus far, but once mastered it affords the greatest control over graphical design. For an up-to-date list of <code>ggplot2</code> functions, you may want to refer to ggplot2’s <a href="https://ggplot2.tidyverse.org/reference/">website</a>.</p>
<p>A plot in <code>ggplot2</code> consists of different <em>layering</em> components, with the three primary components being:</p>
<ul>
<li>The <strong>dataset</strong> that houses the data to be plotted;</li>
<li>The <strong>aesthetics</strong> which describe how data are to be mapped to the geometric elements (color, shape, size, etc..);</li>
<li>The <strong>geometric</strong> elements to use in the plot (i.e.&nbsp;points, lines, rectangles, etc…).</li>
</ul>
<p>Additional (optional) layering components include:</p>
<ul>
<li><strong>Statistical</strong> elements such as smoothing, binning or transforming the variable</li>
<li><strong>Facets</strong> for conditional or trellis plots</li>
<li><strong>Coordinate systems</strong> for defining the plots shape (i.e.&nbsp;cartesian, polar, spatial map projections, etc…)</li>
</ul>
<p>To access <code>ggplot2</code> functions, you will need to load its library:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-8_247381b6edc01341b25938476c50a8eb">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From a grammatical perspective, a scientific graph is the conversion of <em>data</em> to <strong>aesthetic</strong> attributes and <strong>geometric</strong> objects. This is an important concept to grasp since it underlies the construction of all graphics in <code>ggplot2</code>.</p>
<p>For example, if we want to generate a point plot of crop yield as a function of year using the <code>dat1l</code> data frame, we type:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-9_3b5ccb0fe4c53f37b570f7267deb0d43">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l , <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>where the function, <code>ggplot()</code>, is passed the data frame name whose content will be mapped; the <code>aes()</code> function is given data-to-geometry mapping instructions (<code>Year</code> is mapped to the x-axis and <code>Yield</code> is mapped to the y-axis); and <code>geom_line()</code> is the geometry type.</p>
<p><img src="img/ggplot_1.png" class="img-fluid"></p>
<p>If we wanted to include a third variable, crop type, to the map, we would need to map its aesthetics: here we’ll map <code>Crop</code> to the color element of the geom.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-10_ae79902ddabdb34076cb4150a249849a">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l , <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield, <span class="at">color =</span> Crop)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>The parameter <code>color</code> acts as a grouping parameter whereby the groups are assigned unique colors.</p>
<p><img src="img/ggplot_2.png" class="img-fluid"></p>
<p>If we want to plot lines instead of points, simply substitute the geometry type with the <code>geom_line()</code> geometry.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-11_6ce85446419c17feec8bf5e646a3b019">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l , <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield, <span class="at">color =</span> Crop)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Note that the aesthetics are still mapped in the same way with <code>Year</code> mapped to the x coordinate, <code>Yield</code> mapped to the y coordinate and <code>Crop</code> mapped to the geom’s color.</p>
<p>Note that the parameters <code>x=</code> and <code>y=</code> can be omitted from the syntax reducing the line of code to:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-12_58d3a999b7f48342bcfcead6f5bbabfe">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l , <span class="fu">aes</span>(Year, Yield, <span class="at">color =</span> Crop)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geometries" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="geometries"><span class="header-section-number">15.3</span> Geometries</h2>
<p>Examples of a few available geometric elements follow.</p>
<section id="geom_line" class="level3" data-number="15.3.1">
<h3 data-number="15.3.1" class="anchored" data-anchor-id="geom_line"><span class="header-section-number">15.3.1</span> <code>geom_line</code></h3>
<p><code>geom_line</code> generates line geometries. We’ll use data from <code>dat1w</code> to generate a simple plot of oat yield as a function of year.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-13_75cfcaf2896dae6011ade39b7b7cdd87">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1w, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Oats)) <span class="sc">+</span> <span class="fu">geom_line</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Parameters such as color and linetype can be passed directly to the <code>geom_line()</code> function:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-14_02f07f5188e49ab72445124c89eb1209">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1w, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Oats)) <span class="sc">+</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">size=</span><span class="fl">0.4</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="480"></p>
</div>
</div>
<p>Note the difference in how <code>colour=</code> is implemented here. It’s no longer <strong>mapping</strong> a variable’s levels to a range of colors as when it’s called inside of the <code>aes()</code> function, instead, it’s <strong>setting</strong> the line color to <code>blue</code>.</p>
</section>
<section id="geom_point" class="level3" data-number="15.3.2">
<h3 data-number="15.3.2" class="anchored" data-anchor-id="geom_point"><span class="header-section-number">15.3.2</span> <code>geom_point</code></h3>
<p>This generates point geometries. This is often used in generating scatterplots. For example, to plot male income (variable <code>B20004013</code>) vs female income (variable <code>B20004007</code>), type:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-15_6711111e58cad333e7e64aa19513ae5b">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>We modify the point’s transparency by passing the <code>alpha=0.3</code> parameter to the <code>geom_point</code> function. Other parameters that can be passed to point geoms include <code>colour</code>, <code>pch</code> (point symbol type) and <code>cex</code> (point size as a fraction).</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-16_142010f3703aa0b82d6870f47a7c397b">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">pch=</span><span class="dv">3</span> , <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">cex=</span><span class="fl">0.6</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="geom_hex" class="level3" data-number="15.3.3">
<h3 data-number="15.3.3" class="anchored" data-anchor-id="geom_hex"><span class="header-section-number">15.3.3</span> <code>geom_hex</code></h3>
<p>When a bivariate scatter plot has too many overlapping points, it may be helpful to <em>bin</em> the observations into regular hexagons. This provides the number of observations per bin.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-17_2ec96c7fd092772c307d7bf98aa24f84">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="at">binwidth =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1000</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The <code>binwidth</code> argument defines the width and height of each bin in the variables’ axes units.</p>
</section>
<section id="geom_boxplot" class="level3" data-number="15.3.4">
<h3 data-number="15.3.4" class="anchored" data-anchor-id="geom_boxplot"><span class="header-section-number">15.3.4</span> <code>geom_boxplot</code></h3>
<p>In the following example, a boxplot of <code>Yield</code> is generated for each crop type.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-18_18b848592b91ada451733b8334f68f7a">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(<span class="at">x =</span> Crop, <span class="at">y =</span> Yield)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"bisque"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>If we want to generate a single boxplot (for example for all yields irrespective of crop type) we need to pass a <em>dummy</em> variable to <code>x=</code>:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-19_6ba275519a2568d13cb29b81df7d4fb1">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Yield)) <span class="sc">+</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"bisque"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"All crops"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="geom_violin" class="level3" data-number="15.3.5">
<h3 data-number="15.3.5" class="anchored" data-anchor-id="geom_violin"><span class="header-section-number">15.3.5</span> <code>geom_violin</code></h3>
<p>A violin plot is a symmetrical version of a density plot which provides greater detail of a sample’s distribution than a boxplot.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-20_89d611353611f0204132ce2730d2cc28">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Yield)) <span class="sc">+</span> <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"bisque"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="geom_histogram" class="level3" data-number="15.3.6">
<h3 data-number="15.3.6" class="anchored" data-anchor-id="geom_histogram"><span class="header-section-number">15.3.6</span> <code>geom_histogram</code></h3>
<p>Histograms can be plotted for single variables only (unless faceting is used) as can be noted by the absence of a <code>y=</code> parameter in <code>aes()</code>:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-21_be22104ec84690dcdfc09adfb164b520">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1w, <span class="fu">aes</span>(<span class="at">x =</span> Oats)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"grey50"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The bin widths can be specified in terms of the value’s units. In our example, the unit is yield of oats (in Hg/Ha). So if we want to generate bin widths that cover 1000 Hg/Ha, we can type,</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-22_6e1bb11a03c607d50032a264d32ebe50">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1w, <span class="fu">aes</span>(<span class="at">x =</span> Oats)) <span class="sc">+</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"grey50"</span>, <span class="at">binwidth =</span> <span class="dv">1000</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>If you want to control the number of bins, use the parameter <code>bins=</code> instead. For example, to set the number of bins to 8, modify the above code chunk as follows:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-23_aafe35cd3e9dafd67f703ede335d922f">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1w, <span class="fu">aes</span>(<span class="at">x =</span> Oats)) <span class="sc">+</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"grey50"</span>, <span class="at">bins =</span> <span class="dv">8</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geom_bar" class="level3" data-number="15.3.7">
<h3 data-number="15.3.7" class="anchored" data-anchor-id="geom_bar"><span class="header-section-number">15.3.7</span> <code>geom_bar</code></h3>
<p>Bar plots are used to summaries the counts of a categorical value. For example, to plot the number of counties in each state (note that each record in <code>dat2</code> is assigned a county):</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-24_2f8865a995a4fac84373de245461db64">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(State)) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>To sort the bars by length we need to rearrange the <code>State</code> factor level order based on the number of counties in each state (which is the number of times a state appears in the data frame). We’ll make use of <code>forcats</code>’s <code>fct_infreq</code> function to reorder the State factor levels based on frequency.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-25_f83282eff068b6966af30a19c8f4828e">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="fu">fct_infreq</span>(State,<span class="at">ordered =</span> <span class="cn">TRUE</span>))) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>If we want to reverse the order (i.e.&nbsp;plot from smallest number of counties to greatest), wrap the <code>fct_infreq</code> function with <code>fct_rev</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-26_005f0820aa4ec62695372e4646c7c524">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="fu">fct_rev</span>(<span class="fu">fct_infreq</span>(State,<span class="at">ordered =</span> <span class="cn">TRUE</span>)))) <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The <code>geom_bar</code> function can also be used with count values (i.e.&nbsp;variable already summarized by count). First, we’ll summaries the number of counties by state using the <code>dplyr</code> package. This will generate a data frame with just 51 records: one for each of the 50 states and the District of Columbia.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-27_54e0c5608f7d324511835a3407875cab">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dat2.ct <span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">Counties =</span> <span class="fu">n</span>())</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat2.ct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  State Counties
  &lt;fct&gt;    &lt;int&gt;
1 ak          28
2 al          67
3 ar          74
4 az          15
5 ca          57
6 co          62</code></pre>
</div>
</div>
<p>When using summarized data, we must pass the parameter <code>stat="identity"</code> to the <code>geom_bar</code> function. We must also explicitly map the <em>x</em> and <em>y</em> axes geometries. Note that since we are now generating bar heights from a value field and not a frequency, we will need to use another <code>forcats</code> ordering function called <code>fct_reorder</code>. This function takes three parameters: the variable to be ordered (<code>State</code>), the variable whose values will determine the order (<code>Counties</code>) and the function, <code>fun=</code>, which defines the statistic used to summaries the sorting variable. Since there is just one value per state, we can use any summary statistic such as <code>median</code>, <code>mean</code>, <code>sum</code>, <code>min</code> or <code>max</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-28_87da51bb3a6dfd6c45538f5ba9382d19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2.ct, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fct_reorder</span>(State, Counties, <span class="at">.fun =</span> median), <span class="at">y =</span> Counties)) <span class="sc">+</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Note that you can replace <code>fct_reorder</code> with the base function <code>reorder</code> for succinctness sake.</p>
</section>
<section id="dot-plot" class="level3" data-number="15.3.8">
<h3 data-number="15.3.8" class="anchored" data-anchor-id="dot-plot"><span class="header-section-number">15.3.8</span> dot plot</h3>
<p>The dot plot is an alternative way to visualize counts as a function of a categorical variable. Instead of mapping <code>State</code> to the x-axis, we’ll map it to the y-axis.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-29_0faebd93b6abb9dba0f424a567f3f0af">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2.ct , <span class="fu">aes</span>(<span class="at">x =</span> Counties, <span class="at">y =</span> State)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Dot plot graphics benefit from sorting–more so then bar plots. Here, we’ll make use of <code>forcats::fct_reorder</code> function (see last section on <code>geom_bar</code>).</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-30_9abe5e8e9c37add5bfefe927eaf2e715">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2.ct , <span class="fu">aes</span>(<span class="at">x =</span> Counties, <span class="at">y =</span> <span class="fu">fct_reorder</span>(State, Counties, <span class="at">.fun =</span> median))) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="combining-geometries" class="level3" data-number="15.3.9">
<h3 data-number="15.3.9" class="anchored" data-anchor-id="combining-geometries"><span class="header-section-number">15.3.9</span> Combining geometries</h3>
<p>Geometries can be layered. For example, to overlay a linear regression line to the data we can add the <code>geom_smooth</code> layer:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-31_25d279d73a3c5d2d6e11440d47905771">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The <code>geom_smooth</code> can be used to fit other <em>lines</em> such as a loess:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-32_705157a14e538ae3e2327af1474ccc56">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The confidence interval can be removed from the smooth geometry by specifying <code>se = FALSE</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-33_cb91f5a3ec492e2dd741790e581b8c70">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="combining-datasets" class="level3" data-number="15.3.10">
<h3 data-number="15.3.10" class="anchored" data-anchor-id="combining-datasets"><span class="header-section-number">15.3.10</span> Combining datasets</h3>
<p>You can plot different datasets on the same ggplot canvas. This approach usually requires that each geom be assigned its own dataset and aesthetics. In the following example, we’ll compute the High Density Region (HDR) boxplot parameters using the <code>hdrcde</code> package, then use these parameters to construct <code>geom_rect()</code> that will be added to a <code>geom_point</code> element built from the parent dataset. When data and aesthetics are defined in a geom function, the <code>ggplot()</code> function must be explicitly called right from the beginning.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-34_325aa6382dc46efa26a424e563d72b86">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hdrcde)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the HDR boxplot</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>hdr1d <span class="ot">&lt;-</span> <span class="fu">hdr</span>(dat2<span class="sc">$</span>B20004013, <span class="at">prob =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">99</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the data frame that will store the geom_rect variables</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>hdr.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(hdr1d<span class="sc">$</span>hdr)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">grey</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(hdr.df)) )</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the plot</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> dat2, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span> , <span class="at">y =</span> B20004013), <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">dat =</span> hdr.df, <span class="fu">aes</span>(</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">xmax =</span> <span class="fl">0.2</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> X1, <span class="at">ymax =</span> X2),</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> cols,  <span class="at">colour =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove x-axis </span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="192"></p>
</div>
</div>
<p>The HBR boxplot is designed to visualize multi-modality on the dataset (i.e.&nbsp;data having more than one peak). In the above example, the boxes are encompassing 25%, 50% and 99% of the data.</p>
<p>&nbsp;</p>
</section>
</section>
<section id="tweaking-a-ggplot2-graph" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="tweaking-a-ggplot2-graph"><span class="header-section-number">15.4</span> Tweaking a ggplot2 graph</h2>
<p>&nbsp;</p>
<section id="plot-title" class="level3" data-number="15.4.1">
<h3 data-number="15.4.1" class="anchored" data-anchor-id="plot-title"><span class="header-section-number">15.4.1</span> Plot title</h3>
<p>You can add a plot title using the <code>ggtitle</code> function.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-35_d201a9e402bb17c337086670fd6d7691">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(State)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Number of counties by state"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="axes-titles" class="level3" data-number="15.4.2">
<h3 data-number="15.4.2" class="anchored" data-anchor-id="axes-titles"><span class="header-section-number">15.4.2</span> Axes titles</h3>
<p>Axes titles can be explicitly defined using the <code>xlab()</code> and <code>ylab()</code> functions.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-36_0bc9147e7e3e82615dd66174223b5843">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>To remove axis labels, simply pass <code>NULL</code> to the functions as in <code>xlab(NULL)</code> and <code>ylab(NULL)</code>.</p>
</section>
<section id="axes-labels" class="level3" data-number="15.4.3">
<h3 data-number="15.4.3" class="anchored" data-anchor-id="axes-labels"><span class="header-section-number">15.4.3</span> Axes labels</h3>
<p>You can customize an axis’ label elements. If you are mapping continuous values along the x and y axes, use the <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code> functions. For example, to specify where to place the tics and the accompanying labels, type:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-37_f2909ed4f3d30f2277b904a5e1af6386">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">30000</span>, <span class="dv">50000</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"$10,000"</span>, <span class="st">"$30,000"</span>, <span class="st">"$50,000"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>If you want to change the label formats whereby the numbers are truncated to a thousandth of their original value, you can make use of <code>unit_format()</code> from the <code>scales</code> package:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-38_9660c8b13cc4bc0a755dae35c0ec217a">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x=</span>B20004013, <span class="at">y=</span>B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">suffix=</span><span class="st">"k"</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">scale=</span><span class="fl">0.001</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">sep=</span><span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span><span class="fu">unit_format</span>(<span class="at">suffix=</span><span class="st">"k"</span>, </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">scale=</span><span class="fl">0.001</span>, </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">sep=</span><span class="st">""</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The <code>scales</code> package also has a <code>comma_format()</code> function that will add commas to large numbers:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-39_6ee6632b8248886a378eae890d3c7e24">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>You can rotate axes labels using the <code>theme</code> function.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-40_e484d78c8aa5ee1ee2d129b920ad6a9f">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The <code>hjust</code> argument justifies the values horizontally. Its value ranges from <code>0</code> to <code>1</code> where <code>0</code> is completely left-justified and <code>1</code> is completely right-justified. Note that the justification is <em>relative</em> to the text’s orientation and <em>not</em> to the axis. So it may be best to first rotate the label values, then to adjust justification based on the plot’s look as needed.</p>
<p>If you want the label values rotated 90° you might also need to justify vertically (relative to the text’s orientation) using the <code>vjust</code> argument where <code>0</code> is completely top-justified and <code>1</code> is completely bottom-justified.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-41_1164649fe0ac0216e81193d8af47a1d4">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">0</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="axes-limits" class="level3" data-number="15.4.4">
<h3 data-number="15.4.4" class="anchored" data-anchor-id="axes-limits"><span class="header-section-number">15.4.4</span> Axes limits</h3>
<p>The axis range can be set using <code>xlim()</code> and <code>ylim()</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-42_3b3639887de457ee1baa084a362902d6">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlim</span>(<span class="dv">10000</span>, <span class="dv">75000</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">10000</span>, <span class="dv">75000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>However, if you are calling the <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code> functions, you do not want to use <code>xlim</code> and <code>ylim</code> instead, you should add the <code>limit=</code> argument to the aforementioned functions. For example,</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-43_1c3a2cc836260cc9299e363f7a37a3cd">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_x_continuous</span>(<span class="at">limit  =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">75000</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_y_continuous</span>(<span class="at">limit  =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">75000</span>),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="axes-breaks" class="level3" data-number="15.4.5">
<h3 data-number="15.4.5" class="anchored" data-anchor-id="axes-breaks"><span class="header-section-number">15.4.5</span> Axes breaks</h3>
<p>You can explicitly define the breaks with the <code>breaks</code> argument. Continuing with the last example, we get:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-44_c187836a26fbe6e03a71f87941cf2186">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_x_continuous</span>(<span class="at">limit  =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">75000</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">30000</span>, <span class="dv">50000</span>, <span class="dv">70000</span>)) <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_y_continuous</span>(<span class="at">limit  =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">75000</span>),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10000</span>, <span class="dv">30000</span>, <span class="dv">50000</span>, <span class="dv">70000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Note that the <code>breaks</code> argument can be used in conjunction with other arguments (as shown in this example), or by itself.</p>
</section>
<section id="axes-and-data-transformations" class="level3" data-number="15.4.6">
<h3 data-number="15.4.6" class="anchored" data-anchor-id="axes-and-data-transformations"><span class="header-section-number">15.4.6</span> Axes and data transformations</h3>
<p>If you wish to apply a non-linear transformation to either axes (while preserving the <em>untransformed</em> axis values) add the <code>coord_trans()</code> function as follows:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-45_976190343c47cb3b08d85e1dfbfa3a21">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_trans</span>(<span class="at">x =</span> <span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>You can also transform the y-axis by specifying the parameter <code>y=</code>. The <code>log</code> transformation defaults to the natural log. For a log base 10, use <code>"log10"</code> instead. For a square root transformation, use <code>"sqrt"</code>. For the inverse use <code>"reciprocal"</code>.</p>
<p>Advanced transformations can be called via the <code>scales</code> package. For example, to implement the box-cox transformation (with a power of <code>-0.3</code>), type:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-46_ae13dad476fe352d7a2fec3dd5e5cbea">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_trans</span>(<span class="at">x =</span> scales<span class="sc">::</span><span class="fu">boxcox_trans</span>(<span class="sc">-</span><span class="fl">0.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Note that any statistical geom (such as the regression line) will be applied to the <em>un-transformed</em> data. So a linear model may end up looking non-linear after an axis transformation:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-47_8d3bd78abbef7d2c4f0017652c41a5c5">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_trans</span>(<span class="at">x =</span> <span class="st">"log"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>If a linear fit is to be applied to the transformed data, a better alternative is to transform the values instead of the axes. The transformation can be done on the original data or it can be implemented in ggplot using the <code>scale_x_continuous</code> and <code>scale_y_continuous</code> functions.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-48_7f37fae181b64379675ec7a26690d932">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_x_continuous</span>(<span class="at">trans =</span> <span class="st">"log"</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">10000</span>,<span class="dv">60000</span>,<span class="dv">10000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The <code>scale_x_continuous</code> and <code>scale_y_continuous</code> functions will accept <code>scales</code> transformation parameters–e.g.&nbsp;<code>scale_x_continuous(trans = scales::boxcox_trans(-0.3))</code>. Note that the parameter <code>breaks</code> is not required but is used here to highlight the transformed nature of the axis.</p>
</section>
<section id="aspect-ratio" class="level3" data-number="15.4.7">
<h3 data-number="15.4.7" class="anchored" data-anchor-id="aspect-ratio"><span class="header-section-number">15.4.7</span> Aspect ratio</h3>
<p>You can impose an aspect ratio to your plot using the <code>coord_equal()</code> function. For example, to set the axes units equal (in length) to one another set <code>ratio=1</code>:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-49_a500e9bdac2cad69d993d60df040f344">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013, <span class="at">y =</span> B20004007)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Female income ($)"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Male income ($)"</span>) <span class="sc">+</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_equal</span>(<span class="at">ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="colors" class="level3" data-number="15.4.8">
<h3 data-number="15.4.8" class="anchored" data-anchor-id="colors"><span class="header-section-number">15.4.8</span> Colors</h3>
<p>You can customize geom colors using one of two sets of color schemes: one for continuous values, the other for categorical (discrete) values.</p>
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Continuous</th>
<th>Categorical</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>scale_colour_gradient</code> <code>scale_colour_gradient2</code> <code>scale_color_distiller</code> <code>scale_fill_gradient2</code> <code>scale_fill_gradient</code> <code>scale_fill_distiller</code></td>
<td><code>scale_colour_hue</code> <code>scale_colour_grey</code> <code>scale_colour_manual</code> <code>scale_colour_brewer</code></td>
</tr>
</tbody>
</table>
<p>A few examples follow.</p>
<section id="continuous-color-schemes" class="level4" data-number="15.4.8.1">
<h4 data-number="15.4.8.1" class="anchored" data-anchor-id="continuous-color-schemes"><span class="header-section-number">15.4.8.1</span> Continuous color schemes</h4>
<p>The following chunk of code summarizes <code>dat2</code> by tallying the number of counties in each state and by computing the median county income values.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-50_443955af9fe3ef9ab349679eee6c1bfa">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dat2.ct2 <span class="ot">&lt;-</span> dat2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Counties =</span> <span class="fu">n</span>(), <span class="at">Income =</span> <span class="fu">median</span>(B20004001))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat2.ct2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  State Counties Income
  &lt;fct&gt;    &lt;int&gt;  &lt;dbl&gt;
1 ak          28 33980.
2 al          67 28946 
3 ar          74 26320.
4 az          15 28799 
5 ca          57 33438 
6 co          62 30892.</code></pre>
</div>
</div>
<p>The following chunk applies a green to red color gradient fill to each bar based on the median county incomes. Note that we are using the summarized count table (and not the original <code>dat2</code> table). Recall that when plotting bars from counts that are already tabulated we must specify <code>stat="identity"</code> in the <code>geom_bar</code> function.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-51_6231414d86651526151028ad45304c88">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2.ct2, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(State, Counties), <span class="at">y =</span> Counties, <span class="at">fill =</span> Income)) <span class="sc">+</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"green"</span>, <span class="at">high =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The following chunk applies a divergent color scheme while allowing one to specify the central value of this scheme. Note that the colors are symmetrical about the midpoint which may result in only a partial range of the full possible gradient of colors.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-52_d57448327baffdd445bd15468a9301d1">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2.ct2, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(State, Counties), <span class="at">y =</span> Counties, <span class="at">fill =</span> Income)) <span class="sc">+</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"darkred"</span>, <span class="at">mid =</span> <span class="st">"white"</span>,  <span class="at">high =</span> <span class="st">"darkgreen"</span>, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">midpoint =</span> <span class="dv">30892</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>In the last two chunk, we <em>filled</em> the bars with colors (note the use of functions with the string <code>_fill_</code>). When assigning color to point or line symbols, use the function with the <code>_colour_</code> string. For example:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-53_b2f37af3828f8b5ab7270e04ee7b0357">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2.ct2, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_reorder</span>(State, Counties), <span class="at">x =</span> Counties, <span class="at">col =</span> Income)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_colour_gradient2</span>(<span class="at">low =</span> <span class="st">"darkred"</span>, <span class="at">mid =</span> <span class="st">"white"</span>,  <span class="at">high =</span> <span class="st">"darkgreen"</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">midpoint =</span> <span class="dv">30892</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="discrete-color-schemes" class="level4" data-number="15.4.8.2">
<h4 data-number="15.4.8.2" class="anchored" data-anchor-id="discrete-color-schemes"><span class="header-section-number">15.4.8.2</span> Discrete color schemes</h4>
<p>In the following chunk, we assign colors manually to each level in the variable <code>Yield</code>. The order of the color names mirror the order of the variable levels.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-54_46926f593396f0cd6a8018828224b1f8">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(Year, Yield, <span class="at">col =</span> Crop)) <span class="sc">+</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"yellow"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The following chunk applies a predefined discrete color scheme using one of Brewer’s preset qualitative colors, <code>Dark2</code>, to each level.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-55_66a55ae54397f0b40b7bbfb07bb2d980">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(Year, Yield, <span class="at">col =</span> Crop)) <span class="sc">+</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>You can also apply sequential or divergent Brewer color schemes to variables having an implied order.</p>
<p>Let’s assume that there is an implied order to the crop types. For example, we’ll reorder the crop types based on their median yield (this creates an ordered factor from the <code>Crop</code> variable). We can then use one of Brewer’s sequential color schemes such as <code>Reds</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-56_6b9ec3156dab0439fba47555585230c9">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(Year, Yield, <span class="at">col =</span> <span class="fu">reorder</span>(Crop, Yield, median))) <span class="sc">+</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Crops"</span>)) <span class="sc">+</span>  </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>Note that we’ve added a <code>guides()</code> function to rename the legend title. This is not needed to generate the sequential colors.</p>
<p>To reverse the color scheme, set the <code>direction</code> argument to <code>-1</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-57_163e1d1a89860e8881466ce225013714">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l, <span class="fu">aes</span>(Year, Yield, <span class="at">col =</span> <span class="fu">reorder</span>(Crop, Yield, median))) <span class="sc">+</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Crops"</span>)) <span class="sc">+</span>  </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">scale_colour_brewer</span>(<span class="at">palette =</span> <span class="st">"Reds"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>You can view a list of predifined Brewer color schemes using <code>RColorBrewer::display.brewer.all()</code>.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-58_78c0aad1a2f2eacb2aded114b6486ece">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>RColorBrewer<span class="sc">::</span><span class="fu">display.brewer.all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="adding-mathematical-symbols-to-a-plot" class="level3" data-number="15.4.9">
<h3 data-number="15.4.9" class="anchored" data-anchor-id="adding-mathematical-symbols-to-a-plot"><span class="header-section-number">15.4.9</span> Adding mathematical symbols to a plot</h3>
<p>You can embed math symbols using <code>plotmath</code>’s mathematical expressions by wrapping these expressions in an <code>expression()</code> function. For example,</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-59_331b47b7be4f518e71b3e8e988415827">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2, <span class="fu">aes</span>(<span class="at">x =</span> B20004013<span class="sc">^</span><span class="fl">0.333</span>, <span class="at">y =</span> <span class="fu">sqrt</span>(B20004007))) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>( <span class="fu">expression</span>( (<span class="st">"Female income"</span>) <span class="sc">^</span> <span class="fu">frac</span>(<span class="dv">1</span>,<span class="dv">3</span>) ) ) <span class="sc">+</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylab</span>( <span class="fu">expression</span>( <span class="fu">sqrt</span>(<span class="st">"Male income"</span>) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>To view the full list of mathematical expressions, type <code>?plotmath</code> at a command prompt.</p>
<p>&nbsp;&nbsp;</p>
</section>
</section>
<section id="faceting" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="faceting"><span class="header-section-number">15.5</span> Faceting</h2>
<p>&nbsp;&nbsp;</p>
<section id="faceting-by-categorical-variable" class="level3" data-number="15.5.1">
<h3 data-number="15.5.1" class="anchored" data-anchor-id="faceting-by-categorical-variable"><span class="header-section-number">15.5.1</span> Faceting by categorical variable</h3>
<p>&nbsp;&nbsp;</p>
</section>
<section id="facet_wrap" class="level3" data-number="15.5.2">
<h3 data-number="15.5.2" class="anchored" data-anchor-id="facet_wrap"><span class="header-section-number">15.5.2</span> <code>facet_wrap</code></h3>
<p>Faceting (or conditioning on a variable) can be implemented in <code>ggplot2</code> using the <code>facet_wrap()</code> function.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-60_50db2fddf4f162640ca43022dc704fc5">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield, <span class="at">color =</span> Crop)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_wrap</span>( <span class="sc">~</span> Country, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>The parameter <code>~ Country</code> tells ggplot to condition the plots on country. If we wanted the plots to be stacked, we would set <code>nrow</code> to <code>2</code>.</p>
<p>We can also condition the plots on two variables such as <code>crop</code> and <code>Country</code>. In essence, this <em>stacks</em> the categories. (Note that we will also rotate the x-axis labels to prevent overlaps).</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-61_c948c0b4be8958ed6adc97fd1027b511">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span>Yield)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(Crop <span class="sc">~</span> Country, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<section id="wrapping-facet-headers" class="level4" data-number="15.5.2.1">
<h4 data-number="15.5.2.1" class="anchored" data-anchor-id="wrapping-facet-headers"><span class="header-section-number">15.5.2.1</span> Wrapping facet headers</h4>
<p>You can wrap the facet headers using the <code>label_wrap_gen()</code> function as an argument value to <code>labeler</code>. For example, to wrap the <code>United States of America</code> value, we’ll specify the maximum number of characters per line using the <code>width</code> argument:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-62_56fd62dd71c0b8f44811f699dffa2998">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y=</span>Yield)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(Crop <span class="sc">~</span> Country, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> <span class="fu">label_wrap_gen</span>(<span class="at">width =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
<section id="facet_grid" class="level4" data-number="15.5.2.2">
<h4 data-number="15.5.2.2" class="anchored" data-anchor-id="facet_grid"><span class="header-section-number">15.5.2.2</span> <code>facet_grid</code></h4>
<p>The above <code>facet_wrap</code> example generated unique combinations of the variables <code>Crop</code> and <code>Country</code>. But such plots are usually best represented in a grid structure where one variable is spread along one axis and the other variable is spread along another axis of the plot layout. This can be accomplished using the <code>facet_grid</code> function:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-63_b472cb784dade3f5dd26f7ddc5a73833">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat1l2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_grid</span>( Crop <span class="sc">~</span> Country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
</section>
<section id="faceting-by-continuous-variable" class="level3" data-number="15.5.3">
<h3 data-number="15.5.3" class="anchored" data-anchor-id="faceting-by-continuous-variable"><span class="header-section-number">15.5.3</span> Faceting by continuous variable</h3>
<p>In the above examples, we are faceting the plots based on a categorical variable: <code>Country</code> and/or <code>crop</code>. But what if we want to facet the plots based on a continuous variable? For example, we might be interested in comparing male and female incomes across different female income ranges. This requires that a new categorical field (a factor) be created assigning to each case (row) an income group. We can use the <code>cut()</code> function to accomplish this task (we’ll also omit all values greater than 100,000):</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-64_d1c503f5f976324d8324c7aba4a66f44">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dat2c<span class="sc">$</span>incrng <span class="ot">&lt;-</span> <span class="fu">cut</span>(dat2c<span class="sc">$</span>F , <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25000</span>, <span class="dv">50000</span>, <span class="dv">75000</span>, <span class="dv">100000</span>) )</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat2c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  State                 County Level Region   All     F     M          incrng
1    ak Aleutians East Borough   All   West 21953 20164 22940     (0,2.5e+04]
2    ak Aleutians East Borough  NoHS   West 21953 19250 22885     (0,2.5e+04]
3    ak Aleutians East Borough    HS   West 20770 19671 21192     (0,2.5e+04]
4    ak Aleutians East Borough    AD   West 26383 26750 26352 (2.5e+04,5e+04]
5    ak Aleutians East Borough    BD   West 22431 19592 27875     (0,2.5e+04]
6    ak Aleutians East Borough  Grad   West 74000 74000 71250 (5e+04,7.5e+04]</code></pre>
</div>
</div>
<p>In this chunk of code, we create a new variable, <code>incrng</code>, which is assigned an income category group depending on which range <code>dat2c$F</code> (female income) falls into. The income interval breaks are defined in <code>breaks=</code>. In the output, you will note that the factor <code>incrng</code> defines a range of incomes (e.g.&nbsp;<code>(0 , 2.5e+04]</code>) where the parenthesis <code>(</code> indicates that the left-most value is exclusive and the bracket <code>]</code> indicates that the right-most value is inclusive.</p>
<p>However, because we did not create categories that covered all income values in <code>dat2c$F</code> we ended up with a few <code>NA</code>’s in the <code>incrng</code> column:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-65_db02bff2a8538fc3523cd94a6259c352">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat2c<span class="sc">$</span>incrng)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (0,2.5e+04] (2.5e+04,5e+04] (5e+04,7.5e+04] (7.5e+04,1e+05]            NA's 
           9419            7520            1425              33               5 </code></pre>
</div>
</div>
<p>We will remove all rows associated with missing <code>incrng</code> values:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-66_e0fb4e948526fb1503860b723bcf9571">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>dat2c <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(dat2c)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat2c<span class="sc">$</span>incrng)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (0,2.5e+04] (2.5e+04,5e+04] (5e+04,7.5e+04] (7.5e+04,1e+05] 
           9419            7520            1425              33 </code></pre>
</div>
</div>
<p>We can list all unique levels in our newly created factor using the <code>levels()</code> function.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-67_0b8f1d9ac89944be09ada5b7ee7ebf49">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat2c<span class="sc">$</span>incrng) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(0,2.5e+04]"     "(2.5e+04,5e+04]" "(5e+04,7.5e+04]" "(7.5e+04,1e+05]"</code></pre>
</div>
</div>
<p>The intervals are not meaningful displayed as is (particularly when scientific notation is adopted). So we will assign more meaningful names to our factor levels as follows:</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-68_bb8e4642171a0500135a797bf752233d">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dat2c<span class="sc">$</span>incrng) <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="st">"Under 25k"</span>, <span class="st">"25k-50k"</span>, <span class="st">"50k-75k"</span>, <span class="st">"75k-100k"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat2c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  State                 County Level Region   All     F     M    incrng
1    ak Aleutians East Borough   All   West 21953 20164 22940 Under 25k
2    ak Aleutians East Borough  NoHS   West 21953 19250 22885 Under 25k
3    ak Aleutians East Borough    HS   West 20770 19671 21192 Under 25k
4    ak Aleutians East Borough    AD   West 26383 26750 26352   25k-50k
5    ak Aleutians East Borough    BD   West 22431 19592 27875 Under 25k
6    ak Aleutians East Borough  Grad   West 74000 74000 71250   50k-75k</code></pre>
</div>
</div>
<p>Note that the order in which the names are passed must match that of the original breaks.</p>
<p>Now we can facet male vs.&nbsp;female scatter plots by income ranges. We will also throw in a best fit line to the plots.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-69_061953a783d318325dd5e14bbd1fdce5">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c, <span class="fu">aes</span>(<span class="at">x =</span> F, <span class="at">y =</span> M)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">pch=</span><span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_grid</span>( . <span class="sc">~</span> incrng) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>One reason we would want to explore our data across different ranges of value is to assess the consistency in relationship between variables. In our example, this plot helps assess whether the relationship between male and female income is consistent across income groups.</p>
</section>
</section>
<section id="adding-45-slope-using-geom_abline" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="adding-45-slope-using-geom_abline"><span class="header-section-number">15.6</span> Adding 45° slope using <code>geom_abline</code></h2>
<p>We will add a 45° line using <code>geom_abline</code> (where the intercept will be set to <code>0</code> and the slope to 1) to help visualize the discrepancy between the batches of values. So if a point lies above the 45° line, then male’s income is greater, if the point lies below the line , then female’s income is greater.</p>
<p>To help highlight differences in income, we will make a few changes to the faceted plots. First, we will reduce the y-axis range to $0-$150k (this will remove a few points from the data); we will force the x-axis and y-axis units to match so that a unit of $50k on the x-axis has the same length as that on the y-axis. We will also reduce the number of x tics and assign shorthand notation to income values (such as “50k” instead of “50000”). All this can be accomplished by adding the <code>scale_x_continuous()</code> function to the stack of ggplot elements.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-70_06baf6d3c4ae07f8954e39a897bad197">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c,  <span class="fu">aes</span>(<span class="at">x =</span> F, <span class="at">y =</span> M)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">150000</span>) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>( . <span class="sc">~</span> incrng) <span class="sc">+</span> </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_equal</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50000</span>, <span class="dv">100000</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"50k"</span>, <span class="st">"100k"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Note the change in regression slope for the last facet. The <code>geom_smooth</code> operation is only applied to the data limited to the axis range defined by <code>ylim</code>.</p>
<p>Now let’s look at the same data but this time conditioned on educational attainment.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-71_a56567a38c52fe1fd6a888681ac01f7d">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot M vs F by educational attainment except for Level == All</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c, <span class="fu">aes</span>(<span class="at">x =</span> F, <span class="at">y =</span> M)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">150000</span>) <span class="sc">+</span> </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_grid</span>( . <span class="sc">~</span> Level) <span class="sc">+</span>  </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_equal</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50000</span>, <span class="dv">100000</span>), <span class="at">labels  =</span><span class="fu">c</span>(<span class="st">"50k"</span>, <span class="st">"100k"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>We can also condition the plots on two variables: educational attainment and region.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-72_ce1e9169e36e0c9ba75b5b5717cfea83">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c, <span class="fu">aes</span>(<span class="at">x =</span> F, <span class="at">y =</span> M)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">150000</span>) <span class="sc">+</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">facet_grid</span>( Region <span class="sc">~</span> Level) <span class="sc">+</span>  </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_equal</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">50000</span>, <span class="dv">100000</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"50k"</span>, <span class="st">"100k"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
<section id="tile-plots-heat-maps" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="tile-plots-heat-maps"><span class="header-section-number">15.7</span> Tile plots (heat maps)</h2>
<p>You can create so-called <em>heat maps</em> by tiling the data. This typically requires the use of three variables–two of which are either categorical or have equally spaced continuous values that define a rectangular grid layout, and the third that defines the grid cells’ color. For example, a tile plot can be created showing the median income (for all sexes) as a function of education level and region.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-73_097f2a05c07bbcf1ae0ac35e244d1d88">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>dat2c.med <span class="ot">&lt;-</span> dat2c <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Level <span class="sc">!=</span> <span class="st">"All"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Level, Region) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Income =</span> <span class="fu">median</span>(All))</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c.med, <span class="fu">aes</span>(<span class="at">x =</span> Region, <span class="at">y =</span> Level, <span class="at">fill =</span> Income)) <span class="sc">+</span> <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The above example adopts a continuous color scheme. If you want to bin the color swatches using user defined breaks, swap the <code>scale_fill_gradient</code> function with the <code>scale_fill_binned</code> function.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-74_2b8086cef6aa87a0700c44edb5eacb11">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c.med, <span class="fu">aes</span>(<span class="at">x =</span> Region, <span class="at">y =</span> Level, <span class="at">fill =</span> Income)) <span class="sc">+</span> <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_binned</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">21000</span>, <span class="dv">28000</span>, <span class="dv">32000</span>, <span class="dv">42000</span>, <span class="dv">53000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>As of <code>ggplot2</code> version <code>3.3</code>, you can use the <code>guide_coloursteps</code> function to control the <em>look</em> of your legend. In the last figure, the breaks are not even, yet the legend splits the color swatches into equal length units. Setting the <code>even.steps</code> argument to <code>FALSE</code> scales the color swatches to match the true interval lengths.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-75_c5c979f43528bd4ed11c17872342fe6c">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c.med, <span class="fu">aes</span>(<span class="at">x =</span> Region, <span class="at">y =</span> Level, <span class="at">fill =</span> Income)) <span class="sc">+</span> <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_binned</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">21000</span>, <span class="dv">28000</span>, <span class="dv">32000</span>, <span class="dv">42000</span>, <span class="dv">53000</span>),</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="fu">guide_coloursteps</span>(<span class="at">even.steps =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="384"></p>
</div>
</div>
<p>The <code>scale_fill_binned</code> function offers additional control over the legend such as its height (<code>barheight</code>), width (<code>barwidth</code>) and the display of the minimum and maximum values (<code>show.limits</code>).</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-76_987db6229125625995d879d3d28571fd">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat2c.med, <span class="fu">aes</span>(<span class="at">x =</span> Region, <span class="at">y =</span> Level, <span class="at">fill =</span> Income)) <span class="sc">+</span> <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_binned</span>(<span class="at">low =</span> <span class="st">"yellow"</span>, <span class="at">high =</span> <span class="st">"red"</span>,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">21000</span>, <span class="dv">28000</span>, <span class="dv">32000</span>, <span class="dv">42000</span>, <span class="dv">53000</span>),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="fu">guide_coloursteps</span>(<span class="at">even.steps =</span> <span class="cn">FALSE</span>,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="fl">2.3</span>, <span class="st">"in"</span>),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"in"</span>),</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">show.limits =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ggplot2_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="exporting-to-an-image" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="exporting-to-an-image"><span class="header-section-number">15.8</span> Exporting to an image</h2>
<p>You can export a ggplot figure to an image using the <code>ggsave</code> function. For example,</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-77_6a93e04831e1edd112cecb7886d562f5">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat1l2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield, <span class="at">color =</span> Crop)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Country, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>())</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"fig0.png"</span>, <span class="at">plot =</span> p1, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">2</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">device =</span> <span class="st">"png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="fig0.png" class="img-fluid"></p>
<p>The <code>width</code> and <code>height</code> arguments are defined in units of inches, <code>in</code>. You can also specify these parameters in units of centimeters by setting <code>units = "cm"</code>. The <code>device</code> argument controls the image file type. Other file types include <code>"jpeg"</code>, <code>"tiff"</code>, <code>"bmp"</code> and <code>"svg"</code> just to name a few.</p>
<p>For greater control of the font sizes, you need to make use of the <code>theme</code> function when buiding the plot.</p>
<div class="cell" data-hash="ggplot2_cache/html/unnamed-chunk-78_74aeeb3c51126956f64f82caf666364b">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat1l2, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Yield, <span class="at">color =</span> Crop)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> Country, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text    =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">family =</span> <span class="st">"mono"</span>),</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title   =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text   =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face=</span><span class="st">"italic"</span>, <span class="at">family =</span> <span class="st">"serif"</span>),</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">family =</span> <span class="st">"sans"</span>),</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,  <span class="at">color =</span> <span class="st">"grey40"</span>))</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"fig1.png"</span>, <span class="at">plot =</span> p1, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">2</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="fig1.png" class="img-fluid"></p>
<p>The <code>family</code> argument controls the font type. It does not automatically access all the fonts in your operating system. The three R fonts accessible by default are <code>"serif"</code>, <code>"sans"</code> and <code>"mono"</code>. These are usually mapped to your system’s fonts.</p>
<p>To access other fonts on your operating system, you will need to make use of the <code>showtext</code> package. The package is not covered in this tutorial, instead, refer to the package’s <a href="https://github.com/yixuan/showtext">website</a> for instructions on using the package.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./lattice_plot.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Lattice plotting environment</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./univariate_plots.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Visualizing univariate distributions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Manny Gimond, Creative Commons License <a href="https://creativecommons.org/licenses/by-nc/4.0/"><img src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" class="img-fluid"></a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>