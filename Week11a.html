<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Analyzing two-way tables</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/regression.html">Details of the OLS regression method (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/ANOVA.html">Details of an ANOVA (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Analyzing two-way tables</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#anatomy-of-a-two-way-table">Anatomy of a two-way table</a></li>
<li><a href="#analysis-workflow">Analysis workflow</a><ul>
<li><a href="#visualizing-the-data">Visualizing the data</a></li>
<li><a href="#median-polish">Median polish</a><ul>
<li><a href="#step-1-compute-overall-median-and-residual-table">Step 1: Compute overall median and residual table</a></li>
<li><a href="#step-2-compute-the-row-medians">Step 2: Compute the row medians</a></li>
<li><a href="#step-3-create-a-new-residual-table-from-the-row-medians">Step 3: Create a new residual table from the row medians</a></li>
<li><a href="#step-4-compute-the-column-medians">Step 4: Compute the column medians</a></li>
<li><a href="#step-5-create-a-new-residual-table-from-the-column-medians">Step 5: Create a new residual table from the column medians</a></li>
<li><a href="#step-6-second-iteration-row-effects">Step 6: Second iteration – row effects</a></li>
<li><a href="#step-7-second-iteration-column-effects">Step 7: Second iteration – column effects</a></li>
<li><a href="#when-do-we-stop-iterating">When do we stop iterating?</a></li>
</ul></li>
<li><a href="#interpreting-the-median-polish">Interpreting the median polish</a></li>
<li><a href="#test-for-non-additivity">Test for non-additivity</a></li>
</ul></li>
<li><a href="#implementing-the-median-polish-in-r">Implementing the median polish in R</a></li>
<li><a href="#what-if-we-use-the-mean-instead-of-the-median">What if we use the mean instead of the median?</a><ul>
<li><a href="#two-way-anova">Two-way ANOVA</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<div style="color:#ff7535; background-color:#fff0ee ;   border-left-style: solid">
<p>This tutorial makes use of the following R package(s): <strong><code>tidyr</code></strong> and <strong><code>dplyr</code></strong>.</p>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Before tackling two-way tables, let’s explore a simpler one-way table. The following dataset shows mean annual income by occupation for the year 2014 (<em>src: <a href="http://www.bls.gov/oes/#tables">Bureau of Labor Statistics</a></em>)</p>
<!-- html table generated in R 3.3.2 by xtable 1.8-2 package -->
<!-- Mon Apr 24 10:11:48 2017 -->
<table border="1">
<tr>
<th>
</th>
<th>
Income
</th>
</tr>
<tr>
<td align="right">
Architecture and Engineering
</td>
<td align="right">
112490
</td>
</tr>
<tr>
<td align="right">
Arts, Design, Entertainment, Sports, and Media
</td>
<td align="right">
72410
</td>
</tr>
<tr>
<td align="right">
Building and Grounds Cleaning and Maintenance
</td>
<td align="right">
83970
</td>
</tr>
<tr>
<td align="right">
Business and Financial Operations
</td>
<td align="right">
81520
</td>
</tr>
<tr>
<td align="right">
Community and Social Service
</td>
<td align="right">
70070
</td>
</tr>
<tr>
<td align="right">
Computer and Mathematical
</td>
<td align="right">
45310
</td>
</tr>
<tr>
<td align="right">
Construction and Extraction
</td>
<td align="right">
101110
</td>
</tr>
<tr>
<td align="right">
Education, Training, and Library
</td>
<td align="right">
52210
</td>
</tr>
<tr>
<td align="right">
Farming, Fishing, and Forestry
</td>
<td align="right">
55790
</td>
</tr>
<tr>
<td align="right">
Food Preparation and Serving Related
</td>
<td align="right">
76010
</td>
</tr>
<tr>
<td align="right">
Healthcare Practitioners and Technical
</td>
<td align="right">
28820
</td>
</tr>
<tr>
<td align="right">
Healthcare Support
</td>
<td align="right">
43980
</td>
</tr>
<tr>
<td align="right">
Installation, Maintenance, and Repair
</td>
<td align="right">
21980
</td>
</tr>
<tr>
<td align="right">
Legal
</td>
<td align="right">
26370
</td>
</tr>
<tr>
<td align="right">
Life, Physical, and Social Science
</td>
<td align="right">
24980
</td>
</tr>
<tr>
<td align="right">
Management
</td>
<td align="right">
38660
</td>
</tr>
<tr>
<td align="right">
Office and Administrative Support
</td>
<td align="right">
35530
</td>
</tr>
<tr>
<td align="right">
Personal Care and Service
</td>
<td align="right">
25160
</td>
</tr>
<tr>
<td align="right">
Production
</td>
<td align="right">
46600
</td>
</tr>
<tr>
<td align="right">
Protective Service
</td>
<td align="right">
45220
</td>
</tr>
<tr>
<td align="right">
Sales and Related
</td>
<td align="right">
35490
</td>
</tr>
<tr>
<td align="right">
Transportation and Material Moving
</td>
<td align="right">
34460
</td>
</tr>
</table>
<p>So, what can we glean from this dataset other than the raw values associated with each occupation type? For starters, we may be interested in coming up with a summary of income values such as the median, or $45265 in our working example. This is a single value that can be used to characterize the overall income value. However, the income values in our batch are not all equal to $45265–they vary above or below this median value. A good way to measure the variability about the median is to subtract the median income value from each occupation income value. We can do this in a table, but will choose a dotplot chart instead to facilitate comparison.</p>
<p><img src="Week11a_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<p>We have separated the income values into two parts: an <strong>overall</strong> value and the difference between each value and the overall (which we will refer to as the <strong>residuals</strong>). This can be written in the following algebraic form:</p>
<p><span class="math display">\[
Income_{Occupation} = Income_{median} + Income_{residual}
\]</span></p>
<p>For example, ‘Healthcare Support’ average income of $43980 can be separated into the sum of the median, $45265, and the residual, $-1285.</p>
<p>So in addition to gleaning a median income value from this batch of values, we have also devised a way to facilitate the comparison of the income values to one another. Alternatively, we could have assigned colors to each cell of the table reflecting their values <em>relative</em> to the overall median.</p>
<p><img src="Week11a_files/figure-html/unnamed-chunk-4-1.png" width="384" /></p>
<p>The income value can be thought of as the <strong>response</strong> to the occupation type (also known as a <strong>factor</strong>). In other words, the factor determines the value in our table. We can re-write the last equation in a more formal way:</p>
<p><span class="math display">\[
y_{i} = \mu + \epsilon_i 
\]</span></p>
<p>where <span class="math inline">\(y_{i}\)</span> is the <strong>response variable</strong> (e.g. income) for <strong>factor</strong> <span class="math inline">\(i\)</span> (e.g. occupation), <span class="math inline">\(\mu\)</span> is the overall typical value (hereafter referred to as the <strong>common value</strong>) and is usually the mean or median, and <span class="math inline">\(\epsilon_i\)</span> is the <strong>residual</strong>. Next, we will see how the idea of separating the values into components can be expanded to <strong>two-way</strong> (aka <strong>two-factor</strong>) tables.</p>
</div>
<div id="anatomy-of-a-two-way-table" class="section level1">
<h1>Anatomy of a two-way table</h1>
<p>Let’s decompose the following table which represents infant mortality rates (per 1000 live births) by region and by a father’s educational attainment for the years 1964 through 1966 (Hoaglin <em>et al.</em>).</p>
<div class="figure">
<img src="img/twoway_01.png" />

</div>
<p>A two-way table is composed of three variables:</p>
<ul>
<li>a <strong>row factor</strong> which has <strong>four levels</strong> in our working example: Northeast, North Central, South and West,</li>
<li>a <strong>column factor</strong> which has <strong>five levels</strong> in our working example: under 8, 9-11, 12, 13-15 and 16 and greater years of education,</li>
<li><strong>response variables</strong> of which we have 4 (rows) x 5 (columns) = 20 all together.</li>
</ul>
<p>A two-way table is an extension to the one-way table described in the introduction where instead of grouping a continuous variable by a single factor category we explore the variable across <strong>two</strong> factor categories.</p>
<p>We can represent the relationship between the response variable, <span class="math inline">\(y\)</span>, and the <em>two</em> factors as:</p>
<p><span class="math display">\[
y_{ij} = \mu + \alpha_i + \beta_j + \epsilon_{ij}
\]</span></p>
<p>where <span class="math inline">\(y_{ij}\)</span> is the <strong>response variable</strong> for row <span class="math inline">\(i\)</span> and column <span class="math inline">\(j\)</span>, <span class="math inline">\(\mu\)</span> is the overall typical value (hereafter referred to as the <em>common value</em>), <span class="math inline">\(\alpha_i\)</span> is the <strong>row effect</strong>, <span class="math inline">\(\beta_j\)</span> is the <strong>column effect</strong> and <span class="math inline">\(\epsilon_{ij}\)</span> is the <strong>residual</strong> or value left over after <em>all</em> effects are taken into account.</p>
<p>The goal of this analysis is to decompose the response variable into its respective effects–i.e. the two contributing factors: <em>education of father</em> and <em>region</em>–via an iterative process where row medians and column medians are removed from the response variables repeatedly until the row and column medians approach zero.</p>
</div>
<div id="analysis-workflow" class="section level1">
<h1>Analysis workflow</h1>
<p>Let’s first create the dataframe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">row.names =</span> <span class="kw">c</span>(<span class="st">&quot;NE&quot;</span>,<span class="st">&quot;NC&quot;</span>,<span class="st">&quot;S&quot;</span>,<span class="st">&quot;W&quot;</span>),
                 <span class="dt">ed8       =</span> <span class="kw">c</span>(<span class="fl">25.3</span>,<span class="fl">32.1</span>,<span class="fl">38.8</span>,<span class="fl">25.4</span>), 
                 <span class="dt">ed9to11   =</span> <span class="kw">c</span>(<span class="fl">25.3</span>,<span class="dv">29</span>,<span class="dv">31</span>,<span class="fl">21.1</span>),
                 <span class="dt">ed12      =</span> <span class="kw">c</span>(<span class="fl">18.2</span>,<span class="fl">18.8</span>,<span class="fl">19.3</span>,<span class="fl">20.3</span>),
                 <span class="dt">ed13to15  =</span> <span class="kw">c</span>(<span class="fl">18.3</span>,<span class="fl">24.3</span>,<span class="fl">15.7</span>,<span class="dv">24</span>),
                 <span class="dt">ed16      =</span> <span class="kw">c</span>(<span class="fl">16.3</span>,<span class="dv">19</span>,<span class="fl">16.8</span>,<span class="fl">17.5</span>)
                 )</code></pre></div>
<div id="visualizing-the-data" class="section level2">
<h2>Visualizing the data</h2>
<p>It’s often easier to look at a graphical representation of the data than a tabular one. Even a table as small as this can benefit from a plot.</p>
<p>We will adopt Cleveland’s dot plot for this purpose (see course text page 302). R has a built-in dotplot function called <code>dotchart</code>. It requires that the table be stored as a matrix instead of a dataframe; we will therefore convert <code>df</code> to a matrix by wrapping it with the <code>as.matrix()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dotchart</span>( <span class="kw">as.matrix</span>(df), <span class="dt">cex=</span><span class="fl">0.7</span>)</code></pre></div>
<p><img src="Week11a_files/figure-html/unnamed-chunk-6-1.png" width="288" /></p>
<p>The plot helps visualize any differences in mortality rates across different father educational attainment levels. There seems to be a gradual decrease in child mortality with increasing father educational attainment.</p>
<p>But the plot does not help spot differences across regions (except for the <code>ed12</code> group). We can generate another plot where region becomes the main grouping factor. We do this by wrapping the matrix with the transpose function <code>t()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dotchart</span>( <span class="kw">t</span>(<span class="kw">as.matrix</span>(df)), <span class="dt">cex=</span><span class="fl">0.7</span>)</code></pre></div>
<p><img src="Week11a_files/figure-html/unnamed-chunk-7-1.png" width="288" /></p>
<p>At first glance, there seems to be higher death rates for the <code>NC</code> and <code>S</code> regions and relatively lower rates for the <code>W</code> and <code>NE</code> regions. But our eyes may be fooled by outliers in the data.</p>
<p>Next, we’ll generate side-by-side boxplots to compare the effects between both categories. Note that we’ll need to create a <em>long</em> version of the table using the <code>tidyr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)

df.l &lt;-<span class="st"> </span>df %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Region =</span> <span class="kw">as.factor</span>(<span class="kw">row.names</span>(.)) )  %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>Edu, <span class="dt">value =</span> Deaths, -Region) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Edu =</span> <span class="kw">factor</span>(Edu, <span class="dt">levels=</span><span class="kw">names</span>(df)))

<span class="co"># side-by-side plot</span>
OP &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(Deaths ~<span class="st"> </span>Region +<span class="st"> </span>Edu, df.l)
<span class="kw">par</span>(OP)</code></pre></div>
<p><img src="Week11a_files/figure-html/unnamed-chunk-8-1.png" width="576" /></p>
<p>So at this point the plots suggest that there may be a father’s educational attainment effect as well as a regional effect on infant mortality with the former effect being possibly more important.</p>
<p>Next we will attempt to quantify these effects using Tukey’s <strong>median polish</strong>.</p>
</div>
<div id="median-polish" class="section level2">
<h2>Median polish</h2>
<div id="step-1-compute-overall-median-and-residual-table" class="section level3">
<h3>Step 1: Compute overall median and residual table</h3>
<p>First, we will compute the median value for <em>all</em> values in the dataset; this will be our first estimate of the <strong>common</strong> value. The resulting median value is placed in the upper left-hand margin of the table. A <strong>residual table</strong> is created by taking the difference between the original value and the overall median.</p>
<div class="figure">
<img src="img/twoway_02.jpg" />

</div>
<p>You’ll also note that the row and column effect values are initially populated with 0 values.</p>
</div>
<div id="step-2-compute-the-row-medians" class="section level3">
<h3>Step 2: Compute the row medians</h3>
<p>Next, row medians are computed (shown in red in the following figure) from the residual table.</p>
<div class="figure">
<img src="img/twoway_03.jpg" />

</div>
<p>Note that in addition to computing the row median values for the response variable, we are also computing the median value for the <em>column effects</em> in the upper margin (which happens to be zero since we have no column effect values yet).</p>
</div>
<div id="step-3-create-a-new-residual-table-from-the-row-medians" class="section level3">
<h3>Step 3: Create a new residual table from the row medians</h3>
<p>The row medians are added to the left hand margin of the new residual table (shown in green). These values represent the <em>row effects</em> in this first iteration. A new set of residual values is created from the row medians where each cell takes on the value of the subtraction of the row median from each response variable in that row.</p>
<div class="figure">
<img src="img/twoway_04.jpg" />

</div>
<p>The subtraction is also done for the <em>column effect</em> values (even though all values remain zero) <strong>and</strong> the global median (common effect value).</p>
</div>
<div id="step-4-compute-the-column-medians" class="section level3">
<h3>Step 4: Compute the column medians</h3>
<p>Next, column medians are computed (shown in red in the following figure) from the residual table. Note that you are NOT computing the column medians from the original response variables. Note too that we are also computing the median value for the row effect values (left margin).</p>
<div class="figure">
<img src="img/twoway_05.jpg" />

</div>
</div>
<div id="step-5-create-a-new-residual-table-from-the-column-medians" class="section level3">
<h3>Step 5: Create a new residual table from the column medians</h3>
<p>A new residual table is created from the column median where each new cell takes on the value of the subtraction of the column median from each initial residual value in that column. For example, the first upper-left cell’s residual is <span class="math inline">\(7.0 - 7.4 = -0.4\)</span>.</p>
<p>The column medians are also added to the column effect margin. Note that we are also adding the row effect median value, <code>-0.5</code>, to the <em>common effect</em> cell in the upper left-hand corner.</p>
<div class="figure">
<img src="img/twoway_06.jpg" />

</div>
<p>We have now completed our first row and column smoothing iteration. However, there may be more row and column effects that can be pulled from the residuals. We therefore move on to a second iteration.</p>
</div>
<div id="step-6-second-iteration-row-effects" class="section level3">
<h3>Step 6: Second iteration – row effects</h3>
<p>Next, we compute the row medians from the residuals, then add the <em>column effect</em> median to the top margin (and the common value) and subtract the row medians from the residuals. as in step 3.</p>
<div class="figure">
<img src="img/twoway_06b.jpg" />

</div>
</div>
<div id="step-7-second-iteration-column-effects" class="section level3">
<h3>Step 7: Second iteration – column effects</h3>
<p>To wrap-up the second iteration, we compute the column median values from the residuals then subtract the medians from those residuals. We also add the medians to the row effect values and the common value.</p>
<div class="figure">
<img src="img/twoway_07.jpg" />

</div>
</div>
<div id="when-do-we-stop-iterating" class="section level3">
<h3>When do we stop iterating?</h3>
<p>The goal is to iterate through the row and column smoothing operations until the row and column effect medians are close to 0. However, Hoaglin <strong>et al.</strong> (1983) warn against “using unrestrained iteration” and suggest that a few steps should be more than adequate in most instances. In our working example, a third iteration may be warranted. The complete workflow for this third iteration follows.</p>
<div class="figure">
<img src="img/twoway_08.jpg" />

</div>
<p>The final version of the table (along with the column and row values) is shown below:</p>
<div class="figure">
<img src="img/twoway_09.jpg" />

</div>
<p>An animation of the median polish iterations follows. Note how, at the end of the iterations, the <em>common factor</em> ends up contributing the largest effect. Also note the one abnormally high residual in the southern region associated with 8<sup>th</sup> grade education.</p>
<video width="576"  controls>
<source src="Week11a_files/figure-html/clock-.webm" />
<p>
video of chunk clock
</p>
</video>
</div>
</div>
<div id="interpreting-the-median-polish" class="section level2">
<h2>Interpreting the median polish</h2>
<p>As noted earlier, a two-way table represents the relationship between the response variable, <span class="math inline">\(y\)</span>, and the two categories as:</p>
<p><span class="math display">\[
y_{ij} = \mu + \alpha_i + \beta_j + \epsilon_{ij}
\]</span></p>
<p>In our working example, <span class="math inline">\(\mu\)</span> = 20.6; <span class="math inline">\(\alpha_i\)</span> = -1.5, 2.6 -0.4, and 0.4 for <span class="math inline">\(i\)</span> = <code>NE</code>, <code>Nc</code>, <code>S</code> and <code>W</code> respectively; <span class="math inline">\(\beta_j\)</span> = 7.6, 6.0, -0.9, 0.2 and -3.5 for <span class="math inline">\(j\)</span> = <code>ed8</code>, <code>ed9to11</code>, <code>ed12</code>, <code>ed13to15</code> and <code>ed16</code> respectively.</p>
<p>The residuals represent the portion of the mortality rates that can’t be explained by either factors.</p>
<p>So the mortality rate in the upper left-hand cell from the original table can be deconstructed as:</p>
<div class="figure">
<img src="img/twoway_10.jpg" />

</div>
<p>The examination of the table suggests that the infant mortality rate is greatest for fathers who did not attain more than 8 years of school (i.e. who has not completed high school) as noted by the high column effect value of 7.6. This is the rate of infant mortality <strong>relative to the overall median</strong> (i.e. on average, 20.6 infants per thousand die every year and the rate goes up to 7.6 + 20.6 for infants whose father has not passed the 8<sup>th</sup> grade). Infants whose father has completed more than 16 years of school (i.e. who as completed college) have a lower rate of mortality as indicated by the low effect value of -3.5 (i.e. 3.5 fewer depths than average). The effects from regions also show higher infant mortality rates for North Central and Western regions (with effect values of 2.6 and 0.4 respectively) and lower rates for the northeastern and southern regions; however the regional effect does not appear to be as dominant as that of the father’s educational attainment.</p>
<p>It’s also important to look at the distribution of the residual numbers across the two-way table. One should identify unusually high or low residuals in the table. Such residuals may warrant further investigation (e.g. the high southern region residual value of 10.8 may need further exploration).</p>
</div>
<div id="test-for-non-additivity" class="section level2">
<h2>Test for non-additivity</h2>
<p>Thus far, we have assumed an additive relationship between the effects (factors). But this additive model may not be the best fit for our data. A good way to test this is by generating a <strong>Tukey Additivity Plot</strong> where we plot residuals vs. the <strong>comparison value</strong>, <span class="math inline">\(cv_{ij}\)</span>, defined as <span class="math inline">\(\alpha_i \beta_j / \mu\)</span>. If the plot is devoid of any obvious trend or pattern we can conclude that our dataset is consistent with an additive model. Such seems to be the case with our working example as shown in the following plot.</p>
<p><img src="Week11a_files/figure-html/unnamed-chunk-9-1.png" width="288" /></p>
<p>If the diagnostic plot revealed a trend, its shape–or more specifically, its slope–could be used in helping define an appropriate transformation for the data. A rule of thumb is to apply a <span class="math inline">\((1 – slope)\)</span> power transformation to the original data. If the resulting power is not appropriate for the dataset then the <span class="math inline">\(cv_{ij}\)</span> can be added to the additive model as follows:</p>
<p><span class="math display">\[
y_{ij} = \mu + \alpha_i + \beta_j + \alpha_i \beta_j / \mu  + \epsilon_{ij}
\]</span></p>
</div>
</div>
<div id="implementing-the-median-polish-in-r" class="section level1">
<h1>Implementing the median polish in R</h1>
<p>The steps outlined in the previous section can be easily implemented using pen and paper or a spreadsheet environment for larger datasets. R has a built-in function called <code>medpolish()</code> which does this for us. We can define the maximum number of iterations by setting the <code>maxiter=</code> parameter but note that <code>medpolish</code> will, by default, automatically estimate the best number of iterations for us. We’ll set it to <code>3</code> to match the three iterations conducted in the previous selection.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.med &lt;-<span class="st"> </span><span class="kw">medpolish</span>( df , <span class="dt">maxiter=</span><span class="dv">3</span>)</code></pre></div>
<pre><code>1: 47.1
2: 42.9
3: 42.45</code></pre>
<p>The three values printed to the console gives us the sum of absolute residuals at each iteration; we will ignore these numbers. The output from the model is stored in the <code>df.med</code> object. To see its contents , simply type it at the command line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.med</code></pre></div>
<pre><code>
Median Polish Results (Dataset: &quot;df&quot;)

Overall: 20.6

Row Effects:
   NE    NC     S     W 
-1.50  2.55 -0.35  0.35 

Column Effects:
     ed8  ed9to11     ed12 ed13to15     ed16 
   7.575    6.025   -0.925    0.175   -3.450 

Residuals:
      ed8 ed9to11   ed12 ed13to15  ed16
NE -1.375   0.175  0.025   -0.975  0.65
NC  1.375  -0.175 -3.425    0.975 -0.70
S  10.975   4.725 -0.025   -4.725  0.00
W  -3.125  -5.875  0.275    2.875  0.00</code></pre>
<p>All three effects are displayed as well as the residuals (note that the precision returned is greater than that used in our earlier analysis).</p>
<p>To generate the Tukey additivity plot, simply wrap the median polish object with the <code>plot</code> command as in:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>( df.med )</code></pre></div>
<p><img src="Week11a_files/figure-html/unnamed-chunk-12-1.png" width="288" /></p>
</div>
<div id="what-if-we-use-the-mean-instead-of-the-median" class="section level1">
<h1>What if we use the mean instead of the median?</h1>
<p>The procedure is similar with some notable differences. First, we compute the global mean instead of the medians (the common effect) then subtract it from all values in the table. Next, we compute the row means (the row effect) then subtract each mean from all values in its associated row. We finally compute the column means (from the residuals) to give us the column effect. That’s it, unlike the median polish, we do not iterate the smoothing sequences. An example of a “mean” polish applied to our data follows:</p>
<div class="figure">
<img src="img/twoway_11.png" />

</div>
<p>The results differ slightly from those produced using the median polish. Recall that the mean is sensitive to outliers and medians are not. If a robust estimate of the effects is sought, stick with the median polish.</p>
<p>So what can we gain from the “mean” polish? Well, as it turns out, it serves as the basis of the <strong>two-way ANOVA</strong>.</p>
<div id="two-way-anova" class="section level2">
<h2>Two-way ANOVA</h2>
<p>A two-way ANOVA assesses whether the factors (categories) have a significant effect on the outcome. Its implementation can be conceptualized as a regression analysis where each row and column level is treated as a dummy variable. The computed regression coefficients are the same as the levels computed using the “mean” polish outlined in the previous step except for one notable difference: the ANOVA adds one of the column level values and one of the row level values to the grand mean then subtracts those values from their respective row/column effects.</p>
<div class="figure">
<img src="img/twoway_12.png" />

</div>
<p>The resulting row/column levels are the regression coefficients:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">M &lt;-<span class="st"> </span><span class="kw">lm</span>(Deaths ~<span class="st"> </span>Edu +<span class="st"> </span>Region, df.l)
<span class="kw">coef</span>(M)</code></pre></div>
<pre><code>(Intercept)  Edued9to11     Edued12 Edued13to15     Edued16    RegionNE     RegionS     RegionW 
     32.215      -3.800     -11.250      -9.825     -13.000      -3.960      -0.320      -2.980 </code></pre>
<p>The regression formula takes on the form:</p>
<p><span class="math display">\[
Deaths = 32.21 - 3.8(ed9to11) -11.25(ed12) -9.83(ed13to15) -13(ed16) \\
         -3.96(RegionNE) -0.320(RegionS)  -2.980(RegionW) + \epsilon_{ij}
\]</span></p>
<p>So, for example, to compute the first value in the raw table (death rate = 25.3) from the formula, substitute the variables as follows:</p>
<p><span class="math display">\[
Deaths = 32.21 - 3.8(0) -11.25(0) -9.83(0) -13(0) \\
         -3.96(1) -0.320(0)  -2.980(0) - 3.0 \\
       = 32.21 -3.96 -3.0 \\
       = 25.3
\]</span></p>
<p>To assess if any of the factors have a significant effect on the <code>Death</code> variables, simply wrap the regression with an <code>anova()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(M)</code></pre></div>
<pre><code>Analysis of Variance Table

Response: Deaths
          Df Sum Sq Mean Sq F value  Pr(&gt;F)   
Edu        4 478.52 119.630  7.7539 0.00251 **
Region     3  57.44  19.146  1.2410 0.33801   
Residuals 12 185.14  15.428                   
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The results suggest that the father’s educational attainment has a significant effect on infant mortality (p = 0.0025) whereas the region does not (p = 0.338).</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p><em>Understanding Robust and Exploratory Data Analysis</em>, D.C. Hoaglin, F. Mosteller and J.W. Tukey, 1983.</p>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2017)
</br>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
